<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>梅花心易警察辦案輔助系統</title>
    <style>
        body { font-family: '微軟正黑體', 'Microsoft JhengHei', sans-serif; background-color: #f4f4f9; color: #333; display: flex; justify-content: center; align-items: center; flex-direction: column; padding: 20px; min-height: 100vh; }
        .container { display: flex; flex-direction: column; gap: 20px; max-width: 600px; width: 100%; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: #2c3e50; font-size: 2.5em; margin-bottom: 5px; }
        .header p { color: #7f8c8d; font-size: 1.1em; }
        .input-section { background-color: #fff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); padding: 30px; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .input-section h2 { color: #34495e; margin-bottom: 10px; }
        .input-section p { color: #95a5a6; margin-bottom: 20px; }
        input[type="number"] { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; box-sizing: border-box; }
        button { padding: 12px 25px; border: none; border-radius: 5px; background-color: #3498db; color: white; font-size: 1em; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        #resultArea { background-color: #fff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); padding: 30px; display: none; flex-direction: column; align-items: flex-start; margin-top: 20px; text-align: left; }
        #resultArea h3, #resultArea h4 { color: #2c3e50; }
        #resultArea hr { width: 100%; border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0)); }
        .disclaimer { font-size: 0.8em; color: #7f8c8d; margin-top: 20px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>梅花心易警察辦案輔助系統</h1>
        <p>運用古老易經智慧，為案件偵辦提供新視角與線索。</p>
    </div>

    <div class="input-section">
        <h2>數字起卦 - 9位數</h2>
        <p>請輸入與案件相關的9位數數字，例如車牌、時間或任何直覺想到的數字。</p>
        <input type="number" id="numInput" placeholder="請輸入9位數" maxlength="9">
        <button onclick="calculateByNumber()">開始推算</button>
    </div>

    <div id="resultArea"></div>
    
    <p class="disclaimer">* 本系統為輔助工具，其分析結果僅供辦案參考與啟發思路，不應作為唯一的偵辦依據。</p>
</div>

<script>
    let hexagramData = {};

    // 啟動時載入 JSON 資料
    window.onload = async () => {
        await loadData();
    };

    async function loadData() {
        try {
            const response = await fetch('hexagram_data.json');
            if (!response.ok) throw new Error('Network response was not ok');
            hexagramData = await response.json();
            console.log('卦象資料載入成功！');
        } catch (error) {
            console.error('載入卦象資料失敗:', error);
            alert('無法載入卦象資料，請檢查檔案是否存在。');
        }
    }

    // 數字起卦主函式
    function calculateByNumber() {
        const input = document.getElementById('numInput').value;
        if (input.length !== 9 || isNaN(input)) {
            alert('請輸入有效的9位數數字！');
            return;
        }

        const numStr = String(input);
        const sumLower = parseInt(numStr.substring(0, 3), 10);
        const sumUpper = parseInt(numStr.substring(3, 6), 10);
        const sumChange = parseInt(numStr.substring(6, 9), 10);

        const lowerHexagramNum = sumLower % 8 === 0 ? 8 : sumLower % 8;
        const upperHexagramNum = sumUpper % 8 === 0 ? 8 : sumUpper % 8;
        const changingLine = sumChange % 6 === 0 ? 6 : sumChange % 6;

        generateReport(lowerHexagramNum, upperHexagramNum, changingLine, input);
    }

    // 卦象分析與報告生成函式
    function generateReport(lowerNum, upperNum, changingLine, input) {
        if (!hexagramData || !hexagramData.gua || !hexagramData.hexagrams) {
            alert('卦象資料尚未載入或載入失敗，請重試。');
            return;
        }
        
        // 本卦分析
        const mainHexagram = hexagramData.hexagrams[`${upperNum}_${lowerNum}`];
        const mainGuaName = mainHexagram ? mainHexagram.name : '未知卦名';
        const mainGuaSummary = mainHexagram ? mainHexagram.summary : '無相關解釋。';
        const upperGua = hexagramData.gua[upperNum];
        const lowerGua = hexagramData.gua[lowerNum];

        // 互卦分析
        const innerGuaNum1 = lowerGua.num; // 下卦的下爻
        const innerGuaNum2 = upperGua.num; // 上卦的上爻
        const interGuaNum1 = (innerGuaNum1 % 2 === 0 ? innerGuaNum1 + 1 : innerGuaNum1 - 1);
        const interGuaNum2 = (innerGuaNum2 % 2 === 0 ? innerGuaNum2 + 1 : innerGuaNum2 - 1);
        const interGuaLowerNum = (lowerNum % 2 === 0) ? lowerNum + 1 : lowerNum - 1;
        const interGuaUpperNum = (upperNum % 2 === 0) ? upperNum + 1 : upperNum - 1;
        const interGuaName = hexagramData.hexagrams[`${interGuaUpperNum}_${interGuaLowerNum}`] ? hexagramData.hexagrams[`${interGuaUpperNum}_${interGuaLowerNum}`].name : '未知互卦';

        // 變卦分析
        let changedUpperNum = upperNum;
        let changedLowerNum = lowerNum;
        if (changingLine > 3) { // 變爻在上卦
            const upperLines = [upperNum, (upperNum % 2 === 0 ? upperNum - 1 : upperNum + 1), upperNum]; // 簡化處理
            changedUpperNum = upperLines[changingLine - 4];
        } else { // 變爻在下卦
            const lowerLines = [lowerNum, (lowerNum % 2 === 0 ? lowerNum - 1 : lowerNum + 1), lowerNum]; // 簡化處理
            changedLowerNum = lowerLines[changingLine - 1];
        }
        const changedHexagram = hexagramData.hexagrams[`${changedUpperNum}_${changedLowerNum}`];
        const changedGuaName = changedHexagram ? changedHexagram.name : '未知變卦';
        const changedGuaSummary = changedHexagram ? changedHexagram.summary : '無相關解釋。';

        // 體用生剋分析
        const tiGua = changingLine > 3 ? upperGua : lowerGua; // 體卦為變爻所在卦
        const yongGua = changingLine > 3 ? lowerGua : upperGua; // 用卦為對應的另一卦
        const tiElement = tiGua.element;
        const yongElement = yongGua.element;
        const elementRelation = hexagramData.element_relations[tiElement];
        let relationText = '';

        if (elementRelation.生 === yongElement) {
            relationText = `${tiGua.name}生${yongGua.name}，代表**我生助對方**。這意味著警方主動付出、積極偵查，案件進展順利。`;
        } else if (elementRelation.剋 === yongElement) {
            relationText = `${tiGua.name}剋${yongGua.name}，代表**我克制對方**。這意味著警方能掌控局面、剋制嫌犯，案件可順利解決。`;
        } else if (hexagramData.element_relations[yongElement].生 === tiElement) {
            relationText = `${yongGua.name}生${tiGua.name}，代表**對方生助我**。這意味著嫌犯或線索提供意外幫助，讓警方被動獲得突破。`;
        } else if (hexagramData.element_relations[yongElement].剋 === tiElement) {
            relationText = `${yongGua.name}剋${tiGua.name}，代表**對方克制我**。這意味著警方辦案受阻，嫌犯反制能力強，需謹慎應對。`;
        } else {
            relationText = `${tiGua.name}與${yongGua.name}為比和關係，代表雙方勢均力敵，案件將依常理發展。`;
        }

        let report = `
            <h3>數字起卦：${input}</h3>
            <p>本卦：<strong>${mainGuaName}</strong></p>
            <p>動爻：第<strong>${changingLine}</strong>爻</p>
            <p>變卦：<strong>${changedGuaName}</strong></p>
            
            <hr>
            
            <h4>案件核心分析</h4>
            <p>本卦**${mainGuaName}**，其象徵意義為：「${mainGuaSummary}」</p>
            <p>互卦為**${interGuaName}**，暗示案件的隱藏情況或未來走向可能與此卦象有關。</p>
            
            <h4>案件發展與轉折</h4>
            <p>動爻為**第 ${changingLine} 爻**，代表：「${hexagramData.line_summary[changingLine]}」</p>
            <p>變卦**${changedGuaName}**，其象徵意義為：「${changedGuaSummary}」</p>
            
            <h4>嫌犯與線索分析</h4>
            <ul>
                <li>**嫌犯特徵：** 根據上卦「${upperGua.name}」與下卦「${lowerGua.name}」，嫌犯可能具有**${upperGua.feature}**或**${lowerGua.feature}**的特徵。</li>
                <li>**線索方位：** 關鍵線索可能位於**${lowerGua.direction}**方，嫌犯可能藏匿在**${upperGua.direction}**方。</li>
                <li>**體用生剋：** ${relationText}</li>
            </ul>
        `;

        document.getElementById('resultArea').innerHTML = report;
        document.getElementById('resultArea').style.display = 'flex';
    }
</script>

</body>
</html>
