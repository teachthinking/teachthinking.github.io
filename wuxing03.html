<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>梅花心易卜卦與解卦程式</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", "Heiti TC", sans-serif;
        }
        
        body {
            background-color: #f9f5eb;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #8e7d5b 0%, #c9ad7a 100%);
            border-radius: 10px;
            color: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .description {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #f0e6d2;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .divination-section {
            flex: 1;
            min-width: 300px;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .result-section {
            flex: 2;
            min-width: 300px;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        h2 {
            color: #8e7d5b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8dbc5;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #666;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #8e7d5b 0%, #c9ad7a 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        button:hover {
            background: linear-gradient(135deg, #7a6b4e 0%, #b09868 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .random-btn {
            background: linear-gradient(135deg, #6b7d8e 0%, #7a9cc9 100%);
        }
        
        .random-btn:hover {
            background: linear-gradient(135deg, #5b6b7a 0%, #6888b0 100%);
        }
        
        .result-content {
            padding: 20px;
            background-color: #f8f4e9;
            border-radius: 8px;
            min-height: 200px;
        }
        
        .combination {
            font-weight: bold;
            color: #8e7d5b;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .interpretation {
            font-size: 1.1rem;
            line-height: 1.8;
            padding: 15px;
            background-color: #fff;
            border-left: 4px solid #c9ad7a;
            border-radius: 4px;
            white-space: pre-line;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #8e7d5b;
        }
        
        .gua-info {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .gua-item {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 15px;
            margin: 10px;
            background: #f3eee2;
            border-radius: 8px;
        }
        
        .gua-title {
            font-weight: bold;
            color: #8e7d5b;
            margin-bottom: 10px;
        }
        
        .gua-value {
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #888;
            font-size: 0.9rem;
        }
        
        .method-selector {
            margin-bottom: 20px;
        }
        
        .method-tab {
            display: none;
        }
        
        .method-tab.active {
            display: block;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #e8dbc5;
        }
        
        .tab-btn {
            padding: 10px 15px;
            background: #f3eee2;
            border: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            margin-right: 5px;
            font-weight: bold;
            color: #8e7d5b;
        }
        
        .tab-btn.active {
            background: #8e7d5b;
            color: white;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .gua-info {
                flex-direction: column;
            }
            
            .tab-buttons {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>梅花心易卜卦與解卦程式</h1>
        <p class="description">根據五行生克關係，解析卦象的吉凶變化</p>
    </header>
    
    <div class="container">
        <section class="divination-section">
            <h2>卜卦區</h2>
            
            <div class="method-selector">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="direct">直接取卦</button>
                    <button class="tab-btn" data-tab="time">時間取卦</button>
                    <button class="tab-btn" data-tab="number">數字取卦</button>
                </div>
                
                <div class="method-tab active" id="direct-tab">
                    <div class="input-group">
                        <label for="shang-gua">上卦（1-8）：</label>
                        <select id="shang-gua">
                            <option value="1">1 - 乾卦 (金)</option>
                            <option value="2" selected>2 - 兌卦 (金)</option>
                            <option value="3">3 - 離卦 (火)</option>
                            <option value="4">4 - 震卦 (木)</option>
                            <option value="5">5 - 巽卦 (木)</option>
                            <option value="6">6 - 坎卦 (水)</option>
                            <option value="7">7 - 艮卦 (土)</option>
                            <option value="8">8 - 坤卦 (土)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="xia-gua">下卦（1-8）：</label>
                        <select id="xia-gua">
                            <option value="1">1 - 乾卦 (金)</option>
                            <option value="2">2 - 兌卦 (金)</option>
                            <option value="3" selected>3 - 離卦 (火)</option>
                            <option value="4">4 - 震卦 (木)</option>
                            <option value="5">5 - 巽卦 (木)</option>
                            <option value="6">6 - 坎卦 (水)</option>
                            <option value="7">7 - 艮卦 (土)</option>
                            <option value="8">8 - 坤卦 (土)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="moving-yao">變爻（1-6）：</label>
                        <select id="moving-yao">
                            <option value="1" selected>1 - 初爻</option>
                            <option value="2">2 - 二爻</option>
                            <option value="3">3 - 三爻</option>
                            <option value="4">4 - 四爻</option>
                            <option value="5">5 - 五爻</option>
                            <option value="6">6 - 上爻</option>
                        </select>
                    </div>
                </div>
                
                <div class="method-tab" id="time-tab">
                    <div class="input-group">
                        <label for="year">年份：</label>
                        <input type="number" id="year" min="1900" max="2100" value="2025">
                    </div>
                    
                    <div class="input-group">
                        <label for="month">月份：</label>
                        <input type="number" id="month" min="1" max="12" value="9">
                    </div>
                    
                    <div class="input-group">
                        <label for="day">日期：</label>
                        <input type="number" id="day" min="1" max="31" value="4">
                    </div>
                    
                    <div class="input-group">
                        <label for="hour">時辰（0-23）：</label>
                        <input type="number" id="hour" min="0" max="23" value="1">
                    </div>
                    
                    <button id="use-current-time">使用當前時間</button>
                </div>
                
                <div class="method-tab" id="number-tab">
                    <div class="input-group">
                        <label for="number1">第一個數字（百位數）：</label>
                        <input type="number" id="number1" min="100" max="999" value="357">
                    </div>
                    
                    <div class="input-group">
                        <label for="number2">第二個數字（百位數）：</label>
                        <input type="number" id="number2" min="100" max="999" value="482">
                    </div>
                    
                    <div class="input-group">
                        <label for="number3">第三個數字（百位數）：</label>
                        <input type="number" id="number3" min="100" max="999" value="619">
                    </div>
                </div>
            </div>
            
            <button id="calculate-btn">開始卜卦</button>
            <button id="random-btn" class="random-btn">隨機卜卦</button>
        </section>
        
        <section class="result-section">
            <h2>解卦結果</h2>
            <div class="result-content">
                <div class="loading" id="result-loading">請選擇取卦方式並點擊"開始卜卦"按鈕獲取結果</div>
                <div id="result" style="display: none;">
                    <div class="combination" id="combination"></div>
                    <div class="interpretation" id="interpretation"></div>
                    
                    <div class="gua-info">
                        <div class="gua-item">
                            <div class="gua-title">本卦</div>
                            <div class="gua-value" id="ben-gua"></div>
                        </div>
                        <div class="gua-item">
                            <div class="gua-title">互卦</div>
                            <div class="gua-value" id="hu-gua"></div>
                        </div>
                        <div class="gua-item">
                            <div class="gua-title">變卦</div>
                            <div class="gua-value" id="bian-gua"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <footer>
        <p>梅花心易卜卦程式 &copy; 2025 - 基於五行生克關係的易經占卜工具</p>
    </footer>

    <script>
            "SK,WS,WK": "初始辛苦，但有望成功，過程中得到幫助，最終結果凶險。整體小吉。\n\n初辛中助，末路多艱\n外力難挽，內修自強\n韜光養晦，以待時機\n守得雲開，自見月明",
        "SK,WS,SS": "初始辛苦，但有望成功，過程中得到幫助，最終付出多收穫少。整體小吉。\n\n初辛中助，末勞少獲\n勤儉持家，細水長流\n知足常樂，隨遇而安\n福雖遲來，終將降至",
        "SK,WS,SK": "初始辛苦，但有望成功，過程中得到幫助，最終通過努力成功。整體大吉。\n\n初辛中助，末靠自強\n逆水行舟，不進則退\n堅持不懈，終抵彼岸\n功成名就，福壽雙全",
        "SK,WS,BH": "初始辛苦，但有望成功，過程中得到幫助，最終平穩。整體大吉。\n\n初辛中助，末歸平靜\n以柔克剛，以靜制動\n平和處世，安康長久\n轉危為安，化險為夷",
        "SK,WK,WS": "初始辛苦，但有望成功，過程中遇到阻礙，最終結果吉利。整體小吉。\n\n初辛中阻，末得吉慶\n逆水行舟，不進則退\n堅持不懈，終抵彼岸\n雨過天晴，見虹萬里",
        "SK,WK,WK": "初始辛苦，但有望成功，過程中遇到阻礙，最終結果凶險。整體小凶。\n\n初辛中阻，末路多艱\n暗流潛藏，謹言慎行\n韜光養晦，以待時機\n守得雲開，自見月明",
        "SK,WK,SS": "初始辛苦，但有望成功，過程中遇到阻礙，最終付出多收穫少。整體小凶。\n\n初辛中阻，末勞少獲\n勤儉持家，細水長流\n知足常樂，隨遇而安\n福雖遲來，終將降至",
        "SK,WK,SK": "初始辛苦，但有望成功，過程中遇到阻礙，最終通過努力成功。整體小吉。\n\n初辛中阻，末靠自強\n鐵杵磨針，功到自成\n逆水行舟，不進則退\n堅持不懈，終抵彼岸",
        "SK,WK,BH": "初始辛苦，但有望成功，過程中遇到阻礙，最終平穩。整體小吉。\n\n初辛中阻，末歸平靜\n以柔克剛，以靜制動\n平和處世，安康長久\n轉危為安，化險為夷",
        "SK,SS,WS": "初始辛苦，但有望成功，過程中付出努力，最終結果吉利。整體小吉。\n\n初辛中奮，末得吉慶\n勤耕不輟，碩果累累\n天道酬勤，人道酬善\n春華秋實，福運綿長",
        "SK,SS,WK": "初始辛苦，但有望成功，過程中付出努力，最終結果凶險。整體小凶。\n\n初辛中奮，末路多艱\n勞而少功，時運未濟\n韜光養晦，靜待時機\n積蓄力量，東山再起",
        "SK,SS,SS": "初始辛苦，但有望成功，過程中付出努力，最終付出多收穫少。整體小凶。\n\n初辛中奮，末得薄收\n勤儉持家，細水長流\n知足常樂，隨遇而安\n福雖遲來，終將降至",
        "SK,SS,SK": "初始辛苦，但有望成功，過程中付出努力，最終通過努力成功。整體小吉。\n\n初辛中奮，末靠自強\n精衛填海，愚公移山\n堅持不懈，終有所成\n功成名就，福壽雙全",
        "SK,SS,BH": "初始辛苦，但有望成功，過程中付出努力，最終平穩。整體小吉。\n\n初辛中奮，末歸平靜\n平和安泰，穩健前行\n知足常樂，心安理得\n平淡是真，安康是福",
        "SK,SK,WS": "初始辛苦，但有望成功，過程中克服困難，最終結果吉利。整體大吉。\n\n初辛中克，末得大成\n披荆斩棘，終見坦途\n勇者無懼，智者無憂\n成就偉業，名揚四方",
        "SK,SK,WK": "初始辛苦，但有望成功，過程中克服困難，最終結果凶險。整體小吉。\n\n初辛中克，末路艱辛\n逆水行舟，不進則退\n堅守正道，不忘初心\n黑暗過後，必見曙光",
        "SK,SK,SS": "初始辛苦，但有望成功，過程中克服困難，最終付出多收穫少。整體小吉。\n\n初辛中克，末勞少獲\n耕耘雖苦，天道酬勤\n積少成多，聚沙成塔\n堅持不懈，終有回報",
        "SK,SK,SK": "初始辛苦，但有望成功，過程中克服困難，最終通過努力成功。整體大吉。\n\n初辛中克，末靠自強\n千錘百煉，終成利器\n風雨過後，見彩虹美\n成就非凡，福澤綿長",
        "SK,SK,BH": "初始辛苦，但有望成功，過程中克服困難，最終平穩。整體大吉。\n\n初辛中克，末歸平靜\n穩健前行，安泰無憂\n以剛克柔，以動制靜\n平衡陰陽，福壽安康",
        "SK,BH,WS": "初始辛苦，但有望成功，過程平穩，最終結果吉利。整體大吉。\n\n初辛中平，末得圓滿\n穩中求進，順水行舟\n平和安泰，福運自來\n吉祥如意，萬事順遂",
        "SK,BH,WK": "初始辛苦，但有望成功，過程平穩，最終結果凶險。整體小吉。\n\n初辛中平，末路多艱\n居安思危，未雨綢繆\n以靜制動，以守為攻\n轉危為安，化險為夷",
        "SK,BH,SS": "初始辛苦，但有望成功，過程平穩，最終付出多收穫少。整體小吉。\n\n初辛中平，末勞少獲\n知足常樂，隨遇而安\n勤儉持家，細水長流\n福雖遲來，終將降至",
        "SK,BH,SK": "初始辛苦，但有望成功，過程平穩，最終通過努力成功。整體大吉。\n\n初辛中平，末靠自強\n穩中求進，勤能補拙\n堅持不懈，終有所成\n功成名就，福壽雙全",
        "SK,BH,BH": "初始辛苦，但有望成功，過程平穩，最終平穩。整體大吉。\n\n初辛中平，末歸平靜\n四平八穩，安泰無憂\n平和處世，安康長久\n福澤綿延，吉祥如意",
        "BH,WS,WS": "初始平和，過程中得到幫助，最終結果吉利。整體大吉。\n\n初平中助，末得吉慶\n穩中得助，順水行舟\n平和安泰，福運自來\n吉祥如意，萬事順遂",
        "BH,WS,WK": "初始平和，過程中得到幫助，最終結果凶險。整體小吉。\n\n初平中助，末路多艱\n居安思危，未雨綢繆\n以靜制動，以守為攻\n轉危為安，化險為夷",
        "BH,WS,SS": "初始平和，過程中得到幫助，最終付出多收穫少。整體小吉。\n\n初平中助，末勞少獲\n知足常樂，隨遇而安\n勤儉持家，細水長流\n福雖遲來，終將降至",
        "BH,WS,SK": "初始平和，過程中得到幫助，最終通過努力成功。整體大吉。\n\n初平中助，末靠自強\n穩中求進，勤能補拙\n堅持不懈，終有所成\n功成名就，福壽雙全",
        "BH,WS,BH": "初始平和，過程中得到幫助，最終平穩。整體大吉。\n\n初平中助，末歸平靜\n四平八穩，安泰無憂\n平和處世，安康長久\n福澤綿延，吉祥如意",
        "BH,WK,WS": "初始平和，過程中遇到阻礙，最終結果吉利。整體小吉。\n\n初平中阻，末得吉慶\n逆水行舟，不進則退\n堅持不懈，終抵彼岸\n雨過天晴，見虹萬里",
        "BH,WK,WK": "初始平和，過程中遇到阻礙，最終結果凶險。整體小凶。\n\n初平中阻，末路多艱\n暗流潛藏，謹言慎行\n韜光養晦，以待時機\n守得雲開，自見月明",
        "BH,WK,SS": "初始平和，過程中遇到阻礙，最終付出多收穫少。整體小凶。\n\n初平中阻，末勞少獲\n勤儉持家，細水長流\n知足常樂，隨遇而安\n福雖遲來，終將降至",
        "BH,WK,SK": "初始平和，過程中遇到阻礙，最終通過努力成功。整體小吉。\n\n初平中阻，末靠自強\n鐵杵磨針，功到自成\n逆水行舟，不進則退\n堅持不懈，終抵彼岸",
        "BH,WK,BH": "初始平和，過程中遇到阻礙，最終平穩。整體小吉。\n\n初平中阻，末歸平靜\n以柔克剛，以靜制動\n平和處世，安康長久\n轉危為安，化險為夷",
        "BH,SS,WS": "初始平和，過程中付出努力，最終結果吉利。整體小吉。\n\n初平中奮，末得吉慶\n勤耕不輟，碩果累累\n天道酬勤，人道酬善\n春華秋實，福運綿長",
        "BH,SS,WK": "初始平和，過程中付出努力，最終結果凶險。整體小凶。\n\n初平中奮，末路多艱\n勞而少功，時運未濟\n韜光養晦，靜待時機\n積蓄力量，東山再起",
        "BH,SS,SS": "初始平和，過程中付出努力，最終付出多收穫少。整體小凶。\n\n初平中奮，末得薄收\n勤儉持家，細水長流\n知足常樂，隨遇而安\n福雖遲來，終將降至",
        "BH,SS,SK": "初始平和，過程中付出努力，最終通過努力成功。整體小吉。\n\n初平中奮，末靠自強\n精衛填海，愚公移山\n堅持不懈，終有所成\n功成名就，福壽雙全",
        "BH,SS,BH": "初始平和，過程中付出努力，最終平穩。整體小吉。\n\n初平中奮，末歸平靜\n平和安泰，穩健前行\n知足常樂，心安理得\n平淡是真，安康是福",
        "BH,SK,WS": "初始平和，過程中克服困難，最終結果吉利。整體大吉。\n\n初平中克，末得大成\n披荆斩棘，終見坦途\n勇者無懼，智者無憂\n成就偉業，名揚四方",
        "BH,SK,WK": "初始平和，過程中克服困難，最終結果凶險。整體小吉。\n\n初平中克，末路艱辛\n逆水行舟，不進則退\n堅守正道，不忘初心\n黑暗過後，必見曙光",
        "BH,SK,SS": "初始平和，過程中克服困難，最終付出多收穫少。整體小吉。\n\n初平中克，末勞少獲\n耕耘雖苦，天道酬勤\n積少成多，聚沙成塔\n堅持不懈，終有回報",
        "BH,SK,SK": "初始平和，過程中克服困難，最終通過努力成功。整體大吉。\n\n初平中克，末靠自強\n千錘百煉，終成利器\n風雨過後，見彩虹美\n成就非凡，福澤綿長",
        "BH,SK,BH": "初始平和，過程中克服困難，最終平穩。整體大吉。\n\n初平中克，末歸平靜\n穩健前行，安泰無憂\n以剛克柔，以動制靜\n平衡陰陽，福壽安康",
        "BH,BH,WS": "初始平和，過程平穩，最終結果吉利。整體大吉。\n\n初平中平，末得圓滿\n四平八穩，安泰無憂\n平和處世，安康長久\n福澤綿延，吉祥如意",
        "BH,BH,WK": "初始平和，過程平穩，最終結果凶險。整體小吉。\n\n初平中平，末路多艱\n居安思危，未雨綢繆\n以靜制動，以守為攻\n轉危為安，化險為夷",
        "BH,BH,SS": "初始平和，過程平穩，最終付出多收穫少。整體小吉。\n\n初平中平，末勞少獲\n知足常樂，隨遇而安\n勤儉持家，細水長流\n福雖遲來，終將降至",
        "BH,BH,SK": "初始平和，過程平穩，最終通過努力成功。整體大吉。\n\n初平中平，末靠自強\n穩中求進，勤能補拙\n堅持不懈，終有所成\n功成名就，福壽雙全",
        "BH,BH,BH": "初始平和，過程平穩，最終平穩。整體大吉。\n\n初平中平，末歸平靜\n四時和順，八節安康\n陰陽調和，萬物生長\n福壽雙全，吉祥如意"
    };
    // 八卦對應數字和爻象（從下到上）
    const trigrams = {
        1: {"name": "乾", "element": "金", "yao": [1, 1, 1]},
        2: {"name": "兌", "element": "金", "yao": [1, 1, 0]},
        3: {"name": "離", "element": "火", "yao": [1, 0, 1]},
        4: {"name": "震", "element": "木", "yao": [1, 0, 0]},
        5: {"name": "巽", "element": "木", "yao": [0, 1, 1]},
        6: {"name": "坎", "element": "水", "yao": [0, 1, 0]},
        7: {"name": "艮", "element": "土", "yao": [0, 0, 1]},
        8: {"name": "坤", "element": "土", "yao": [0, 0, 0]}
    };

    // 五行生克關係
    const elementRelations = {
        "金": { "克": "木", "生": "水", "被克": "火", "被生": "土" },
        "木": { "克": "土", "生": "火", "被克": "金", "被生": "水" },
        "水": { "克": "火", "生": "木", "被克": "土", "被生": "金" },
        "火": { "克": "金", "生": "土", "被克": "水", "被生": "木" },
        "土": { "克": "水", "生": "金", "被克": "木", "被生": "火" }
    };

    // 季節與五行旺相休囚死對應表（以公曆月份簡化判斷）
    const seasonElementStatus = {
        // 春季（2月4日-5月4日，木旺，火相，水休，金囚，土死）
        spring: { "木": "旺", "火": "相", "水": "休", "金": "囚", "土": "死" },
        // 夏季（5月5日-8月6日，火旺，土相，木休，水囚，金死）
        summer: { "火": "旺", "土": "相", "木": "休", "水": "囚", "金": "死" },
        // 秋季（8月7日-11月6日，金旺，水相，土休，火囚，木死）
        autumn: { "金": "旺", "水": "相", "土": "休", "火": "囚", "木": "死" },
        // 冬季（11月7日-2月3日，水旺，木相，金休，土囚，火死）
        winter: { "水": "旺", "木": "相", "金": "休", "土": "囚", "火": "死" }
    };

    // 根據日期判斷季節
    function getSeason(date) {
        const month = date.getMonth() + 1; // 1-12
        const day = date.getDate();
        
        if ((month === 2 && day >= 4) || (month === 3) || (month === 4) || (month === 5 && day <= 4)) {
            return 'spring';
        } else if ((month === 5 && day >= 5) || (month === 6) || (month === 7) || (month === 8 && day <= 6)) {
            return 'summer';
        } else if ((month === 8 && day >= 7) || (month === 9) || (month === 10) || (month === 11 && day <= 6)) {
            return 'autumn';
        } else {
            return 'winter';
        }
    }

    // 計算五行生克關係並標註旺相休囚死狀態
    function calculateRelation(gua) {
        const shangElement = trigrams[gua.shang].element; // 上卦（體）
        const xiaElement = trigrams[gua.xia].element;     // 下卦（用）
        const currentDate = new Date();
        const season = getSeason(currentDate);
        const elementStatus = seasonElementStatus[season];
        
        const shangStatus = elementStatus[shangElement]; // 體的五行狀態
        const xiaStatus = elementStatus[xiaElement];     // 用的五行狀態
        
        let relation;
        if (shangElement === xiaElement) {
            relation = "體用比和";
        } else if (elementRelations[shangElement]["生"] === xiaElement) {
            relation = `體${shangStatus}生用${xiaStatus}`;
        } else if (elementRelations[shangElement]["克"] === xiaElement) {
            relation = `體${shangStatus}克用${xiaStatus}`;
        } else if (elementRelations[xiaElement]["生"] === shangElement) {
            relation = `用${xiaStatus}生體${shangStatus}`;
        } else if (elementRelations[xiaElement]["克"] === shangElement) {
            relation = `用${xiaStatus}克體${shangStatus}`;
        } else {
            relation = "體用比和";
        }
        
        return relation;
    }

    // 根據三爻查找對應的卦
    function findTrigramByYao(yaoArray) {
        for (const [key, value] of Object.entries(trigrams)) {
            if (JSON.stringify(value.yao) === JSON.stringify(yaoArray)) {
                return parseInt(key);
            }
        }
        return 1; // 默認返回乾卦
    }

    // 計算互卦
    function calculateHuGua(benGua) {
        const xiaYao = [...trigrams[benGua.xia].yao];
        const shangYao = [...trigrams[benGua.shang].yao];
        const sixYao = [...xiaYao, ...shangYao];
        const huXiaYao = [sixYao[1], sixYao[2], sixYao[3]];
        const huShangYao = [sixYao[2], sixYao[3], sixYao[4]];
        return {
            shang: findTrigramByYao(huShangYao),
            xia: findTrigramByYao(huXiaYao)
        };
    }

    // 計算變卦
    function calculateBianGua(benGua, movingYao) {
        const xiaYao = [...trigrams[benGua.xia].yao];
        const shangYao = [...trigrams[benGua.shang].yao];
        const sixYao = [...xiaYao, ...shangYao];
        const yaoIndex = movingYao - 1;
        sixYao[yaoIndex] = sixYao[yaoIndex] === 1 ? 0 : 1;
        const bianXiaYao = sixYao.slice(0, 3);
        const bianShangYao = sixYao.slice(3, 6);
        return {
            shang: findTrigramByYao(bianShangYao),
            xia: findTrigramByYao(bianXiaYao)
        };
    }

    document.addEventListener('DOMContentLoaded', function() {
        const calculateBtn = document.getElementById('calculate-btn');
        const randomBtn = document.getElementById('random-btn');
        const useCurrentTimeBtn = document.getElementById('use-current-time');
        const resultLoading = document.getElementById('result-loading');
        const resultDiv = document.getElementById('result');
        const combinationDiv = document.getElementById('combination');
        const interpretationDiv = document.getElementById('interpretation');
        const benGuaDiv = document.getElementById('ben-gua');
        const huGuaDiv = document.getElementById('hu-gua');
        const bianGuaDiv = document.getElementById('bian-gua');
        const tabBtns = document.querySelectorAll('.tab-btn');
        
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                tabBtns.forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.method-tab').forEach(tab => tab.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        useCurrentTimeBtn.addEventListener('click', function() {
            const now = new Date();
            document.getElementById('year').value = now.getFullYear();
            document.getElementById('month').value = now.getMonth() + 1;
            document.getElementById('day').value = now.getDate();
            document.getElementById('hour').value = now.getHours();
        });
        
        calculateBtn.addEventListener('click', calculateDivination);
        randomBtn.addEventListener('click', generateRandomNumbers);
        
        function calculateDivination() {
            const activeTab = document.querySelector('.method-tab.active').id;
            let shangGua, xiaGua, movingYao;
            
            if (activeTab === 'direct-tab') {
                shangGua = parseInt(document.getElementById('shang-gua').value);
                xiaGua = parseInt(document.getElementById('xia-gua').value);
                movingYao = parseInt(document.getElementById('moving-yao').value);
            } 
            else if (activeTab === 'time-tab') {
                const year = parseInt(document.getElementById('year').value);
                const month = parseInt(document.getElementById('month').value);
                const day = parseInt(document.getElementById('day').value);
                const hour = parseInt(document.getElementById('hour').value);
                shangGua = (year + month + day) % 8;
                shangGua = shangGua === 0 ? 8 : shangGua;
                xiaGua = (year + month + day + hour) % 8;
                xiaGua = xiaGua === 0 ? 8 : xiaGua;
                movingYao = (year + month + day + hour) % 6;
                movingYao = movingYao === 0 ? 6 : movingYao;
            } 
            else if (activeTab === 'number-tab') {
                const num1 = parseInt(document.getElementById('number1').value);
                const num2 = parseInt(document.getElementById('number2').value);
                const num3 = parseInt(document.getElementById('number3').value);
                shangGua = num1 % 8;
                shangGua = shangGua === 0 ? 8 : shangGua;
                xiaGua = num2 % 8;
                xiaGua = xiaGua === 0 ? 8 : xiaGua;
                movingYao = num3 % 6;
                movingYao = movingYao === 0 ? 6 : movingYao;
            }
            
            if (shangGua < 1 || shangGua > 8 || xiaGua < 1 || xiaGua > 8 || movingYao < 1 || movingYao > 6) {
                alert('卦象計算錯誤，請檢查輸入參數');
                return;
            }
            
            resultLoading.style.display = 'block';
            resultDiv.style.display = 'none';
            
            setTimeout(() => {
                const benGua = { shang: shangGua, xia: xiaGua };
                const huGua = calculateHuGua(benGua);
                const bianGua = calculateBianGua(benGua, movingYao);
                
                const benRelation = calculateRelation(benGua);
                const huRelation = calculateRelation(huGua);
                const bianRelation = calculateRelation(bianGua);
                
                const combinationKey = `${benRelation},${huRelation},${bianRelation}`;
                
                combinationDiv.textContent = `五行生克分析: ${benRelation}, ${huRelation}, ${bianRelation}`;
                interpretationDiv.textContent = interpretations[combinationKey] || "未找到對應的解卦解釋";
                
                benGuaDiv.textContent = `${trigrams[benGua.shang].name}上${trigrams[benGua.xia].name}下 (${trigrams[benGua.shang].element}上${trigrams[benGua.xia].element}下)`;
                huGuaDiv.textContent = `${trigrams[huGua.shang].name}上${trigrams[huGua.xia].name}下 (${trigrams[huGua.shang].element}上${trigrams[huGua.xia].element}下)`;
                bianGuaDiv.textContent = `${trigrams[bianGua.shang].name}上${trigrams[bianGua.xia].name}下 (${trigrams[bianGua.shang].element}上${trigrams[bianGua.xia].element}下)`;
                
                resultLoading.style.display = 'none';
                resultDiv.style.display = 'block';
            }, 800);
        }
        
        function generateRandomNumbers() {
            const activeTab = document.querySelector('.method-tab.active').id;
            
            if (activeTab === 'direct-tab') {
                document.getElementById('shang-gua').value = Math.floor(Math.random() * 8) + 1;
                document.getElementById('xia-gua').value = Math.floor(Math.random() * 8) + 1;
                document.getElementById('moving-yao').value = Math.floor(Math.random() * 6) + 1;
            } 
            else if (activeTab === 'time-tab') {
                const now = new Date();
                document.getElementById('year').value = now.getFullYear();
                document.getElementById('month').value = now.getMonth() + 1;
                document.getElementById('day').value = now.getDate();
                document.getElementById('hour').value = now.getHours();
            } 
            else if (activeTab === 'number-tab') {
                document.getElementById('number1').value = Math.floor(Math.random() * 900) + 100;
                document.getElementById('number2').value = Math.floor(Math.random() * 900) + 100;
                document.getElementById('number3').value = Math.floor(Math.random() * 900) + 100;
            }
            
            calculateDivination();
        }
    </script>
</body>
</html>
