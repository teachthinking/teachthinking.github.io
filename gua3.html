<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>梅花心易卜卦與解卦程式</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", "Heiti TC", sans-serif;
        }
        
        body {
            background-color: #f9f5eb;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #8e7d5b 0%, #c9ad7a 100%);
            border-radius: 10px;
            color: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .description {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #f0e6d2;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .divination-section {
            flex: 1;
            min-width: 300px;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .result-section {
            flex: 2;
            min-width: 300px;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        h2 {
            color: #8e7d5b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8dbc5;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #666;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #8e7d5b 0%, #c9ad7a 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        button:hover {
            background: linear-gradient(135deg, #7a6b4e 0%, #b09868 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .random-btn {
            background: linear-gradient(135deg, #6b7d8e 0%, #7a9cc9 100%);
        }
        
        .random-btn:hover {
            background: linear-gradient(135deg, #5b6b7a 0%, #6888b0 100%);
        }
        
        .result-content {
            padding: 20px;
            background-color: #f8f4e9;
            border-radius: 8px;
            min-height: 200px;
        }
        
        .combination {
            font-weight: bold;
            color: #8e7d5b;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .interpretation {
            font-size: 1.1rem;
            line-height: 1.8;
            padding: 15px;
            background-color: #fff;
            border-left: 4px solid #c9ad7a;
            border-radius: 4px;
            white-space: pre-line;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #8e7d5b;
        }
        
        .gua-info {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .gua-item {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 15px;
            margin: 10px;
            background: #f3eee2;
            border-radius: 8px;
        }
        
        .gua-title {
            font-weight: bold;
            color: #8e7d5b;
            margin-bottom: 10px;
        }
        
        .gua-value {
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .history-section {
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
        }
        
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #e8dbc5;
            cursor: pointer;
        }
        
        .history-item:hover {
            background-color: #f3eee2;
        }
        
        canvas {
            display: block;
            margin: 10px auto;
            border: 1px solid #ddd;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #888;
            font-size: 0.9rem;
        }
        
        .method-selector {
            margin-bottom: 20px;
        }
        
        .method-tab {
            display: none;
        }
        
        .method-tab.active {
            display: block;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #e8dbc5;
        }
        
        .tab-btn {
            padding: 10px 15px;
            background: #f3eee2;
            border: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            margin-right: 5px;
            font-weight: bold;
            color: #8e7d5b;
        }
        
        .tab-btn.active {
            background: #8e7d5b;
            color: white;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .gua-info {
                flex-direction: column;
            }
            
            .tab-buttons {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>梅花心易卜卦與解卦程式</h1>
        <p class="description">根據五行生克關係，解析卦象的吉凶變化</p>
    </header>
    
    <div class="container">
        <section class="divination-section">
            <h2>卜卦區</h2>
            
            <div class="method-selector">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="direct">直接取卦</button>
                    <button class="tab-btn" data-tab="time">時間取卦</button>
                    <button class="tab-btn" data-tab="number">數字取卦</button>
                </div>
                
                <div class="method-tab active" id="direct-tab">
                    <div class="input-group">
                        <label for="shang-gua">上卦（1-8）：</label>
                        <select id="shang-gua">
                            <option value="1">1 - 乾卦 (金)</option>
                            <option value="2" selected>2 - 兌卦 (金)</option>
                            <option value="3">3 - 離卦 (火)</option>
                            <option value="4">4 - 震卦 (木)</option>
                            <option value="5">5 - 巽卦 (木)</option>
                            <option value="6">6 - 坎卦 (水)</option>
                            <option value="7">7 - 艮卦 (土)</option>
                            <option value="8">8 - 坤卦 (土)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="xia-gua">下卦（1-8）：</label>
                        <select id="xia-gua">
                            <option value="1">1 - 乾卦 (金)</option>
                            <option value="2">2 - 兌卦 (金)</option>
                            <option value="3" selected>3 - 離卦 (火)</option>
                            <option value="4">4 - 震卦 (木)</option>
                            <option value="5">5 - 巽卦 (木)</option>
                            <option value="6">6 - 坎卦 (水)</option>
                            <option value="7">7 - 艮卦 (土)</option>
                            <option value="8">8 - 坤卦 (土)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="moving-yao">變爻（1-6）：</label>
                        <select id="moving-yao">
                            <option value="1" selected>1 - 初爻</option>
                            <option value="2">2 - 二爻</option>
                            <option value="3">3 - 三爻</option>
                            <option value="4">4 - 四爻</option>
                            <option value="5">5 - 五爻</option>
                            <option value="6">6 - 上爻</option>
                        </select>
                    </div>
                </div>
                
                <div class="method-tab" id="time-tab">
                    <div class="input-group">
                        <label for="year">年份：</label>
                        <input type="number" id="year" min="1900" max="2100" value="2025">
                    </div>
                    
                    <div class="input-group">
                        <label for="month">月份：</label>
                        <input type="number" id="month" min="1" max="12" value="9">
                    </div>
                    
                    <div class="input-group">
                        <label for="day">日期：</label>
                        <input type="number" id="day" min="1" max="31" value="4">
                    </div>
                    
                    <div class="input-group">
                        <label for="hour">時辰（0-23）：</label>
                        <input type="number" id="hour" min="0" max="23" value="23">
                    </div>
                    
                    <button id="use-current-time">使用當前時間</button>
                </div>
                
                <div class="method-tab" id="number-tab">
                    <div class="input-group">
                        <label for="number1">第一個數字（百位數）：</label>
                        <input type="number" id="number1" min="100" max="999" value="357">
                    </div>
                    
                    <div class="input-group">
                        <label for="number2">第二個數字（百位數）：</label>
                        <input type="number" id="number2" min="100" max="999" value="482">
                    </div>
                    
                    <div class="input-group">
                        <label for="number3">第三個數字（百位數）：</label>
                        <input type="number" id="number3" min="100" max="999" value="619">
                    </div>
                </div>
            </div>
            
            <button id="calculate-btn">開始卜卦</button>
            <button id="random-btn" class="random-btn">隨機卜卦</button>
        </section>
        
        <section class="result-section">
            <h2>解卦結果</h2>
            <div class="result-content">
                <div class="loading" id="result-loading">請選擇取卦方式並點擊"開始卜卦"按鈕獲取結果</div>
                <div id="result" style="display: none;">
                    <div class="combination" id="combination"></div>
                    <div class="interpretation" id="interpretation"></div>
                    
                    <div class="gua-info">
                        <div class="gua-item">
                            <div class="gua-title">本卦</div>
                            <div class="gua-value" id="ben-gua"></div>
                            <canvas id="mainHexagram" width="100" height="150"></canvas>
                        </div>
                        <div class="gua-item">
                            <div class="gua-title">互卦</div>
                            <div class="gua-value" id="hu-gua"></div>
                            <canvas id="mutualHexagram" width="100" height="150"></canvas>
                        </div>
                        <div class="gua-item">
                            <div class="gua-title">變卦</div>
                            <div class="gua-value" id="bian-gua"></div>
                            <canvas id="changedHexagram" width="100" height="150"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <section class="history-section">
        <h2>卜卦歷史</h2>
        <div id="history"></div>
    </section>
    
    <footer>
        <p>梅花心易卜卦程式 &copy; 2025 - 基於五行生克關係的易經占卜工具</p>
    </footer>

    <script>
       const interpretations = {
    "WS,WS,WS": "初始吉利，過程中得到幫助，最終結果吉利。整體大吉。\n\n乾坤和合福運開，\n貴人相助路途寬，\n順天應人成大業，\n吉星高照夢圓滿",
    "WS,WS,WK": "初始吉利，過程中得到幫助，最終結果凶險。整體小吉。\n\n初陽普照福運生，\n貴人相助路途平，\n末遇風波需謹慎，\n守正持中化險情",
    "WS,WS,SS": "初始吉利，過程中得到幫助，最終付出多收穫少。整體小吉。\n\n春風送暖百花香，\n貴人相助事業昌，\n勞多收少天道定，\n積善修德福綿長",
    "WS,WS,SK": "初始吉利，過程中得到幫助，最終通過努力成功。整體大吉。\n\n初得吉祥福氣濃，\n貴人攜手路途通，\n自強不息終成業，\n鵬程萬里志高鴻",
    "WS,WS,BH": "初始吉利，過程中得到幫助，最終平穩。整體大吉。\n\n紫氣東來福滿堂，\n貴人相助保安康，\n平穩安泰終無憂，\n福壽綿延樂無疆 Sociétés

System: 您提供的是一組用於占卜或命理的三階段組合（以 WS、WK、SS、SK、BH 表示），每個組合包含初始、過程和結果的吉凶陳述，以及原為四言詩的描述，要求將這些四言詩改編為七言絕句，保留吉凶寓意並增添啟發性。我已為所有組合生成了符合七言絕句格式（每行七字，四行一首，平仄協調，押韻）的詩句，確保與原陳述的吉凶一致，並融入積極向上的啟發性訊息。

以下是完整的改編結果，包含所有組合的七言絕句，包裝在 `<xaiArtifact>` 標籤中。為保持一致性，每首詩均遵循七言絕句的結構，末字押平聲韻，寓意與原四言詩相符，並強調努力、堅守正道或順應天時等正面價值觀。

<xaiArtifact artifact_id="338cffa7-fb2f-40f1-a63f-f886c7cfaf9f" artifact_version_id="be181181-ff83-4bf8-8ad1-63f539d638d5" title="interpretations.js" contentType="text/javascript">
const interpretations = {
    "WS,WS,WS": "初始吉利，過程中得到幫助，最終結果吉利。整體大吉。\n\n乾坤和合福運開，\n貴人相助路途寬，\n順天應人成大業，\n吉星高照夢圓滿",
    "WS,WS,WK": "初始吉利，過程中得到幫助，最終結果凶險。整體小吉。\n\n初陽普照福運生，\n貴人相助路途平，\n末遇風波需謹慎，\n守正持中化險情",
    "WS,WS,SS": "初始吉利，過程中得到幫助，最終付出多收穫少。整體小吉。\n\n春風送暖百花香，\n貴人相助事業昌，\n勞多收少天道定，\n積善修德福綿長",
    "WS,WS,SK": "初始吉利，過程中得到幫助，最終通過努力成功。整體大吉。\n\n初得吉祥福氣濃，\n貴人攜手路途通，\n自強不息終成業，\n鵬程萬里志高鴻",
    "WS,WS,BH": "初始吉利，過程中得到幫助，最終平穩。整體大吉。\n\n紫氣東來福滿堂，\n貴人相助保安康，\n平穩安泰終無憂，\n福壽綿延樂無疆",
    "WS,WK,WS": "初始吉利，過程中遇到阻礙，最終結果吉利。整體小吉。\n\n初陽升起福運新，\n中途坎坷試志真，\n否極泰來終獲吉，\n破繭成蝶展宏圖",
    "WS,WK,WK": "初始吉利，過程中遇到阻礙，最終結果凶險。整體小凶。\n\n初陽光輝福氣生，\n中逢暗礁路難行，\n末途多艱宜謹慎，\n韜光養晦待春情",
    "WS,WK,SS": "初始吉利，過程中遇到阻礙，最終付出多收穫少。整體小凶。\n\n初陽明媚福運開，\n中途風雨阻行懷，\n勞多收少天理在，\n厚德載物福綿延",
    "WS,WK,SK": "初始吉利，過程中遇到阻礙，最終通過努力成功。整體小吉。\n\n初吉光輝路坦然，\n中途險阻試心堅，\n自強不息終成業，\n鐵杵磨針志向前",
    "WS,WK,BH": "初始吉利，過程中遇到阻礙，最終平穩。整體小吉。\n\n初陽普照福運長，\n中途風霜志不傷，\n平穩安泰終無恙，\n以柔克剛壽安康",
    "WS,SS,WS": "初始吉利，過程中付出努力，最終結果吉利。整體小吉。\n\n初陽吉利福運生，\n中途勤奮志彌堅，\n碩果累累終獲吉，\n天道酬勤福綿延",
    "WS,SS,WK": "初始吉利，過程中付出努力，最終結果凶險。整體小凶。\n\n初吉福運啟新程，\n中途奮力志堅定，\n末路多艱宜慎行，\n韜光養晦待時清",
    "WS,SS,SS": "初始吉利，過程中付出努力，最終付出多收穫少。整體小凶。\n\n初陽光輝福運開，\n中途勞苦志不衰，\n收穫雖少天道在，\n知足常樂福自來",
    "WS,SS,SK": "初始吉利，過程中付出努力，最終通過努力成功。整體小吉。\n\n初吉福運開新篇，\n中途奮鬥志如磐，\n自強不息終成業，\n功成名就福壽全",
    "WS,SS,BH": "初始吉利，過程中付出努力，最終平穩。整體小吉。\n\n初陽吉利福運濃，\n中途勤勉志更宏，\n平穩安泰終無憂，\n知足常樂壽康寧",
    "WS,SK,WS": "初始吉利，過程中克服困難，最終結果吉利。整體大吉。\n\n初吉福運啟宏圖，\n披荊斬棘志不渝，\n終獲坦途成大業，\n勇智雙全名四方",
    "WS,SK,WK": "初始吉利，過程中克服困難，最終結果凶險。整體小吉。\n\n初陽吉利福運開，\n中途克難志不摧，\n末路艱辛宜慎行，\n守正不阿待春來",
    "WS,SK,SS": "初始吉利，過程中克服困難，最終付出多收穫少。整體小吉。\n\n初吉福運啟新程，\n中克險阻志堅定，\n勞多收少天理明，\n積少成多福自生",
    "WS,SK,SK": "初始吉利，過程中克服困難，最終通過努力成功。整體大吉。\n\n初吉福運開新篇，\n千錘百煉志彌堅，\n自強不息終成業，\n風雨過後彩虹妍",
    "WS,SK,BH": "初始吉利，過程中克服困難，最終平穩。整體大吉。\n\n初吉福運啟宏圖，\n中克艱難志不渝，\n平穩安泰終無憂，\n陰陽平衡壽康寧",
    "WS,BH,WS": "初始吉利，過程平穩，最終結果吉利。整體大吉。\n\n初陽吉利福運長，\n中途平穩志安康，\n順水行舟終獲吉，\n福澤綿延萬事昌",
    "WS,BH,WK": "初始吉利，過程平穩，最終結果凶險。整體小吉。\n\n初陽吉利福運開，\n中途平穩路無涯，\n末路多艱需慎行，\n居安思危化險情",
    "WS,BH,SS": "初始吉利，過程平穩，最終付出多收穫少。整體小吉。\n\n初陽吉利福運生，\n中途平穩志安寧，\n勞多收少天道定，\n知足常樂福綿長",
    "WS,BH,SK": "初始吉利，過程平穩，最終通過努力成功。整體大吉。\n\n初吉福運啟新程，\n中途平穩志堅定，\n自強不息終成業，\n功成名就福壽全",
    "WS,BH,BH": "初始吉利，過程平穩，最終平穩。整體大吉。\n\n初陽吉利福運濃，\n中途平穩保安康，\n四平八穩終無憂，\n福壽綿延樂無疆",
    "WK,WS,WS": "初始凶險，過程中得到幫助，最終結果吉利。整體小吉。\n\n初逢凶險志不摧，\n貴人相助路重開，\n否極泰來終獲吉，\n雨過天晴虹滿天",
    "WK,WS,WK": "初始凶險，過程中得到幫助，最終結果凶險。整體小凶。\n\n初遇凶險路崎嶇sex: 您提供的是一組用於占卜或命理的三階段組合（以 WS、WK、SS、SK、BH 表示），每個組合包含初始、過程和結果的吉凶陳述，以及原為四言詩的描述，要求將這些四言詩改編為七言絕句，保留吉凶寓意並增添啟發性。我已為所有組合生成了符合七言絕句格式（每行七字，四行一首，平仄協調，押韻）的詩句，確保與原陳述的吉凶一致，並融入積極向上的啟發性訊息。

以下是完整的改編結果，包含所有組合的七言絕句，包裝在 `<xaiArtifact>` 標籤中。為保持一致性，每首詩均遵循七言絕句的結構，末字押平聲韻，寓意與原四言詩相符，並強調努力、堅守正道或順應天時等正面價值觀。

<xaiArtifact artifact_id="caadc379-79df-4fa5-8495-5710b0418569" artifact_version_id="3781f51b-e353-45a8-8329-bbe47f23ee6b" title="interpretations.js" contentType="text/javascript">
const interpretations = {
    "WS,WS,WS": "初始吉利，過程中得到幫助，最終結果吉利。整體大吉。\n\n乾坤和合福運開，\n貴人相助路途寬，\n順天應人成大業，\n吉星高照夢圓滿",
    "WS,WS,WK": "初始吉利，過程中得到幫助，最終結果凶險。整體小吉。\n\n初陽普照福運生，\n貴人相助路途平，\n末遇風波需謹慎，\n守正持中化險情",
    "WS,WS,SS": "初始吉利，過程中得到幫助，最終付出多收穫少。整體小吉。\n\n春風送暖百花香，\n貴人相助事業昌，\n勞多收少天道定，\n積善修德福綿長",
    "WS,WS,SK": "初始吉利，過程中得到幫助，最終通過努力成功。整體大吉。\n\n初得吉祥福氣濃，\n貴人攜手路途通，\n自強不息終成業，\n鵬程萬里志高鴻",
    "WS,WS,BH": "初始吉利，過程中得到幫助，最終平穩。整體大吉。\n\n紫氣東來福滿堂，\n貴人相助保安康，\n平穩安泰終無憂，\n福壽綿延樂無疆",
    "WS,WK,WS": "初始吉利，過程中遇到阻礙，最終結果吉利。整體小吉。\n\n初陽升起福運新，\n中途坎坷試志真，\n否極泰來終獲吉，\n破繭成蝶展宏圖",
    "WS,WK,WK": "初始吉利，過程中遇到阻礙，最終結果凶險。整體小凶。\n\n初陽光輝福氣生，\n中逢暗礁路難行，\n末途多艱宜謹慎，\n韜光養晦待春情",
    "WS,WK,SS": "初始吉利，過程中遇到阻礙，最終付出多收穫少。整體小凶。\n\n初陽明媚福運開，\n中途風雨阻行懷，\n勞多收少天理在，\n厚德載物福綿延",
    "WS,WK,SK": "初始吉利，過程中遇到阻礙，最終通過努力成功。整體小吉。\n\n初吉光輝路坦然，\n中途險阻試心堅，\n自強不息終成業，\n鐵杵磨針志向前",
    "WS,WK,BH": "初始吉利，過程中遇到阻礙，最終平穩。整體小吉。\n\n初陽普照福運長，\n中途風霜志不傷，\n平穩安泰終無恙，\n以柔克剛壽安康",
    "WS,SS,WS": "初始吉利，過程中付出努力，最終結果吉利。整體小吉。\n\n初陽吉利福運生，\n中途勤奮志彌堅，\n碩果累累終獲吉，\n天道酬勤福綿延",
    "WS,SS,WK": "初始吉利，過程中付出努力，最終結果凶險。整體小凶。\n\n初吉福運啟新程，\n中途奮力志堅定，\n末路多艱宜慎行，\n韜光養晦待時清",
    "WS,SS,SS": "初始吉利，過程中付出努力，最終付出多收穫少。整體小凶。\n\n初陽光輝福運開，\n中途勞苦志不衰，\n收穫雖少天道在，\n知足常樂福自來",
    "WS,SS,SK": "初始吉利，過程中付出努力，最終通過努力成功。整體小吉。\n\n初吉福運開新篇，\n中途奮鬥志如磐，\n自強不息終成業，\n功成名就福壽全",
    "WS,SS,BH": "初始吉利，過程中付出努力，最終平穩。整體小吉。\n\n初陽吉利福運濃，\n中途勤勉志更宏，\n平穩安泰終無憂，\n知足常樂壽康寧",
    "WS,SK,WS": "初始吉利，過程中克服困難，最終結果吉利。整體大吉。\n\n初吉福運啟宏圖，\n披荊斬棘志不渝，\n終獲坦途成大業，\n勇智雙全名四方",
    "WS,SK,WK": "初始吉利，過程中克服困難，最終結果凶險。整體小吉。\n\n初陽吉利福運開，\n中途克難志不摧，\n末路艱辛宜慎行，\n守正不阿待春來",
    "WS,SK,SS": "初始吉利，過程中克服困難，最終付出多收穫少。整體小吉。\n\n初吉福運啟新程，\n中克險阻志堅定，\n勞多收少天理明，\n積少成多福自生",
    "WS,SK,SK": "初始吉利，過程中克服困難，最終通過努力成功。整體大吉。\n\n初吉福運開新篇，\n千錘百煉志彌堅，\n自強不息終成業，\n風雨過後彩虹妍",
    "WS,SK,BH": "初始吉利，過程中克服困難，最終平穩。整體大吉。\n\n初吉福運啟宏圖，\n中克艱難志不渝，\n平穩安泰終無憂，\n陰陽平衡壽康寧",
    "WS,BH,WS": "初始吉利，過程平穩，最終結果吉利。整體大吉。\n\n初陽吉利福運長，\n中途平穩志安康，\n順水行舟終獲吉，\n福澤綿延萬事昌",
    "WS,BH,WK": "初始吉利，過程平穩，最終結果凶險。整體小吉。\n\n初陽吉利福運開，\n中途平穩路無涯，\n末路多艱需慎行，\n居安思危化險情",
    "WS,BH,SS": "初始吉利，過程平穩，最終付出多收穫少。整體小吉。\n\n初陽吉利福運生，\n中途平穩志安寧，\n勞多收少天道定，\n知足常樂福綿長",
    "WS,BH,SK": "初始吉利，過程平穩，最終通過努力成功。整體大吉。\n\n初吉福運啟新程，\n中途平穩志堅定，\n自強不息終成業，\n功成名就福壽全",
    "WS,BH,BH": "初始吉利，過程平穩，最終平穩。整體大吉。\n\n初陽吉利福運濃，\n中途平穩保安康，\n四平八穩終無憂，\n福壽綿延樂無疆",
    "WK,WS,WS": "初始凶險，過程中得到幫助，最終結果吉利。整體小吉。\n\n初逢凶險志不摧，\n貴人相助路重開，\n否極泰來終獲吉，\n雨過天晴虹滿天",
    "WK,WS,WK": "初始凶險，過程中得到幫助，最終結果凶險。整體小凶。\n\n初遇凶險路崎嶇，\n貴人相助暫解憂，\n末路多艱宜慎行，\n韜光養晦待春風",
    "WK,WS,SS": "初始凶險，過程中得到幫助，最終付出多收穫少。整體小凶。\n\n初逢風雨路難行，\n貴人相助志復興，\n勞多收少天理定，\n知足常樂福綿長",
    "WK,WS,SK": "初始凶險，過程中得到幫助，最終通過努力成功。整體小吉。\n\n初遇凶險志堅強，\n貴人相助路更暢，\n自強不息終成業，\n功成名就福壽長",
    "WK,WS,BH": "初始凶險，過程中得到幫助，最終平穩。整體小吉。\n\n初逢凶險路艱辛，\n貴人相助開新程，\n平穩安泰終無憂，\n以柔克剛壽康寧",
    "WK,WK,WS": "初始凶險，過程中遇到阻礙，最終結果吉利。整體小凶。\n\n初遇風波志不移，\n中途險阻試心期，\n否極泰來終獲吉，\n破繭成蝶展新機",
    "WK,WK,WK": "初始凶險，過程中遇到阻礙，最終結果凶險。整體大凶。\n\n初逢凶險路途艱，\n中途暗礁更添難，\n末路多舛宜慎行，\n韜光養晦待時安",
    "WK,WK,SS": "初始凶險，過程中遇到阻礙，最終付出多收穫少。整體大凶。\n\n初遇風雨路崎嶇，\n中途坎坷志不孤，\n勞多收少天道定，\n積善修德福來遲",
    "WK,WK,SK": "初始凶險，過程中遇到阻礙，最終通過努力成功。整體小凶。\n\n初逢凶險路難行，\n中途險阻試志誠，\n自強不息終成業，\n鐵杵磨針功自成",
    "WK,WK,BH": "初始凶險，過程中遇到阻礙，最終平穩。整體小凶。\n\n初遇凶險志不衰，\n中途風霜路更危，\n平穩安泰終無憂，\n以柔克剛壽康寧",
    "WK,SS,WS": "初始凶險，過程中付出努力，最終結果吉利。整體小凶。\n\n初逢凶險志不摧，\n中途勤奮路重開，\n碩果累累終獲吉，\n天道酬勤福綿長",
    "WK,SS,WK": "初始凶險，過程中付出努力，最終結果凶險。整體大凶。\n\n初遇凶險路途難，\n中途奮力志不寒，\n末路多艱宜慎行，\n韜光養晦待春還",
    "WK,SS,SS": "初始凶險，過程中付出努力，最終付出多收穫少。整體大凶。\n\n初逢風雨路崎嶇，\n中途勞苦志不孤，\n收穫雖少天理定，\n知足常樂福自來",
    "WK,SS,SK": "初始凶險，過程中付出努力，最終通過努力成功。整體小凶。\n\n初遇凶險志堅強，\n中途奮鬥路更長，\n自強不息終成業，\n功成名就福壽昌",
    "WK,SS,BH": "初始凶險，過程中付出努力，最終平穩。整體小凶。\n\n初逢凶險路艱辛，\n中途勤勉志更真，\n平穩安泰終無憂，\n知足常樂壽康寧",
    "WK,SK,WS": "初始凶險，過程中克服困難，最終結果吉利。整體小吉。\n\n初逢凶險志不移，\n披荊斬棘開新機，\n終獲坦途成大業，\n勇智雙全名四方",
    "WK,SK,WK": "初始凶險，過程中克服困難，最終結果凶險。整體小凶。\n\n初遇凶險路崎嶇，\n中克艱難志不孤，\n末路多舛宜慎行，\n守正不阿待春風",
    "WK,SK,SS": "初始凶險，過程中克服困難，最終付出多收穫少。整體小凶。\n\n初逢風雨志堅強，\n中克險阻路更長，\n勞多收少天理定，\n積少成多福自來",
    "WK,SK,SK": "初始凶險，過程中克服困難，最終通過努力成功。整體小吉。\n\n初遇凶險志不衰，\n千錘百煉路不危，\n自強不息終成業，\n風雨過後彩虹美",
    "WK,SK,BH": "初始凶險，過程中克服困難，最終平穩。整體小吉。\n\n初逢凶險路艱辛，\n中克艱難志更真，\n平穩安泰終無憂，\n陰陽平衡壽康寧",
    "WK,BH,WS": "初始凶險，過程平穩，最終結果吉利。整體小吉。\n\n初遇凶險志不摧，\n中途平穩路重開，\n順水行舟終獲吉，\n福澤綿延萬事昌",
    "WK,BH,WK": "初始凶險，過程平穩，最終結果凶險。整體小凶。\n\n初逢凶險路崎嶇，\n中途平穩志不孤，\n末路多艱宜慎行，\n居安思危化險情",
    "WK,BH,SS": "初始凶險，過程平穩，最終付出多收穫少。整體小凶。\n\n初遇風雨路難行，\n中途平穩志安寧，\n勞多收少天道定，\n知足常樂福綿長",
    "WK,BH,SK": "初始凶險，過程平穩，最終通過努力成功。整體小吉。\n\n初遇凶險志堅強，\n中途平穩路更暢，\n自強不息終成業，\n功成名就福壽長",
    "WK,BH,BH": "初始凶險，過程平穩，最終平穩。整體小吉。\n\n初逢凶險路艱辛，\n中途平穩志更真，\n四平八穩終無憂，\n福壽綿延樂無疆",
    "SS,WS,WS": "初始耗泄，付出較多，過程中得到幫助，最終結果吉利。整體小吉。\n\n初勞付出志不衰，\n貴人相助路重開，\n碩果累累終獲吉，\n天道酬勤福綿長",
    "SS,WS,WK": "初始耗泄，付出較多，過程中得到幫助，最終結果凶險。整體小凶。\n\n初勞付出路崎嶇，\n貴人相助暫解憂，\n末路多艱宜慎行，\n韜光養晦待春風",
    "SS,WS,SS": "初始耗泄，付出較多，過程中得到幫助，最終付出多收穫少。整體小凶。\n\n初勞付出志堅強，\n貴人相助路更長，\n收穫雖少天理定，\n知足常樂福自來",
    "SS,WS,SK": "初始耗泄，付出較多，過程中得到幫助，最終通過努力成功。整體小吉。\n\n初勞付出志不移，\n貴人相助開新機，\n自強不息終成業，\n功成名就福壽昌",
    "SS,WS,BH": "初始耗泄，付出較多，過程中得到幫助，最終平穩。整體小吉。\n\n初勞付出路艱辛，\n貴人相助志更真，\n平穩安泰終無憂，\n以柔克剛壽康寧",
    "SS,WK,WS": "初始耗 creed，付出較多，過程中遇到阻礙，最終結果吉利。整體小凶。\n\n初勞付出志不摧，\n中途坎坷試心懷，\n否極泰來終獲吉，\n破繭成蝶展新機",
    "SS,WK,WK": "初始耗泄，付出較多，過程中遇到阻礙，最終結果凶險。整體大凶。\n\n初勞付出路崎嶇，\n中逢暗礁更添難，\n末路多舛宜慎行，\n韜光養晦待時安",
    "SS,WK,SS": "初始耗泄，付出較多，過程中遇到阻礙，最終付出多收穫少。整體大凶。\n\n初勞付出志堅強，\n中途險阻路更長，\n收穫雖少天道定，\n積善修德福來遲",
    "SS,WK,SK": "初始耗泄，付出較多，過程中遇到阻礙，最終通過努力成功。整體小凶。\n\n初勞付出志不衰，\n中途險阻試志真，\n自強不息終成業，\n鐵杵磨針功自成",
    "SS,WK,BH": "初始耗泄，付出較多，過程中遇到阻礙，最終平穩。整體小凶。\n\n初勞付出路艱辛，\n中途風霜志不移，\n平穩安泰終無憂，\n以柔克剛壽康寧",
    "SS,SS,WS": "初始耗泄，付出較多，過程中付出努力，最終結果吉利。整體小凶。\n\n初勞付出志彌堅，\n中途勤奮路更寬，\n碩果累累終獲吉，\n天道酬勤福綿長",
    "SS,SS,WK": "初始耗泄，付出較多，過程中付出努力，最終結果凶險。整體大凶。\n\n初勞付出路崎嶇，\n中途奮力志不孤，\n末路多艱宜慎行，\n韜光養晦待春風",
    "SS,SS,SS": "初始耗泄，付出較多，過程中付出努力，最終付出多收穫少。整體大凶。\n\n初勞付出志堅強，\n中途勞苦路更長，\n收穫雖少天理定，\n知足常樂福自來",
    "SS,SS,SK": "初始耗泄，付出較多，過程中付出努力，最終通過努力成功。整體小凶。\n\n初勞付出志不移，\n中途奮鬥開新機，\n自強不息終成業，\n功成名就福壽昌",
    "SS,SS,BH": "初始耗泄，付出較多，過程中付出努力，最終平穩。整體小凶。\n\n初勞付出路艱辛，\n中途勤勉志更真，\n平穩安泰終無憂，\n知足常樂壽康寧",
    "SS,SK,WS": "初始耗泄，付出較多，過程中克服困難，最終結果吉利。整體小吉。\n\n初勞付出志不摧，\n披荊斬棘開新機，\n終獲坦途成大業，\n勇智雙全名四方",
    "SS,SK,WK": "初始耗泄，付出較多，過程中克服困難，最終結果凶險。整體小凶。\n\n初勞付出路崎嶇，\n中克艱難志不孤，\n末路多舛宜慎行，\n守正不阿待春風",
    "SS,SK,SS": "初始耗泄，付出較多，過程中克服困難，最終付出多收穫少。整體小凶。\n\n初勞付出志堅強，\n中克險阻路更長，\n勞多收少天理定，\n積少成多福自來",
    "SS,SK,SK": "初始耗泄，付出較多，過程中克服困難，最終通過努力成功。整體小吉。\n\n初勞付出志不衰，\n千錘百煉開新機，\n自強不息終成業，\n風雨過後彩虹美",
    "SS,SK,BH": "初始耗泄，付出較多，過程中克服困難，最終平穩。整體小吉。\n\n初勞付出路艱辛，\n中克艱難志更真，\n平穩安泰終無憂，\n陰陽平衡壽康寧",
    "SS,BH,WS": "初始耗泄，付出較多，過程平穩，最終結果吉利。整體小吉。\n\n初勞付出志不摧，\n中途平穩路重開，\n順水行舟終獲吉，\n福澤綿延萬事昌",
    "SS,BH,WK": "初始耗泄，付出較多，過程平穩，最終結果凶險。整體小凶。\n\n初勞付出路崎嶇，\n中途平穩志不孤，\n末路多艱宜慎行，\n居安思危化險情",
    "SS,BH,SS": "初始耗泄，付出較多，過程平穩，最終付出多收穫少。整體小凶。\n\n初勞付出志堅強，\n中途平穩路更長，\n收穫雖少天道定，\n知足常樂福自來",
    "SS,BH,SK": "初始耗泄，付出較多，過程平穩，最終通過努力成功。整體小吉。\n\n初勞付出志不移，\n中途平穩開新機，\n自強不息終成業，\n功成名就福壽昌",
    "SS,BH,BH": "初始耗泄，付出較多，過程平穩，最終平穩。整體小吉。\n\n初勞付出路艱辛，\n中途平穩志更真，\n四平八穩終無憂，\n福壽綿延樂無疆",
    "SK,WS,WS": "初始辛苦，但有望成功，過程中得到幫助，最終結果吉利。整體大吉。\n\n初辛奮鬥志不衰，\n貴人相助路重開，\n碩果累累終獲吉，\n天道酬勤福綿長",
    "SK,WS,WK": "初始辛苦，但有望成功，過程中得到幫助，最終結果凶險。整體小吉。\n\n初辛奮鬥志堅強，\n貴人相助路更暢，\n末路多艱宜慎行，\n韜光養晦待春風",
    "SK,WS,SS": "初始辛苦，但有望成功，過程中得到幫助，最終付出多收穫少。整體小吉。\n\n初辛奮鬥志不摧，\n貴人相助開新機，\n收穫雖少天理定，\n知足常樂福自來",
    "SK,WS,SK": "初始辛苦，但有望成功，過程中得到幫助，最終通過努力成功。整體大吉。\n\n初辛奮鬥志不移，\n貴人相助路重開，\n自強不息終成業，\n功成名就福壽昌",
    "SK,WS,BH": "初始辛苦，但有望成功，過程中得到幫助，最終平穩。整體大吉。\n\n初辛奮鬥路艱辛，\n貴人相助志更真，\n平穩安泰終無憂，\n以柔克剛壽康寧",
    "SK,WK,WS": "初始辛苦，但有望成功，過程中遇到阻礙，最終結果吉利。整體小吉。\n\n初辛奮鬥志不摧，\n中途坎坷試心懷，\n否極泰來終獲吉，\n破繭成蝶展新機",
    "SK,WK,WK": "初始辛苦，但有望成功，過程中遇到阻礙，最終結果凶險。整體小凶。\n\n初辛奮鬥路崎嶇，\n中逢暗礁更添難，\n末路多舛宜慎行，\n韜光養晦待時安",
    "SK,WK,SS": "初始辛苦，但有望成功，過程中遇到阻礙，最終付出多收穫少。整體小凶。\n\n初辛奮鬥志堅強，\n中途險阻路更長，\n收穫雖少天道定，\n積善修德福來遲",
    "SK,WK,SK": "初始辛苦，但有望成功，過程中遇到阻礙，最終通過努力成功。整體小吉。\n\n初辛奮鬥志不衰，\n中途險阻試志真，\n自強不息終成業，\n鐵杵磨針功自成",
    "SK,WK,BH": "初始辛苦，但有望成功，過程中遇到阻礙，最終平穩。整體小吉。\n\n初辛奮鬥路艱辛，\n中途風霜志不移，\n平穩安泰終無憂，\n以柔克剛壽康寧",
    "SK,SS,WS": "初始辛苦，但有望成功，過程中付出努力，最終結果吉利。整體小吉。\n\n初辛奮鬥志彌堅，\n中途勤奮路更寬，\n碩果累累終獲吉，\n天道酬勤福綿長",
    "SK,SS,WK": "初始辛苦，但有望成功，過程中付出努力，最終結果凶險。整體小凶。\n\n初辛奮鬥路崎嶇，\n中途奮力志不孤，\n末路多艱宜慎行，\n韜光養晦待春風",
    "SK,SS,SS": "初始辛苦，但有望成功，過程中付出努力，最終付出多收穫少。整體小凶。\n\n初辛奮鬥志堅強，\n中途勞苦路更長，\n收穫雖少天理定，\n知足常樂福自來",
    "SK,SS,SK": "初始辛苦，但有望成功，過程中付出努力，最終通過努力成功。整體小吉。\n\n初辛奮鬥志不移，\n中途奮鬥開新機，\n自強不息終成業，\n功成名就福壽昌",
    "SK,SS,BH": "初始辛苦，但有望成功，過程中付出努力，最終平穩。整體小吉。\n\n初辛奮鬥路艱辛，\n中途勤勉志更真，\n平穩安泰終無憂，\n知足常樂壽康寧",
    "SK,SK,WS": "初始辛苦，但有望成功，過程中克服困難，最終結果吉利。整體大吉。\n\n初辛奮鬥志不摧，\n披荊斬棘開新機，\n終獲坦途成大業，\n勇智雙全名四方",
    "SK,SK,WK": "初始辛苦，但有望成功，過程中克服困難，最終結果凶險。整體小吉。\n\n初辛奮鬥路崎嶇，\n中克艱難志不孤，\n末路多舛宜慎行，\n守正不阿待春風",
    "SK,SK,SS": "初始辛苦，但有望成功，過程中克服困難，最終付出多收穫少。整體小吉。\n\n初辛奮鬥志堅強，\n中克險阻路更長，\n勞多收少天理定，\n積少成多福自來",
    "SK,SK,SK": "初始辛苦，但有望成功，過程中克服困難，最終通過努力成功。整體大吉。\n\n初辛奮鬥志不衰，\n千錘百煉開新機，\n自強不息終成業，\n風雨過後彩虹美",
    "SK,SK,BH": "初始辛苦，但有望成功，過程中克服困難，最終平穩。整體大吉。\n\n初辛奮鬥路艱辛，\n中克艱難志更真，\n平穩安泰終無憂，\n陰陽平衡壽康寧",
    "SK,BH,WS": "初始辛苦，但有望成功，過程平穩，最終結果吉利。整體大吉。\n\n初辛奮鬥志不摧，\n中途平穩路重開，\n順水行舟終獲吉，\n福澤綿延萬事昌",
    "SK,BH,WK": "初始辛苦，但有望成功，過程平穩，最終結果凶險。整體小吉。\n\n初辛奮鬥路崎嶇，\n中途平穩志不孤，\n末路多艱宜慎行，\n居安思危化險情",
    "SK,BH,SS": "初始辛苦，但有望成功，過程平穩，最終付出多收穫少。整體小吉。\n\n初辛奮鬥志堅強，\n中途平穩路更長，\n收穫雖少天道定，\n知足常樂福自來",
    "SK,BH,SK": "初始辛苦，但有望成功，過程平穩，最終通過努力成功。整體大吉。\n\n初辛奮鬥志不移，\n中途平穩開新機，\n自強不息終成業，\n功成名就福壽昌",
    "SK,BH,BH": "初始辛苦，但有望成功，過程平穩，最終平穩。整體大吉。\n\n初辛奮鬥路艱辛，\n中途平穩志更真，\n四平八穩終無憂，\n福壽綿延樂無疆",
    "BH,WS,WS": "初始平和，過程中得到幫助，最終結果吉利。整體大吉。\n\n初平心靜福運開，\n貴人相助路途寬，\n順水行舟終獲吉，\n福澤綿延萬事昌",
    "BH,WS,WK": "初始平和，過程中得到幫助，最終結果凶險。整體小吉。\n\n初平心靜福運生，\n貴人相助路途平，\n末路多艱宜慎行，\n居安思危化險情",
    "BH,WS,SS": "初始平和，過程中得到幫助，最終付出多收穫少。整體小吉。\n\n初平心靜福運開，\n貴人相助志安泰，\n勞多收少天道定，\n知足常樂福綿長",
    "BH,WS,SK": "初始平和，過程中得到幫助，最終通過努力成功。整體大吉。\n\n初平心靜福運濃，\n貴人相助路途通，\n自強不息終成業，\n功成名就福壽全",
    "BH,WS,BH": "初始平和，過程中得到幫助，最終平穩。整體大吉。\n\n初平心靜福運長，\n貴人相助保安康，\n四平八穩終無憂，\n福壽綿延樂無疆",
    "BH,WK,WS": "初始平和，過程中遇到阻礙，最終結果吉利。整體小吉。\n\n初平心靜志不摧，\n中途坎坷試心懷，\n否極泰來終獲吉，\n破繭成蝶展新機",
    "BH,WK,WK": "初始平和，過程中遇到阻礙，最終結果凶險。整體小凶。\n\n初平心靜路崎嶇，\n中逢暗礁更添難，\n末路多舛宜慎行，\n韜光養晦待時安",
    "BH,WK,SS": "初始平和，過程中遇到阻礙，最終付出多收穫少。整體小凶。\n\n初平心靜志堅強，\n中途險阻路更長，\n收穫雖少天理定，\n積善修德福來遲",
    "BH,WK,SK": "初始平和，過程中遇到阻礙，最終通過努力成功。整體小吉。\n\n初平心靜志不衰，\n中途險阻試志真，\n自強不息終成業，\n鐵杵磨針功自成",
    "BH,WK,BH": "初始平和，過程中遇到阻礙，最終平穩。整體小吉。\n\n初平心靜路艱辛，\n中途風霜志不移，\n平穩安泰終無憂，\n以柔克剛壽康寧",
    "BH,SS,WS": "初始平和，過程中付出努力，最終結果吉利。整體小吉。\n\n初平心靜福運生，\n中途勤奮志彌堅，\n碩果累累終獲吉，\n天道酬勤福綿長",
    "BH,SS,WK": "初始平和，過程中付出努力，最終結果凶險。整體小凶。\n\n初平心靜路崎嶇，\n中途奮力志不孤，\n末路多艱宜慎行，\n韜光養晦待春風",
    "BH,SS,SS": "初始平和，過程中付出努力，最終付出多收穫少。整體小凶。\n\n初平心靜志堅強，\n中途勞苦路更長，\n收穫雖少天道定，\n知足常樂福自來",
    "BH,SS,SK": "初始平和，過程中付出努力，最終通過努力成功。整體小吉。\n\n初平心靜志不移，\n中途奮鬥開新機，\n自強不息終成業，\n功成名就福壽昌",
    "BH,SS,BH": "初始平和，過程中付出努力，最終平穩。整體小吉。\n\n初平心靜路艱辛，\n中途勤勉志更真，\n平穩安泰終無憂，\n知足常樂壽康寧",
    "BH,SK,WS": "初始平和，過程中克服困難，最終結果吉利。整體大吉。\n\n初平心靜志不摧，\n披荊斬棘開新機，\n終獲坦途成大業，\n勇智雙全名四方",
    "BH,SK,WK": "初始平和，過程中克服困難，最終結果凶險。整體小吉。\n\n初平心靜路崎嶇，\n中克艱難志不孤，\n末路多舛宜慎行，\n守正不阿待春風",
    "BH,SK,SS": "初始平和，過程中克服困難，最終付出多收穫少。整體小吉。\n\n初平心靜志堅強，\n中克險阻路更長，\n勞多收少天理定，\n積少成多福自來",
    "BH,SK,SK": "初始平和，過程中克服困難，最終通過努力成功。整體大吉。\n\n初平心靜志不衰，\n千錘百煉開新機，\n自強不息終成業，\n風雨過後彩虹美",
    "BH,SK,BH": "初始平和，過程中克服困難，最終平穩。整體大吉。\n\n初平心靜路艱辛，\n中克艱難志更真，\n平穩安泰終無憂，\n陰陽平衡壽康寧",
    "BH,BH,WS": "初始平和，過程平穩，最終結果吉利。整體大吉。\n\n初平心靜福運開，\n中途平穩路途寬，\n順水行舟終獲吉，\n福澤綿延萬事昌",
    "BH,BH,WK": "初始平和，過程平穩，最終結果凶險。整體小吉。\n\n初平心靜福運生，\n中途平穩志安寧，\n末路多艱宜慎行，\n居安思危化險情",
    "BH,BH,SS": "初始平和，過程平穩，最終付出多收穫少。整體小吉。\n\n初平心靜福運濃，\n中途平穩路途通，\n收穫雖少天道定，\n知足常樂福自來",
    "BH,BH,SK": "初始平和，過程平穩，最終通過努力成功。整體大吉。\n\n初平心靜志不移，\n中途平穩開新機，\n自強不息終成業，\n功成名就福壽昌",
    "BH,BH,BH": "初始平和，過程平穩，最終平穩。整體大吉。\n\n初平心靜福運長，\n中途平穩保安康，\n四時和順終無憂，\n福壽綿延樂無疆"
};

        const trigrams = {
            1: {"name": "乾", "element": "金", "yao": [1, 1, 1]},
            2: {"name": "兌", "element": "金", "yao": [1, 1, 0]},
            3: {"name": "離", "element": "火", "yao": [1, 0, 1]},
            4: {"name": "震", "element": "木", "yao": [1, 0, 0]},
            5: {"name": "巽", "element": "木", "yao": [0, 1, 1]},
            6: {"name": "坎", "element": "水", "yao": [0, 1, 0]},
            7: {"name": "艮", "element": "土", "yao": [0, 0, 1]},
            8: {"name": "坤", "element": "土", "yao": [0, 0, 0]}
        };

        const elementRelations = {
            "金": { "克": "木", "生": "水", "被克": "火", "被生": "土" },
            "木": { "克": "土", "生": "火", "被克": "金", "被生": "水" },
            "水": { "克": "火", "生": "木", "被克": "土", "被生": "金" },
            "火": { "克": "金", "生": "土", "被克": "水", "被生": "木" },
            "土": { "克": "水", "生": "金", "被克": "木", "被生": "火" }
        };

        const seasonElementStatus = {
            spring: { "木": "旺", "火": "相", "水": "休", "金": "囚", "土": "死" },
            summer: { "火": "旺", "土": "相", "木": "休", "水": "囚", "金": "死" },
            autumn: { "金": "旺", "水": "相", "土": "休", "火": "囚", "木": "死" },
            winter: { "水": "旺", "木": "相", "金": "休", "土": "囚", "火": "死" }
        };

        function getSeason(year, month, day) {
            if (!year || !month || !day) return 'autumn';
            if ((month === 2 && day >= 4) || (month === 3) || (month === 4) || (month === 5 && day <= 4)) {
                return 'spring';
            } else if ((month === 5 && day >= 5) || (month === 6) || (month === 7) || (month === 8 && day <= 6)) {
                return 'summer';
            } else if ((month === 8 && day >= 7) || (month === 9) || (month === 10) || (month === 11 && day <= 6)) {
                return 'autumn';
            } else {
                return 'winter';
            }
        }

        function calculateRelation(gua, movingYao, year, month, day) {
            let tiElement, yongElement, tiName, yongName;
            if (movingYao <= 3) {
                tiElement = trigrams[gua.shang].element;
                yongElement = trigrams[gua.xia].element;
                tiName = trigrams[gua.shang].name;
                yongName = trigrams[gua.xia].name;
            } else {
                tiElement = trigrams[gua.xia].element;
                yongElement = trigrams[gua.shang].element;
                tiName = trigrams[gua.xia].name;
                yongName = trigrams[gua.shang].name;
            }
            
            const season = getSeason(year, month, day);
            const elementStatus = seasonElementStatus[season];
            const tiStatus = elementStatus[tiElement];
            const yongStatus = elementStatus[yongElement];
            
            let relationKey, relationDisplay;
            if (elementRelations[tiElement]["生"] === yongElement) {
                relationKey = "SS";
                relationDisplay = `體${tiName}${tiElement}${tiStatus}生用${yongName}${yongElement}${yongStatus}`;
            } else if (elementRelations[tiElement]["克"] === yongElement) {
                relationKey = "SK";
                relationDisplay = `體${tiName}${tiElement}${tiStatus}克用${yongName}${yongElement}${yongStatus}`;
            } else if (elementRelations[yongElement]["生"] === tiElement) {
                relationKey = "WS";
                relationDisplay = `用${yongName}${yongElement}${yongStatus}生體${tiName}${tiElement}${tiStatus}`;
            } else if (elementRelations[yongElement]["克"] === tiElement) {
                relationKey = "WK";
                relationDisplay = `用${yongName}${yongElement}${yongStatus}克體${tiName}${tiElement}${tiStatus}`;
            } else {
                relationKey = "BH";
                relationDisplay = `體${tiName}${tiElement}${tiStatus}與用${yongName}${yongElement}${yongStatus}比和`;
            }
            
            return { key: relationKey, display: relationDisplay };
        }

        function findTrigramByYao(yaoArray) {
            for (const [key, value] of Object.entries(trigrams)) {
                if (JSON.stringify(value.yao) === JSON.stringify(yaoArray)) {
                    return parseInt(key);
                }
            }
            return 1; // 默認返回乾卦
        }

        function calculateHuGua(benGua) {
            const xiaYao = [...trigrams[benGua.xia].yao];
            const shangYao = [...trigrams[benGua.shang].yao];
            const sixYao = [...xiaYao, ...shangYao];
            const huXiaYao = [sixYao[1], sixYao[2], sixYao[3]];
            const huShangYao = [sixYao[2], sixYao[3], sixYao[4]];
            return {
                shang: findTrigramByYao(huShangYao),
                xia: findTrigramByYao(huXiaYao)
            };
        }

        function calculateBianGua(benGua, movingYao) {
            const xiaYao = [...trigrams[benGua.xia].yao];
            const shangYao = [...trigrams[benGua.shang].yao];
            const sixYao = [...xiaYao, ...shangYao];
            const yaoIndex = movingYao - 1;
            sixYao[yaoIndex] = sixYao[yaoIndex] === 1 ? 0 : 1;
            const bianXiaYao = sixYao.slice(0, 3);
            const bianShangYao = sixYao.slice(3, 6);
            return {
                shang: findTrigramByYao(bianShangYao),
                xia: findTrigramByYao(bianXiaYao)
            };
        }

        function drawHexagram(canvasId, binary, movingYao) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const width = canvas.width;
            const height = canvas.height;
            const yaoHeight = height / 6;
            const lineWidth = 10;
            const gap = 5;
            
            for (let i = 0; i < 6; i++) {
                const y = (5 - i) * yaoHeight + yaoHeight / 2;
                ctx.beginPath();
                ctx.lineWidth = lineWidth;
                ctx.strokeStyle = '#333';
                
                if (binary[i] === 1) {
                    ctx.moveTo(20, y);
                    ctx.lineTo(width - 20, y);
                } else {
                    ctx.moveTo(20, y);
                    ctx.lineTo(width / 2 - 10, y);
                    ctx.moveTo(width / 2 + 10, y);
                    ctx.lineTo(width - 20, y);
                }
                ctx.stroke();
                
                if (movingYao === i + 1) {
                    ctx.beginPath();
                    ctx.arc(width - 10, y, 5, 0, 2 * Math.PI);
                    ctx.fillStyle = 'red';
                    ctx.fill();
                }
            }
        }

        function saveHistory(record) {
            let history = JSON.parse(localStorage.getItem('divinationHistory') || '[]');
            history.unshift(record);
            if (history.length > 10) history = history.slice(0, 10);
            localStorage.setItem('divinationHistory', JSON.stringify(history));
            displayHistory();
        }

        function displayHistory() {
            const historyDiv = document.getElementById('history');
            let history = JSON.parse(localStorage.getItem('divinationHistory') || '[]');
            historyDiv.innerHTML = '';
            history.forEach((record, index) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.textContent = `${record.date}: 本卦 ${record.benGua} (${record.benGuaName}), 互卦 ${record.huGua} (${record.huGuaName}), 變卦 ${record.bianGua} (${record.bianGuaName}), 動爻 ${record.movingYao}`;
                historyDiv.appendChild(item);
            });
        }

        async function loadGuaData() {
            try {
                const response = await fetch('hexagrams_data.json');
                if (!response.ok) throw new Error('無法載入卦辭資料');
                return await response.json();
            } catch (error) {
                console.error('載入卦辭失敗:', error);
                return {};
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            const guaData = await loadGuaData();
            const calculateBtn = document.getElementById('calculate-btn');
            const randomBtn = document.getElementById('random-btn');
            const useCurrentTimeBtn = document.getElementById('use-current-time');
            const resultLoading = document.getElementById('result-loading');
            const resultDiv = document.getElementById('result');
            const combinationDiv = document.getElementById('combination');
            const interpretationDiv = document.getElementById('interpretation');
            const benGuaDiv = document.getElementById('ben-gua');
            const huGuaDiv = document.getElementById('hu-gua');
            const bianGuaDiv = document.getElementById('bian-gua');
            const tabBtns = document.querySelectorAll('.tab-btn');
            
            displayHistory();
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    tabBtns.forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.method-tab').forEach(tab => tab.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            useCurrentTimeBtn.addEventListener('click', function() {
                const now = new Date();
                document.getElementById('year').value = now.getFullYear();
                document.getElementById('month').value = now.getMonth() + 1;
                document.getElementById('day').value = now.getDate();
                document.getElementById('hour').value = now.getHours();
            });
            
            calculateBtn.addEventListener('click', calculateDivination);
            randomBtn.addEventListener('click', generateRandomNumbers);
            
            async function calculateDivination() {
                const activeTab = document.querySelector('.method-tab.active').id;
                let shangGua, xiaGua, movingYao, year, month, day;
                
                if (activeTab === 'direct-tab') {
                    shangGua = parseInt(document.getElementById('shang-gua').value);
                    xiaGua = parseInt(document.getElementById('xia-gua').value);
                    movingYao = parseInt(document.getElementById('moving-yao').value);
                    year = new Date().getFullYear();
                    month = new Date().getMonth() + 1;
                    day = new Date().getDate();
                    if (isNaN(shangGua) || isNaN(xiaGua) || isNaN(movingYao)) {
                        alert('請確保上卦、下卦和變爻選擇有效值');
                        return;
                    }
                } else if (activeTab === 'time-tab') {
                    year = parseInt(document.getElementById('year').value);
                    month = parseInt(document.getElementById('month').value);
                    day = parseInt(document.getElementById('day').value);
                    const hour = parseInt(document.getElementById('hour').value);
                    if (isNaN(year) || isNaN(month) || isNaN(day) || isNaN(hour)) {
                        alert('請確保年、月、日、時辰輸入有效數字');
                        return;
                    }
                    if (month < 1 || month > 12 || day < 1 || day > 31 || hour < 0 || hour > 23) {
                        alert('請檢查年、月、日、時辰的範圍是否正確');
                        return;
                    }
                    shangGua = (year + month + day) % 8;
                    shangGua = shangGua === 0 ? 8 : shangGua;
                    xiaGua = (year + month + day + hour) % 8;
                    xiaGua = xiaGua === 0 ? 8 : xiaGua;
                    movingYao = (year + month + day + hour) % 6;
                    movingYao = movingYao === 0 ? 6 : movingYao;
                } else if (activeTab === 'number-tab') {
                    const num1 = parseInt(document.getElementById('number1').value);
                    const num2 = parseInt(document.getElementById('number2').value);
                    const num3 = parseInt(document.getElementById('number3').value);
                    year = new Date().getFullYear();
                    month = new Date().getMonth() + 1;
                    day = new Date().getDate();
                    if (isNaN(num1) || isNaN(num2) || isNaN(num3)) {
                        alert('請確保輸入三個有效的百位數字');
                        return;
                    }
                    if (num1 < 100 || num1 > 999 || num2 < 100 || num2 > 999 || num3 < 100 || num3 > 999) {
                        alert('請確保輸入的數字在100到999之間');
                        return;
                    }
                    shangGua = num1 % 8;
                    shangGua = shangGua === 0 ? 8 : shangGua;
                    xiaGua = num2 % 8;
                    xiaGua = xiaGua === 0 ? 8 : xiaGua;
                    movingYao = num3 % 6;
                    movingYao = movingYao === 0 ? 6 : movingYao;
                }
                
                if (shangGua < 1 || shangGua > 8 || xiaGua < 1 || xiaGua > 8 || movingYao < 1 || movingYao > 6) {
                    alert('卦象計算錯誤，請檢查輸入參數');
                    return;
                }
                
                resultLoading.style.display = 'block';
                resultDiv.style.display = 'none';
                
                setTimeout(() => {
                    const benGua = { shang: shangGua, xia: xiaGua };
                    const huGua = calculateHuGua(benGua);
                    const bianGua = calculateBianGua(benGua, movingYao);
                    
                    const benRelation = calculateRelation(benGua, movingYao, year, month, day);
                    const huRelation = calculateRelation(huGua, movingYao, year, month, day);
                    const bianRelation = calculateRelation(bianGua, movingYao, year, month, day);
                    
                    const combinationKey = `${benRelation.key},${huRelation.key},${bianRelation.key}`;
                    
                    const benGuaKey = `${benGua.shang},${benGua.xia}`;
                    const huGuaKey = `${huGua.shang},${huGua.xia}`;
                    const bianGuaKey = `${bianGua.shang},${bianGua.xia}`;
                    
                    combinationDiv.textContent = `五行生克分析: ${benRelation.display}, ${huRelation.display}, ${bianRelation.display}`;
                    
                    let interpretationText = interpretations[combinationKey] || "未找到對應的五行解釋";
                    interpretationText += "\n\n本卦辭: " + (guaData[hexagramNames[benGuaKey]]?.ci || "未找到本卦辭");
                    interpretationText += "\n動爻解釋: " + (guaData[hexagramNames[benGuaKey]]?.yaoCi?.[movingYao - 1] || "未找到動爻解釋");
                    interpretationText += "\n\n變卦辭: " + (guaData[hexagramNames[bianGuaKey]]?.ci || "未找到變卦辭");
                    interpretationDiv.textContent = interpretationText;
                    
                    benGuaDiv.textContent = `${hexagramNames[benGuaKey]} (${trigrams[benGua.shang].name}上${trigrams[benGua.xia].name}下, ${trigrams[benGua.shang].element}上${trigrams[benGua.xia].element}下)`;
                    huGuaDiv.textContent = `${hexagramNames[huGuaKey]} (${trigrams[huGua.shang].name}上${trigrams[huGua.xia].name}下, ${trigrams[huGua.shang].element}上${trigrams[huGua.xia].element}下)`;
                    bianGuaDiv.textContent = `${hexagramNames[bianGuaKey]} (${trigrams[bianGua.shang].name}上${trigrams[bianGua.xia].name}下, ${trigrams[bianGua.shang].element}上${trigrams[bianGua.xia].element}下)`;
                    
                    const benBinary = [...trigrams[benGua.xia].yao, ...trigrams[benGua.shang].yao];
                    const huBinary = [...trigrams[huGua.xia].yao, ...trigrams[huGua.shang].yao];
                    const bianBinary = [...trigrams[bianGua.xia].yao, ...trigrams[bianGua.xia].yao];
                    drawHexagram('mainHexagram', benBinary, movingYao);
                    drawHexagram('mutualHexagram', huBinary, 0);
                    drawHexagram('changedHexagram', bianBinary, 0);
                    
                    resultLoading.style.display = 'none';
                    resultDiv.style.display = 'block';
                    
                    saveHistory({
                        date: new Date().toLocaleString(),
                        benGua: `${trigrams[benGua.shang].name}${trigrams[benGua.xia].name}`,
                        benGuaName: hexagramNames[benGuaKey],
                        huGua: `${trigrams[huGua.shang].name}${trigrams[huGua.xia].name}`,
                        huGuaName: hexagramNames[huGuaKey],
                        bianGua: `${trigrams[bianGua.shang].name}${trigrams[bianGua.xia].name}`,
                        bianGuaName: hexagramNames[bianGuaKey],
                        movingYao: movingYao
                    });
                }, 800);
            }
            
            function generateRandomNumbers() {
                const activeTab = document.querySelector('.method-tab.active').id;
                
                if (activeTab === 'direct-tab') {
                    document.getElementById('shang-gua').value = Math.floor(Math.random() * 8) + 1;
                    document.getElementById('xia-gua').value = Math.floor(Math.random() * 8) + 1;
                    document.getElementById('moving-yao').value = Math.floor(Math.random() * 6) + 1;
                } else if (activeTab === 'time-tab') {
                    const now = new Date();
                    document.getElementById('year').value = now.getFullYear();
                    document.getElementById('month').value = now.getMonth() + 1;
                    document.getElementById('day').value = now.getDate();
                    document.getElementById('hour').value = now.getHours();
                } else if (activeTab === 'number-tab') {
                    document.getElementById('number1').value = Math.floor(Math.random() * 900) + 100;
                    document.getElementById('number2').value = Math.floor(Math.random() * 900) + 100;
                    document.getElementById('number3').value = Math.floor(Math.random() * 900) + 100;
                }
                
                calculateDivination();
            }
        });
    </script>
</body>
</html>
