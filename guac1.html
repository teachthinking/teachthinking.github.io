<!doctype html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>åœå¦ç³»çµ±ï¼ˆä¿®æ­£ç‰ˆï½œç¶œåˆå‰å‡¶åˆ¤æ–·ï¼‰</title>
<style>
  :root{--bg:#0b0f14;--card:#121823;--muted:#9fb2c7;--text:#ebf2ff;--accent:#8ecbff;--good:#2ecc71;--bad:#e74c3c;--warn:#f1c40f}
  *{box-sizing:border-box}
  body{margin:0;padding:24px;font-family:system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, "PingFang TC", "Heiti TC", Arial, sans-serif;background:var(--bg);color:var(--text)}
  h1{font-size:20px;margin:0 0 16px}
  .grid{display:grid;gap:16px}
  .cols{grid-template-columns:repeat(12,1fr)}
  .card{background:var(--card);border:1px solid #1b2636;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.35)}
  .card h2{font-size:16px;margin:0 0 12px;color:#d9e8ff}
  .section{padding:16px}
  label{color:#cfe0ff;font-size:13px}
  select, input[type="text"], textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #304058;background:#0d141f;color:var(--text)}
  button{cursor:pointer;border:none;padding:10px 14px;border-radius:10px;background:#1a2a42;color:#e7f0ff}
  button:hover{filter:brightness(1.05)}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid #324b6b;color:#d3e7ff;font-size:12px}
  .kpi{font-size:13px;color:var(--muted)}
  .name{font-weight:700;color:#c7e6ff}
  .good{color:var(--good)}
  .bad{color:var(--bad)}
  .warn{color:var(--warn)}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px 10px;border-bottom:1px solid #21314a;font-size:14px}
  th{color:#cfe0ff;text-align:left}
  .muted{color:#9fb2c7}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .footer{opacity:.8;font-size:12px}
</style>
</head>
<body>
  <h1>ğŸ§­ åœå¦ç³»çµ±ï¼ˆä¿®æ­£ç‰ˆï½œå«ç¶œåˆå‰å‡¶åˆ¤æ–·èˆ‡è³‡æ–™æ ¡æ­£æ©Ÿåˆ¶ï¼‰</h1>
  <div class="grid cols"><div class="card section" style="grid-column:span 5">
  <h2>â‘  è¼¸å…¥å¦è±¡èˆ‡å‹•çˆ»</h2>
  <div class="row">
    <div style="flex:1;min-width:220px">
      <label>é¸æ“‡æœ¬å¦ï¼ˆæ–‡ç‹åºï¼‰</label>
      <select id="hex-select"></select>
    </div>
    <div class="pill">æˆ–</div>
    <div style="flex:1;min-width:220px">
      <label>ç”¨å…­çˆ»ï¼ˆè‡ªä¸‹è€Œä¸Šï¼‰è¼¸å…¥é™°é™½</label>
      <div class="row" id="yin-yang-row"></div>
    </div>
  </div>
  <div style="height:8px"></div>
  <div>
    <label>é¸æ“‡å‹•çˆ»ï¼ˆå¯è¤‡é¸ï¼Œ1 åœ¨æœ€ä¸‹ï¼‰</label>
    <div class="row" id="moving-row"></div>
  </div>
  <div style="height:8px"></div>
  <div class="row">
    <button id="btn-random">éš¨æ©Ÿå–å¦</button>
    <button id="btn-clear">æ¸…ç©º</button>
    <span class="kpi">è³‡æ–™ä¾†æºï¼šå…§å»ºç¶“æ–‡ + ç™½è©±é‡‹ç¾©ï¼ˆéƒ¨åˆ†å¦å·²ç²¾æ ¡ï¼‰ï¼Œå¯è‡ªè¡Œè¼‰å…¥ JSON è¦†å¯«ã€‚</span>
  </div>
</div>

<div class="card section" style="grid-column:span 7">
  <h2>â‘¡ æœ¬å¦ï½œè®Šå¦ï½œäº’å¦</h2>
  <div class="row">
    <div class="pill"><span class="muted">æœ¬å¦</span>ï¼š<span id="base-gua-name" class="name">â€”</span></div>
    <div class="pill"><span class="muted">è®Šå¦</span>ï¼š<span id="change-gua-name" class="name">â€”</span></div>
    <div class="pill"><span class="muted">äº’å¦</span>ï¼š<span id="hu-gua-name" class="name">â€”</span></div>
  </div>
  <div style="height:8px"></div>
  <div class="row">
    <span class="kpi">å¦åºï¼š<span id="base-gua-no">â€”</span></span>
    <span class="kpi">é™°é™½ï¼š<span id="base-gua-bits" class="mono">â€”</span></span>
    <span class="kpi">å‹•çˆ»ï¼š<span id="moving-lines">â€”</span></span>
  </div>
</div>

<div class="card section" style="grid-column:span 12">
  <h2>â‘¢ å¦çˆ»è§£é‡‹ï¼ˆé€çˆ»ï¼‰</h2>
  <table>
    <thead>
      <tr><th style="width:64px">çˆ»ä½</th><th>ç¶“æ–‡</th><th>ç™½è©±é‡‹ç¾©</th></tr>
    </thead>
    <tbody id="lines-tbody"></tbody>
  </table>
</div>

<div class="card section" style="grid-column:span 7">
  <h2>â‘£ ç¶œåˆå‰å‡¶åˆ¤æ–·</h2>
  <div id="judge-type" class="pill">â€”</div>
  <div style="height:6px"></div>
  <div id="judge-advice" class="kpi">â€”</div>
  <div style="height:6px"></div>
  <div class="muted">æ¼”ç®—æ³•æœƒç¶œåˆæœ¬å¦ï¼è®Šå¦ï¼äº’å¦çš„é—œéµè©ï¼Œä¸¦å°ã€Œå‹•çˆ»ã€åŠ æ¬Šã€‚è‹¥æœ¬å¦æœ‰äººå·¥ç‰¹ä¾‹ï¼ˆjudgementDataï¼‰ï¼Œå‰‡å„ªå…ˆæ¡ç”¨ã€‚</div>
</div>

<div class="card section" style="grid-column:span 5">
  <h2>â‘¤ è³‡æ–™ç®¡ç†</h2>
  <div class="row">
    <button id="btn-export">åŒ¯å‡ºç•¶å‰è³‡æ–™ï¼ˆJSONï¼‰</button>
    <button id="btn-import">è¼‰å…¥è‡ªè¨‚ JSONï¼ˆè¦†å¯«ï¼‰</button>
    <input id="file-import" type="file" accept="application/json" style="display:none" />
  </div>
  <div style="height:8px"></div>
  <div class="footer">ğŸ“Œ å·²å…§å»ºç²¾æ ¡å¦ï¼šä¹¾ã€å¤ã€åã€æ˜å¤·ã€å™¬å—‘ã€å±¥ã€‚å…¶é¤˜å¦ä»¥ç°¡é‡‹ç‚ºä¸»ï¼Œæ¨™è¨»ã€Œï¼ˆå¾…è£œï¼‰ã€ä»¥åˆ©å¾ŒçºŒé€å¦æ‰“ç£¨ï¼›å¯ç›´æ¥åŒ¯å‡º JSON é€²è¡Œå¤–éƒ¨æ ¡å°å¾Œå†è¼‰å…¥è¦†å¯«ã€‚</div>
</div>

  </div><script>
// ===== 0) ä¸‰æ‰å…«å¦å®šç¾© =====
const TRIGRAMS = {
  QIAN: {name:"ä¹¾", bin:"111", han:"â˜°", key:"QIAN"},
  DUI:  {name:"å…Œ", bin:"110", han:"â˜±", key:"DUI"},
  LI:   {name:"é›¢", bin:"101", han:"â˜²", key:"LI"},
  ZHEN: {name:"éœ‡", bin:"100", han:"â˜³", key:"ZHEN"},
  XUN:  {name:"å·½", bin:"011", han:"â˜´", key:"XUN"},
  KAN:  {name:"å", bin:"010", han:"â˜µ", key:"KAN"},
  GEN:  {name:"è‰®", bin:"001", han:"â˜¶", key:"GEN"},
  KUN:  {name:"å¤", bin:"000", han:"â˜·", key:"KUN"},
};

// æ–‡ç‹åº 64 å¦ï¼šä¸Šå¦ï¼ˆä¸Šä¸‰çˆ»ï¼‰ï½œä¸‹å¦ï¼ˆä¸‹ä¸‰çˆ»ï¼‰
const KING_WEN = [
  [TRIGRAMS.QIAN, TRIGRAMS.QIAN, {no:1,  name:"ä¹¾ç‚ºå¤©", short:"ä¹¾"}],
  [TRIGRAMS.KUN,  TRIGRAMS.KUN,  {no:2,  name:"å¤ç‚ºåœ°", short:"å¤"}],
  [TRIGRAMS.KAN,  TRIGRAMS.ZHEN, {no:3,  name:"æ°´é›·å±¯", short:"å±¯"}],
  [TRIGRAMS.GEN,  TRIGRAMS.KAN,  {no:4,  name:"å±±æ°´è’™", short:"è’™"}],
  [TRIGRAMS.KAN,  TRIGRAMS.QIAN, {no:5,  name:"æ°´å¤©éœ€", short:"éœ€"}],
  [TRIGRAMS.QIAN, TRIGRAMS.KAN,  {no:6,  name:"å¤©æ°´è¨Ÿ", short:"è¨Ÿ"}],
  [TRIGRAMS.KUN,  TRIGRAMS.KAN,  {no:7,  name:"åœ°æ°´å¸«", short:"å¸«"}],
  [TRIGRAMS.KAN,  TRIGRAMS.KUN,  {no:8,  name:"æ°´åœ°æ¯”", short:"æ¯”"}],
  [TRIGRAMS.XUN,  TRIGRAMS.QIAN, {no:9,  name:"é¢¨å¤©å°ç•œ", short:"å°ç•œ"}],
  [TRIGRAMS.QIAN, TRIGRAMS.DUI,  {no:10, name:"å¤©æ¾¤å±¥", short:"å±¥"}],
  [TRIGRAMS.KUN,  TRIGRAMS.QIAN, {no:11, name:"åœ°å¤©æ³°", short:"æ³°"}],
  [TRIGRAMS.QIAN, TRIGRAMS.KUN,  {no:12, name:"å¤©åœ°å¦", short:"å¦"}],
  [TRIGRAMS.QIAN, TRIGRAMS.LI,   {no:13, name:"å¤©ç«åŒäºº", short:"åŒäºº"}],
  [TRIGRAMS.LI,   TRIGRAMS.QIAN, {no:14, name:"ç«å¤©å¤§æœ‰", short:"å¤§æœ‰"}],
  [TRIGRAMS.KUN,  TRIGRAMS.GEN,  {no:15, name:"åœ°å±±è¬™", short:"è¬™"}],
  [TRIGRAMS.ZHEN, TRIGRAMS.KUN,  {no:16, name:"é›·åœ°è±«", short:"è±«"}],
  [TRIGRAMS.DUI,  TRIGRAMS.ZHEN, {no:17, name:"æ¾¤é›·éš¨", short:"éš¨"}],
  [TRIGRAMS.GEN,  TRIGRAMS.XUN,  {no:18, name:"å±±é¢¨è ±", short:"è ±"}],
  [TRIGRAMS.KUN,  TRIGRAMS.DUI,  {no:19, name:"åœ°æ¾¤è‡¨", short:"è‡¨"}],
  [TRIGRAMS.XUN,  TRIGRAMS.KUN,  {no:20, name:"é¢¨åœ°è§€", short:"è§€"}],
  [TRIGRAMS.LI,   TRIGRAMS.ZHEN, {no:21, name:"ç«é›·å™¬å—‘", short:"å™¬å—‘"}],
  [TRIGRAMS.GEN,  TRIGRAMS.LI,   {no:22, name:"å±±ç«è³", short:"è³"}],
  [TRIGRAMS.GEN,  TRIGRAMS.KUN,  {no:23, name:"å±±åœ°å‰", short:"å‰"}],
  [TRIGRAMS.KUN,  TRIGRAMS.ZHEN, {no:24, name:"åœ°é›·å¾©", short:"å¾©"}],
  [TRIGRAMS.QIAN, TRIGRAMS.ZHEN, {no:25, name:"å¤©é›·ç„¡å¦„", short:"ç„¡å¦„"}],
  [TRIGRAMS.GEN,  TRIGRAMS.QIAN, {no:26, name:"å±±å¤©å¤§ç•œ", short:"å¤§ç•œ"}],
  [TRIGRAMS.GEN,  TRIGRAMS.ZHEN, {no:27, name:"å±±é›·é ¤", short:"é ¤"}],
  [TRIGRAMS.DUI,  TRIGRAMS.XUN,  {no:28, name:"æ¾¤é¢¨å¤§é", short:"å¤§é"}],
  [TRIGRAMS.KAN,  TRIGRAMS.KAN,  {no:29, name:"åç‚ºæ°´", short:"å"}],
  [TRIGRAMS.LI,   TRIGRAMS.LI,   {no:30, name:"é›¢ç‚ºç«", short:"é›¢"}],
  [TRIGRAMS.DUI,  TRIGRAMS.GEN,  {no:31, name:"æ¾¤å±±å’¸", short:"å’¸"}],
  [TRIGRAMS.ZHEN, TRIGRAMS.XUN,  {no:32, name:"é›·é¢¨æ†", short:"æ†"}],
  [TRIGRAMS.QIAN, TRIGRAMS.GEN,  {no:33, name:"å¤©å±±é¯", short:"é¯"}],
  [TRIGRAMS.ZHEN, TRIGRAMS.QIAN, {no:34, name:"é›·å¤©å¤§å£¯", short:"å¤§å£¯"}],
  [TRIGRAMS.LI,   TRIGRAMS.KUN,  {no:35, name:"ç«åœ°æ™‰", short:"æ™‰"}],
  [TRIGRAMS.KUN,  TRIGRAMS.LI,   {no:36, name:"åœ°ç«æ˜å¤·", short:"æ˜å¤·"}],
  [TRIGRAMS.XUN,  TRIGRAMS.LI,   {no:37, name:"é¢¨ç«å®¶äºº", short:"å®¶äºº"}],
  [TRIGRAMS.LI,   TRIGRAMS.DUI,  {no:38, name:"ç«æ¾¤ç½", short:"ç½"}],
  [TRIGRAMS.KAN,  TRIGRAMS.GEN,  {no:39, name:"æ°´å±±è¹‡", short:"è¹‡"}],
  [TRIGRAMS.ZHEN, TRIGRAMS.KAN,  {no:40, name:"é›·æ°´è§£", short:"è§£"}],
  [TRIGRAMS.GEN,  TRIGRAMS.DUI,  {no:41, name:"å±±æ¾¤æ", short:"æ"}],
  [TRIGRAMS.XUN,  TRIGRAMS.ZHEN, {no:42, name:"é¢¨é›·ç›Š", short:"ç›Š"}],
  [TRIGRAMS.DUI,  TRIGRAMS.QIAN, {no:43, name:"æ¾¤å¤©å¤¬", short:"å¤¬"}],
  [TRIGRAMS.QIAN, TRIGRAMS.XUN,  {no:44, name:"å¤©é¢¨å§¤", short:"å§¤"}],
  [TRIGRAMS.DUI,  TRIGRAMS.KUN,  {no:45, name:"æ¾¤åœ°èƒ", short:"èƒ"}],
  [TRIGRAMS.KUN,  TRIGRAMS.XUN,  {no:46, name:"åœ°é¢¨å‡", short:"å‡"}],
  [TRIGRAMS.DUI,  TRIGRAMS.KAN,  {no:47, name:"æ¾¤æ°´å›°", short:"å›°"}],
  [TRIGRAMS.KAN,  TRIGRAMS.XUN,  {no:48, name:"æ°´é¢¨äº•", short:"äº•"}],
  [TRIGRAMS.DUI,  TRIGRAMS.LI,   {no:49, name:"æ¾¤ç«é©", short:"é©"}],
  [TRIGRAMS.LI,   TRIGRAMS.XUN,  {no:50, name:"ç«é¢¨é¼", short:"é¼"}],
  [TRIGRAMS.ZHEN, TRIGRAMS.ZHEN, {no:51, name:"éœ‡ç‚ºé›·", short:"éœ‡"}],
  [TRIGRAMS.GEN,  TRIGRAMS.GEN,  {no:52, name:"è‰®ç‚ºå±±", short:"è‰®"}],
  [TRIGRAMS.XUN,  TRIGRAMS.GEN,  {no:53, name:"é¢¨å±±æ¼¸", short:"æ¼¸"}],
  [TRIGRAMS.ZHEN, TRIGRAMS.DUI,  {no:54, name:"é›·æ¾¤æ­¸å¦¹", short:"æ­¸å¦¹"}],
  [TRIGRAMS.ZHEN, TRIGRAMS.LI,   {no:55, name:"é›·ç«è±", short:"è±"}],
  [TRIGRAMS.LI,   TRIGRAMS.GEN,  {no:56, name:"ç«å±±æ—…", short:"æ—…"}],
  [TRIGRAMS.XUN,  TRIGRAMS.XUN,  {no:57, name:"å·½ç‚ºé¢¨", short:"å·½"}],
  [TRIGRAMS.DUI,  TRIGRAMS.DUI,  {no:58, name:"å…Œç‚ºæ¾¤", short:"å…Œ"}],
  [TRIGRAMS.XUN,  TRIGRAMS.KAN,  {no:59, name:"é¢¨æ°´æ¸™", short:"æ¸™"}],
  [TRIGRAMS.KAN,  TRIGRAMS.DUI,  {no:60, name:"æ°´æ¾¤ç¯€", short:"ç¯€"}],
  [TRIGRAMS.XUN,  TRIGRAMS.DUI,  {no:61, name:"é¢¨æ¾¤ä¸­å­š", short:"ä¸­å­š"}],
  [TRIGRAMS.ZHEN, TRIGRAMS.GEN,  {no:62, name:"é›·å±±å°é", short:"å°é"}],
  [TRIGRAMS.KAN,  TRIGRAMS.LI,   {no:63, name:"æ°´ç«æ—¢æ¿Ÿ", short:"æ—¢æ¿Ÿ"}],
  [TRIGRAMS.LI,   TRIGRAMS.KAN,  {no:64, name:"ç«æ°´æœªæ¿Ÿ", short:"æœªæ¿Ÿ"}],
];

// å»ºç«‹æŸ¥è¡¨ï¼šbin(è‡ªä¸‹è€Œä¸Šå…­ä½) -> {no,name,short}
const BIN2META = (()=>{
  const map = {}; // ä¾‹å¦‚ "111111" -> {no:1, name:"ä¹¾ç‚ºå¤©", short:"ä¹¾"}
  for (const [up, low, meta] of KING_WEN){
    const bits = low.bin + up.bin; // è‡ªä¸‹è€Œä¸Š
    map[bits] = meta;
  }
  return map;
})();

const META_LIST = Object.values(BIN2META).sort((a,b)=>a.no-b.no);

// ===== 1) é€å¦é€çˆ»ï¼ˆç²¾æ ¡ / å¾…è£œæ¨™ç¤ºï¼‰ =====
// çµæ§‹ï¼š hexagramsData["ä¹¾ç‚ºå¤©"] = [{index:1,text:"â€¦",meaning:"â€¦"}, ...]
const hexagramsData = {
  // â€”â€” ä¹¾ç‚ºå¤©ï¼ˆå…¨ç²¾æ ¡ï¼‰ â€”â€”
  "ä¹¾ç‚ºå¤©": [
    {index:1, text:"åˆä¹ï¼šæ½›é¾å‹¿ç”¨ã€‚", meaning:"æ™‚æ©Ÿæœªè‡³ï¼Œè“„å‹¢å¾…ç™¼ï¼›ä½èª¿ä¿®å¾·ï¼Œä¸å®œå¦„å‹•ã€‚"},
    {index:2, text:"ä¹äºŒï¼šè¦‹é¾åœ¨ç”°ï¼Œåˆ©è¦‹å¤§äººã€‚", meaning:"å±•éœ²æ‰å¾·æ–¼çœ¾ï¼Œå¾—ä¸Šä½è€…è³è­˜ï¼Œç›¸æ©Ÿè€Œé€²ã€‚"},
    {index:3, text:"ä¹ä¸‰ï¼šå›å­çµ‚æ—¥ä¹¾ä¹¾ï¼Œå¤•æƒ•è‹¥å²ï¼Œç„¡å’ã€‚", meaning:"æŒçºŒç²¾é€²ä¸”ä¸è‡ªæ»¿ï¼Œæ—¥å¤œè­¦æƒ•ï¼Œå¯å…ç¦æ‚£ã€‚"},
    {index:4, text:"ä¹å››ï¼šæˆ–èºåœ¨æ·µï¼Œç„¡å’ã€‚", meaning:"é€²é€€ä¹‹é–“ï¼Œæ¬Šè¡¡è€Œå‹•ï¼Œé›–éšªç„¡å®³ã€‚"},
    {index:5, text:"ä¹äº”ï¼šé£›é¾åœ¨å¤©ï¼Œåˆ©è¦‹å¤§äººã€‚", meaning:"æ™‚é‹å·²è‡³ï¼Œå¤§å±•å®åœ–ï¼Œèˆ‡è³¢å…±äº‹ç‚ºåˆ©ã€‚"},
    {index:6, text:"ä¸Šä¹ï¼šäº¢é¾æœ‰æ‚”ã€‚", meaning:"ç››æ¥µæ˜“è¡°ï¼Œå‰›éå‰‡æŠ˜ï¼›å®œæ”¶æ–‚ï¼Œå…å¾Œæ‚”ã€‚"},
  ],
  // â€”â€” å¤ç‚ºåœ°ï¼ˆå…¨ç²¾æ ¡ï¼‰ â€”â€”
  "å¤ç‚ºåœ°": [
    {index:1, text:"åˆå…­ï¼šå±¥éœœï¼Œå …å†°è‡³ã€‚", meaning:"å°æƒ¡ä¸é™¤ï¼Œçµ‚è‡³å¤§å®³ï¼›è¦‹å¾®çŸ¥è‘—ï¼ŒåŠæ—©é˜²æ‚£ã€‚"},
    {index:2, text:"å…­äºŒï¼šç›´æ–¹å¤§ï¼Œä¸ç¿’ç„¡ä¸åˆ©ã€‚", meaning:"æ•¦åšç«¯æ–¹ï¼Œå®ˆæ­£ä¸é˜¿ï¼Œè‡ªç„¶äº¨åˆ©ã€‚"},
    {index:3, text:"å…­ä¸‰ï¼šå«ç« å¯è²ã€‚æˆ–å¾ç‹äº‹ï¼Œç„¡æˆæœ‰çµ‚ã€‚", meaning:"å…§ç¾ä¸éœ²ï¼Œå®ˆæ­£å¯ä¹…ï¼›å¾äº‹ç‹å‹™ï¼Œé›–æœªé¡¯åŠŸï¼Œçµ‚èƒ½å–„æˆã€‚"},
    {index:4, text:"å…­å››ï¼šæ‹¬å›Šï¼Œç„¡å’ç„¡è­½ã€‚", meaning:"æ”¶æ–‚è¨€è¡Œï¼Œé¿ç¦ä¿å…¨ï¼›ä¸æ±‚åè²ã€‚"},
    {index:5, text:"å…­äº”ï¼šé»ƒè£³ï¼Œå…ƒå‰ã€‚", meaning:"ä¸­æ­£ä¹‹å¾·ï¼Œå…‰è€Œä¸è€€ï¼Œå¤§å‰ã€‚"},
    {index:6, text:"ä¸Šå…­ï¼šé¾æˆ°äºé‡ï¼Œå…¶è¡€ç„é»ƒã€‚", meaning:"å‰›æŸ”ç›¸æ¿€ï¼Œå…©æ•—ä¿±å‚·ï¼›æˆ’é€å¼·ã€‚"},
  ],
  // â€”â€” åç‚ºæ°´ï¼ˆå…¨ç²¾æ ¡ï¼‰ â€”â€”
  "åç‚ºæ°´": [
    {index:1, text:"åˆå…­ï¼šç¿’åï¼Œå…¥äºåçªï¼Œå‡¶ã€‚", meaning:"åè¦†é™·æ–¼éšªå¢ƒï¼Œé›£ä»¥è‡ªæ‹”ï¼Œå‡¶ã€‚"},
    {index:2, text:"ä¹äºŒï¼šåæœ‰éšªï¼Œæ±‚å°å¾—ã€‚", meaning:"è™•éšªå®œå°æ­¥æ±‚é€²ï¼Œå…ˆæ±‚å°åˆ©èˆ‡å°æˆã€‚"},
    {index:3, text:"å…­ä¸‰ï¼šä¾†ä¹‹ååï¼Œéšªä¸”æ•ï¼›å…¥äºåçªï¼Œå‹¿ç”¨ã€‚", meaning:"ç”±éšªåˆå…¥éšªï¼Œæ˜“æ·±é™·ï¼›æ­¤æ™‚ä¸å®œå¦„ç‚ºã€‚"},
    {index:4, text:"å…­å››ï¼šæ¨½é…’ç°‹è²³ï¼Œç”¨ç¼¶ï¼›ç´ç´„è‡ªç‰–ï¼Œçµ‚ç„¡å’ã€‚", meaning:"ä»¥ç°¡æ¨¸èª æ„æ±‚é€šï¼Œé›–è–„ç¦®ï¼Œèƒ½å…å’ã€‚"},
    {index:5, text:"ä¹äº”ï¼šåä¸ç›ˆï¼Œåªæ—¢å¹³ï¼Œç„¡å’ã€‚", meaning:"éšªå‹¢æœªæ»¿ä¸”æ¼¸å¹³ï¼ŒæŒä¸­å®ˆæ­£ï¼Œç„¡å’ã€‚"},
    {index:6, text:"ä¸Šå…­ï¼šä¿‚ç”¨å¾½çº†ï¼Œç½®äºå¢æ£˜ï¼Œä¸‰æ­²ä¸å¾—ï¼Œå‡¶ã€‚", meaning:"ç‚ºé›£æ‰€ç¸›ï¼Œä¹…å›°ä¸å¾—è„«ï¼Œå‡¶ã€‚"},
  ],
  // â€”â€” é›¢ç‚ºç«ï¼ˆé—œéµçˆ»ä¿®æ­£ï¼šé¿å…èª¤å¼•å™¬å—‘è¾­ï¼‰ â€”â€”
  "é›¢ç‚ºç«": [
    {index:1, text:"åˆä¹ï¼šå±¥éŒ¯ç„¶ï¼Œæ•¬ä¹‹ç„¡å’ã€‚", meaning:"è™•å‹¢ä¸ç©©ï¼Œå‹™é ˆæ•¬æ…ï¼Œæ–¹èƒ½ç„¡å’ã€‚"},
    {index:2, text:"å…­äºŒï¼šé»ƒé›¢ï¼Œå…ƒå‰ã€‚", meaning:"ä»¥ä¸­é“ä¹‹æ˜è‡ªå®ˆï¼Œå…‰è€€è€Œä¸åï¼Œå‰ã€‚"},
    {index:3, text:"ä¹ä¸‰ï¼šæ—¥æ˜ƒä¹‹é›¢ï¼Œä¸é¼“ç¼¶è€Œæ­Œï¼Œå‰‡å¤§è€‹ä¹‹å—Ÿï¼Œå‡¶ã€‚", meaning:"ç››æ™‚å°‡æš®è€Œä¸è‡ªçœï¼Œåå¤±å…¶é“ï¼Œå‡¶ã€‚"},
    {index:4, text:"ä¹å››ï¼šçªå¦‚å…¶ä¾†å¦‚ï¼Œç„šå¦‚ï¼›æ­»å¦‚æ£„å¦‚ã€‚", meaning:"èºé€²å¦„ä½œï¼Œç¦è‡³å€‰ä¿ƒï¼›è¼•å‰‡æå¤±ï¼Œé‡å‰‡å‚¾è¦†ã€‚"},
    {index:5, text:"å…­äº”ï¼šå‡ºæ¶•æ²±è‹¥ï¼Œæˆšå—Ÿè‹¥ï¼Œå‰ã€‚", meaning:"èƒ½ä»¥å“€çŸœè‡ªçœï¼Œè½‰ç¦ç‚ºç¦ï¼Œå‰ã€‚"},
    {index:6, text:"ä¸Šä¹ï¼šç‹ç”¨å‡ºå¾ï¼Œæœ‰å˜‰æŠ˜é¦–ï¼Œç²å…¶åŒªä¸‘ï¼Œç„¡å’ã€‚", meaning:"æ­£ç¾©è€Œä¼ï¼Œæ–¬ç²é¦–æƒ¡ï¼Œçµ‚å¾—ç„¡å’ã€‚"},
  ],
  // â€”â€” ç«é›·å™¬å—‘ï¼ˆå…¨ç²¾æ ¡ï¼Œç”¨ä»¥é‡æ¸…èˆ‡é›¢å¦æ··æ·†ï¼‰ â€”â€”
  "ç«é›·å™¬å—‘": [
    {index:1, text:"åˆä¹ï¼šå±¥æ ¡æ»…è¶¾ï¼Œç„¡å’ã€‚", meaning:"å‰›çŒ›èµ·æ­¥ï¼Œæ˜“å‚·å°è™•ï¼›æ”¶æ–‚å¯å…å’ã€‚"},
    {index:2, text:"å…­äºŒï¼šå™¬è†šï¼Œæ»…é¼»ï¼Œç„¡å’ã€‚", meaning:"å…ˆæ˜“å¾Œé›£ï¼Œè™•ç†è¡¨å±¤ä¹‹äº‹ï¼Œå°šå¯ç„¡å®³ã€‚"},
    {index:3, text:"å…­ä¸‰ï¼šå™¬è…Šè‚‰ï¼Œé‡æ¯’ï¼›å°åï¼Œç„¡å’ã€‚", meaning:"æ¶‰é›£æœ‰æ¯’ï¼Œé›–æœ‰å°å¤±ï¼Œçµ‚å¯å…éã€‚"},
    {index:4, text:"ä¹å››ï¼šå™¬ä¹¾èƒï¼Œå¾—é‡‘çŸ¢ï¼Œåˆ©è‰±è²ï¼Œå‰ã€‚", meaning:"æ”»å …å…‹é›£ï¼Œå¾—ä¸­æ­£ä¹‹å¿—ï¼Œå …å®ˆå‰‡å‰ã€‚"},
    {index:5, text:"å…­äº”ï¼šå™¬ä¹¾è‚‰ï¼Œå¾—é»ƒé‡‘ï¼Œè²å²ï¼Œç„¡å’ã€‚", meaning:"å»å…¶å …æ»¯è€Œå¾—å…¶ä¸­ï¼Œé›–å±çµ‚å…å’ã€‚"},
    {index:6, text:"ä¸Šä¹ï¼šä½•æ ¡æ»…è€³ï¼Œå‡¶ã€‚", meaning:"åˆ‘éå…¶åº¦ï¼Œåå‚·è€³ç›®ï¼Œå‡¶ã€‚"},
  ],
  // â€”â€” åœ°ç«æ˜å¤·ï¼ˆå…¨ç²¾æ ¡ï¼šå…­çˆ»å„ç•°ï¼Œä¿®å¾©åŸæª”é‡è¤‡ï¼‰ â€”â€”
  "åœ°ç«æ˜å¤·": [
    {index:1, text:"åˆä¹ï¼šæ˜å¤·äºé£›ï¼Œå‚å…¶ç¿¼ï¼›å›å­äºè¡Œï¼Œä¸‰æ—¥ä¸é£Ÿï¼›æœ‰æ”¸å¾€ï¼Œä¸»äººæœ‰è¨€ã€‚", meaning:"å—å‚·ä¹‹æ˜æš«æ”¶æ–‚ï¼Œæ—…é€”è‰±é›£ï¼Œå®œæ­¢ä¸å®œå¾€ã€‚"},
    {index:2, text:"å…­äºŒï¼šæ˜å¤·ï¼Œå¤·äºå·¦è‚¡ï¼Œç”¨æ‹¯é¦¬å£¯ï¼Œå‰ã€‚", meaning:"å—å‰µåæ¯ï¼Œè—‰å¤–åŠ›æ‰¶æŒï¼Œä»å¯è½‰å‰ã€‚"},
    {index:3, text:"ä¹ä¸‰ï¼šæ˜å¤·äºå—ç‹©ï¼Œå¾—å…¶å¤§é¦–ï¼Œä¸å¯ç–¾è²ã€‚", meaning:"è™•æ˜è€Œèª…æš´ï¼ŒåŠŸå¤§å®œå¯©æ…ï¼Œä¸å¯èºæ€¥ã€‚"},
    {index:4, text:"å…­å››ï¼šå…¥äºå·¦è…¹ï¼Œç²æ˜å¤·ä¹‹å¿ƒï¼Œäºå‡ºé–€åº­ã€‚", meaning:"æ·±å…¥å…¶å…§å¾—å…¶å¿ƒè¦ï¼Œä¹ƒå¯è„«èº«ã€‚"},
    {index:5, text:"å…­äº”ï¼šç®•å­ä¹‹æ˜å¤·ï¼Œåˆ©è²ã€‚", meaning:"ä»¥è³¢è€…ä¹‹é“è‡ªå®ˆï¼Œé›–é‡æš—ä¸–ï¼Œè²å‰‡åˆ©ã€‚"},
    {index:6, text:"ä¸Šå…­ï¼šä¸æ˜æ™¦ï¼›åˆç™»äºå¤©ï¼Œå¾Œå…¥äºåœ°ã€‚", meaning:"æ˜æš—åè¦†ï¼Œé«˜å¢œç›¸å°‹ï¼›å®œé¿å…¶æ™‚ã€‚"},
  ],
  // â€”â€” å…¶é¤˜å…­åå››å¦ï¼šå ä½ï¼ˆå¾…è£œï¼‰ â€”â€”
};

// ===== 2) è‡ªå‹•æ¸…ç†é‡è¤‡/éŒ¯ç½®çˆ»ç´¢å¼•ï¼ˆè³‡æ–™æ ¡æ­£ï¼‰ =====
(function sanitizeHexagramsData(){
  try{
    Object.keys(hexagramsData).forEach(name=>{
      const arr = hexagramsData[name];
      if(!Array.isArray(arr)) return;
      const seen = new Set();
      const cleaned = [];
      for(const it of arr){
        if(!it || typeof it.index!=="number") continue;
        const idx = it.index|0;
        if(idx<1||idx>6) continue;
        if(seen.has(idx)) continue; // å»é‡
        seen.add(idx);
        cleaned.push({index:idx, text:String(it.text||"").trim(), meaning:String(it.meaning||"").trim()||"ï¼ˆå¾…è£œï¼‰"});
      }
      // è‹¥ä¸è¶³å…­æ¢ï¼Œä¿ç•™æ—¢æœ‰ï¼›ç¼ºæ¼æ¨™ç¤ºå¾…è£œ
      for(let i=1;i<=6;i++) if(!cleaned.find(x=>x.index===i)) cleaned.push({index:i, text:"ï¼ˆå¾…è£œï¼‰", meaning:"ï¼ˆå¾…è£œï¼‰"});
      cleaned.sort((a,b)=>a.index-b.index);
      hexagramsData[name]=cleaned;
    });
    console.log("[ä¿®æ­£] hexagramsData å·²æ¸…ç†ä¸¦è£œè¶³å ä½ã€‚");
  }catch(e){console.warn("sanitizeHexagramsData error:",e)}
})();

// ===== 3) å¯é¸çš„äººå·¥ä½œåˆ¤ï¼ˆè‹¥æœ‰å‰‡å„ªå…ˆï¼‰ =====
const judgementData = {
  "ä¹¾ç‚ºå¤©": { base:"å¤§å‰", advice:"å¤§å‹¢å‘ä¸Šï¼Œå®œèˆ‡è³¢åŒè¡Œï¼›åˆ‡å¿Œå‰›éã€‚", movingLines:{
    1:{type:"å¹³", advice:"è“„å‹¢å¾…æ™‚ï¼Œå‹¿èºé€²ã€‚"},
    5:{type:"å¤§å‰", advice:"å¯å¤§å±•æ‰€é•·ï¼Œè¦‹è³¢æ€é½Šã€‚"},
    6:{type:"å°å‡¶", advice:"äº¢æ¥µå‰‡æŠ˜ï¼Œå®œæ”¶æ–‚é€€é¿ã€‚"}
  }},
  "å¤ç‚ºåœ°": { base:"å°å‰", advice:"ä»¥æŸ”æ‰¿å‰›ï¼Œåšå¾·è¼‰ç‰©ï¼›ä¸æ±‚é€Ÿæˆã€‚" },
  "åœ°ç«æ˜å¤·": { base:"å°å‡¶", advice:"æ˜å—å‚·ï¼Œå®œé¿å…¶é‹’ï¼Œå…§ä¿®å¤–å®ˆã€‚" },
  "åç‚ºæ°´": { base:"å°å‡¶", advice:"é‡éšªä¹‹å¦ï¼Œåˆ†æ®µæ±‚é€²ï¼Œåˆ‡å¿Œèºå‹•ã€‚" },
};

// ===== 4) ç¶œåˆå‰å‡¶æ¼”ç®—æ³•ï¼ˆæœ¬å¦ > è®Šå¦ > äº’å¦ï¼Œå‹•çˆ»åŠ æ¬Šï¼‰ =====
function getJudgement(guaName, movingLines){
  const data = judgementData[guaName];
  if(data){
    if(movingLines.length===0) return {type:data.base, advice:data.advice};
    if(movingLines.length===1 && data.movingLines && data.movingLines[movingLines[0]]){
      return data.movingLines[movingLines[0]];
    }
    // å…¶é¤˜æƒ…å½¢å›é€€åˆ°æ¼”ç®—æ³•
  }

  const WEIGHT_BASE=1.0, WEIGHT_CHANGE=0.6, WEIGHT_MUTUAL=0.35, WEIGHT_MOVING=1.2;
  const baseName = document.getElementById("base-gua-name")?.textContent?.split(" ").pop()||guaName;
  const changeName = document.getElementById("change-gua-name")?.textContent?.split(" ").pop()||"";
  const mutualName = document.getElementById("hu-gua-name")?.textContent?.split(" ").pop()||"";

  function scoreBy(name, mov){
    const items = hexagramsData[name]||[]; let score=0; const notes=[];
    const plus=[/å‰/,/ç„¡å’/,/åˆ©(?!ç”¨åˆ‘)/,/äº¨/,/å…ƒå‰/,/å°å‰/];
    const minus=[/å‡¶/,/å²/,/æ‚”(?!äº¡)/,/æœ‰å’|å’/,/ä¸åˆ©/,/å›°/,/å‰/];
    for(const it of items){
      const t=(it.text||"")+" "+(it.meaning||"");
      if(plus.some(r=>r.test(t))) score+=0.15;
      if(minus.some(r=>r.test(t))) score-=0.15;
    }
    for(const ln of mov){
      const it=items.find(x=>x.index===ln); if(!it) continue; const t=(it.text||"")+" "+(it.meaning||"");
      let d=0; if(/å‰|ç„¡å’|åˆ©/.test(t)) d+=0.8; if(/å‡¶|å²|æ‚”|å’|ä¸åˆ©/.test(t)) d-=0.8;
      score+=d*WEIGHT_MOVING; if(d>0.01) notes.push(`å‹•çˆ»${ln}åå‰`); if(d<-0.01) notes.push(`å‹•çˆ»${ln}åå‡¶`);
    }
    return {score, notes};
  }

  const baseRes=scoreBy(baseName, movingLines);
  const changeRes=changeName?scoreBy(changeName,[]):{score:0,notes:[]};
  const mutualRes=mutualName?scoreBy(mutualName,[]):{score:0,notes:[]};
  const total=baseRes.score*WEIGHT_BASE + changeRes.score*WEIGHT_CHANGE + mutualRes.score*WEIGHT_MUTUAL;

  let type="å¹³";
  if(total>=1.6) type="å¤§å‰"; else if(total>=0.6) type="å°å‰"; else if(total<=-1.6) type="å¤§å‡¶"; else if(total<=-0.6) type="å°å‡¶";

  const tips=[];
  if(type.includes("å‰")) tips.push("å¯é€²å–ï¼Œä¸»å‹•çˆ­å–æ©Ÿæœƒã€‚");
  if(type.includes("å‡¶")) tips.push("å®œå®ˆä¸å®œé€²ï¼Œé™ä½é¢¨éšªã€‚");
  if(movingLines.length>=3) tips.push("å¤šçˆ»åŒå‹•ï¼Œå±€å‹¢å¤šè®Šï¼Œéœ€åˆ†æ®µèª¿æ•´ç­–ç•¥ã€‚");
  const txtBase=(hexagramsData[baseName]||[]).map(i=>i.text).join(" ");
  if(/åˆ©è¦‹å¤§äºº/.test(txtBase)) tips.push("æœ‰è²´äººç›¸åŠ©ï¼Œå®œçˆ­å–æ”¯æ´ã€‚");
  if(/ä¸åˆ©|å‹¿ç”¨|æœ‰å’/.test(txtBase)) tips.push("é¿å…é€å¼·ï¼Œå…ˆè™•ç†é¢¨éšªé»ã€‚");

  const noteStr=[...baseRes.notes,...changeRes.notes,...mutualRes.notes].slice(0,4).join("ï¼›");
  return {type, advice:(noteStr?(noteStr+"ã€‚ "):"")+(tips[0]||"æŒä¸­è€Œè¡Œï¼Œå¯©æ™‚åº¦å‹¢ã€‚")};
}

// ===== 5) å·¥å…·ï¼šå…­çˆ»ä½å…ƒã€åç¨±ã€äº’å¦èˆ‡è®Šå¦ =====
function bitsToName(bits){ // bits: "010111" è‡ªä¸‹è€Œä¸Š
  return BIN2META[bits]?.name || "ï¼ˆæœªåå¦ï¼‰";
}
function bitsToMeta(bits){ return BIN2META[bits] || {no:"â€”", name:"ï¼ˆæœªåå¦ï¼‰", short:"â€”"}; }
function flap(bit){ return bit==="1"?"0":"1"; }
function calcChange(bits, moving){
  const arr=bits.split("");
  for(const m of moving){ const idx=m-1; arr[idx]=flap(arr[idx]); }
  return arr.join("");
}
function calcMutual(bits){
  // äº’å¦ï¼šä¸‹äº’ï¼ˆ2-4ï¼‰ï¼‹ä¸Šäº’ï¼ˆ3-5ï¼‰
  const a=bits.split("");
  const lower=a.slice(1,4).join(""); // 2-4
  const upper=a.slice(2,5).join(""); // 3-5
  return lower+upper;
}

// ===== 6) ä»‹é¢ç¶å®š =====
const elSelect=document.getElementById('hex-select');
const elYY=document.getElementById('yin-yang-row');
const elMove=document.getElementById('moving-row');
const elBaseName=document.getElementById('base-gua-name');
const elChangeName=document.getElementById('change-gua-name');
const elHuName=document.getElementById('hu-gua-name');
const elBaseNo=document.getElementById('base-gua-no');
const elBaseBits=document.getElementById('base-gua-bits');
const elMoving=document.getElementById('moving-lines');
const elTBody=document.getElementById('lines-tbody');
const elJudgeType=document.getElementById('judge-type');
const elJudgeAdvice=document.getElementById('judge-advice');

// ä¸‹æ‹‰åˆ—å‡º 64 å¦
for(const meta of META_LIST){
  const opt=document.createElement('option');
  opt.value=meta.no; opt.textContent=`${meta.no.toString().padStart(2,'0')}ï¼${meta.name}`;
  elSelect.appendChild(opt);
}

// é™°é™½åˆ‡æ›ï¼ˆå…­å€‹é–‹é—œï¼Œ1 åœ¨æœ€ä¸‹ï¼‰
function makeYY(){ elYY.innerHTML='';
  for(let i=1;i<=6;i++){
    const wrap=document.createElement('div'); wrap.className='row';
    const lab=document.createElement('label'); lab.textContent=`${i}`; lab.style.minWidth='12px';
    const sel=document.createElement('select'); sel.dataset.idx=i;
    sel.innerHTML='<option value="0">é™°(â€” â€”)</option><option value="1">é™½(â€”â€”)</option>';
    sel.addEventListener('change',()=>{ elSelect.value = metaFromBits(currentBits()).no; render(); });
    wrap.appendChild(lab); wrap.appendChild(sel); elYY.appendChild(wrap);
  }
}
makeYY();

// å‹•çˆ»è¤‡é¸
function makeMoving(){ elMove.innerHTML='';
  for(let i=1;i<=6;i++){
    const id='mv'+i; const cb=document.createElement('input'); cb.type='checkbox'; cb.id=id; cb.dataset.idx=i;
    const lab=document.createElement('label'); lab.setAttribute('for',id); lab.textContent=String(i);
    cb.addEventListener('change',render); const box=document.createElement('div'); box.className='row'; box.appendChild(cb); box.appendChild(lab); elMove.appendChild(box);
  }
}
makeMoving();

function setBits(bits){ // bits è‡ªä¸‹è€Œä¸Š
  const a=bits.split(""); for(let i=1;i<=6;i++){ const sel=elYY.querySelector(`select[data-idx="${i}"]`); sel.value=a[i-1]; }
}
function currentBits(){ let s=''; for(let i=1;i<=6;i++){ const v=elYY.querySelector(`select[data-idx="${i}"]`).value; s+=v; } return s; }
function currentMoving(){ const arr=[]; for(let i=1;i<=6;i++){ const cb=elMove.querySelector(`input[data-idx="${i}"]`); if(cb.checked) arr.push(i); } return arr; }
function metaFromBits(bits){ return bitsToMeta(bits); }

elSelect.addEventListener('change',()=>{
  // å°‡ä¸‹æ‹‰é¸æ“‡è½‰æˆ bits
  const targetNo=parseInt(elSelect.value,10);
  const meta=META_LIST.find(x=>x.no===targetNo);
  const bits=Object.entries(BIN2META).find(([k,v])=>v.no===meta.no)[0];
  setBits(bits); render();
});

document.getElementById('btn-random').addEventListener('click',()=>{
  const metas=META_LIST; const rnd=metas[Math.floor(Math.random()*metas.length)];
  const bits=Object.entries(BIN2META).find(([k,v])=>v.no===rnd.no)[0];
  setBits(bits);
  // éš¨æ©Ÿå‹•çˆ» 0~3 å€‹
  for(let i=1;i<=6;i++){ elMove.querySelector(`input[data-idx="${i}"]`).checked = Math.random()<0.3; }
  elSelect.value=rnd.no; render();
});

document.getElementById('btn-clear').addEventListener('click',()=>{
  setBits('000000'); for(let i=1;i<=6;i++){ elMove.querySelector(`input[data-idx="${i}"]`).checked=false; }
  elSelect.value=META_LIST[0].no; render();
});

function render(){
  const bits=currentBits(); const moving=currentMoving(); const meta=metaFromBits(bits);
  const changeBits=calcChange(bits, moving);
  const mutualBits=calcMutual(bits);
  const changeMeta=metaFromBits(changeBits); const mutualMeta=metaFromBits(mutualBits);

  elBaseName.textContent = `${meta.no}. ${meta.name}`;
  elChangeName.textContent = changeMeta.no!=="â€”"? `${changeMeta.no}. ${changeMeta.name}` : 'â€”';
  elHuName.textContent = mutualMeta.no!=="â€”"? `${mutualMeta.no}. ${mutualMeta.name}` : 'â€”';
  elBaseNo.textContent = meta.no; elBaseBits.textContent = bits; elMoving.textContent = moving.length? moving.join(', '):'ç„¡';

  // å¡«é€çˆ»
  const rows = (hexagramsData[meta.name]||[]).slice().sort((a,b)=>a.index-b.index);
  elTBody.innerHTML = rows.map(r=>`<tr><td>${r.index}</td><td class="mono">${escapeHtml(r.text||'ï¼ˆå¾…è£œï¼‰')}</td><td>${escapeHtml(r.meaning||'ï¼ˆå¾…è£œï¼‰')}</td></tr>`).join('');

  // ç¶œåˆåˆ¤æ–·
  const judge=getJudgement(meta.name, moving);
  elJudgeType.textContent = judge.type || 'â€”';
  elJudgeType.className = 'pill ' + (judge.type?.includes('å‰')?'good':(judge.type?.includes('å‡¶')?'bad':''));
  elJudgeAdvice.textContent = judge.advice || 'â€”';
}

function escapeHtml(s){return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}

// åˆå§‹åŒ–ï¼šé è¨­ ä¹¾å¦
(function init(){
  const qianBits=Object.entries(BIN2META).find(([k,v])=>v.no===1)[0];
  setBits(qianBits); elSelect.value=1; render();
})();

// ===== 7) åŒ¯å…¥ / åŒ¯å‡º =====
const elFile=document.getElementById('file-import');
document.getElementById('btn-import').addEventListener('click',()=>elFile.click());
elFile.addEventListener('change',async(e)=>{
  const file=e.target.files?.[0]; if(!file) return;
  const txt=await file.text();
  try{ const obj=JSON.parse(txt); if(typeof obj!=="object") throw new Error('æ ¼å¼éŒ¯èª¤');
    Object.assign(hexagramsData, obj); sanitizeHexagramsData(); render(); alert('å·²è¼‰å…¥ä¸¦è¦†å¯«è³‡æ–™ã€‚');
  }catch(err){ alert('JSON è§£æå¤±æ•—ï¼š'+err.message); }
});

document.getElementById('btn-export').addEventListener('click',()=>{
  const blob=new Blob([JSON.stringify(hexagramsData,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='zhouyi_data.json'; a.click(); URL.revokeObjectURL(url);
});
</script></body>
</html>
