<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢…èŠ±æ˜“æ•¸åœå¦ç³»çµ± - å°‹æ‰¾éºå¤±ç‰©æˆ–äººç‰©</title>
    <style>
        body {
            font-family: 'Noto Sans TC', Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 30px;
            line-height: 1.8;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 2.2em;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            font-size: 1.5em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        h2::before {
            content: 'ğŸ”®';
            margin-right: 10px;
        }
        section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
        }
        select[multiple] {
            height: 100px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            margin-right: 10px;
        }
        button::before {
            content: 'âœ¨';
            margin-right: 8px;
        }
        button:hover {
            background-color: #2980b9;
        }
        #result {
            margin-top: 30px;
            padding: 20px;
            background: #e8f4f8;
            border: 1px solid #3498db;
            border-radius: 8px;
        }
        .hexagram-row {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .hexagram-column {
            text-align: center;
            margin: 10px;
            min-width: 120px;
        }
        .hexagram {
            font-size: 2em;
            margin: 5px 0;
        }
        .hexagram-body {
            color: #2980b9; /* é«”å¦ç”¨è—è‰² */
        }
        .hexagram-use {
            color: #e74c3c; /* ç”¨å¦ç”¨ç´…è‰² */
        }
        .hexagram-label {
            font-size: 1em;
            color: #34495e;
            margin: 5px 0;
        }
        .hidden {
            display: none;
        }
        .section-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }
        .history-item {
            padding: 10px;
            margin-bottom: 10px;
            background: #f0f0f0;
            border-radius: 6px;
            cursor: pointer;
        }
        .history-item:hover {
            background: #e0e0e0;
        }
        input[type="file"] {
            padding: 10px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>æ¢…èŠ±æ˜“æ•¸åœå¦ç³»çµ± - å°‹æ‰¾éºå¤±ç‰©æˆ–äººç‰©</h1>
        
        <!-- A. åœå¦èµ·å§‹ï¼šé¸æ“‡å æ¸¬ç›®æ¨™ -->
        <section id="target-selection">
            <h2><span class="section-icon">ğŸ¯</span>æ‚¨æƒ³è¦å æ¸¬ä»€éº¼ï¼Ÿ</h2>
            <label>æ¡ˆä»¶åç¨±:</label>
            <input type="text" id="case-name" placeholder="è«‹è¼¸å…¥æ¡ˆä»¶åç¨±ï¼ˆå¦‚ï¼šå°‹æ‰¾æ‰‹éŒ¶ï¼‰">
            <label>å æ¸¬ç›®æ¨™:</label>
            <select id="target-type">
                <option value="">è«‹é¸æ“‡</option>
                <option value="lost-item">å°‹æ‰¾éºå¤±ç‰©</option>
                <option value="lost-person">å°‹æ‰¾äººç‰©</option>
                <option value="other">å…¶ä»–</option>
            </select>
        </section>
        
        <!-- B. æ­¥é©Ÿä¸€ï¼šé¸æ“‡èµ·å¦æ–¹å¼ -->
        <section id="divination-method" class="hidden">
            <h2><span class="section-icon">ğŸ•°ï¸</span>è«‹é¸æ“‡ä¸€ç¨®èµ·å¦æ–¹å¼</h2>
            <select id="method">
                <option value="">è«‹é¸æ“‡</option>
                <option value="time">æ™‚é–“èµ·å¦</option>
                <option value="number">æ•¸å­—èµ·å¦</option>
                <option value="manual">æ‰‹å‹•è¼¸å…¥å¦è±¡</option>
            </select>
            
            <!-- æ™‚é–“èµ·å¦è¼¸å…¥ -->
            <div id="time-input" class="hidden">
                <p>æ™‚é–“èµ·å¦å°‡ä½¿ç”¨ç³»çµ±ç•¶å‰è¾²æ›†æ™‚é–“ï¼ˆå¯é»é¸èª¿æ•´ï¼‰</p>
                <label>å¹´æ”¯:</label>
                <select id="lunar-year">
                    <option value="1">å­</option>
                    <option value="2">ä¸‘</option>
                    <option value="3">å¯…</option>
                    <option value="4">å¯</option>
                    <option value="5">è¾°</option>
                    <option value="6" selected>å·³</option>
                    <option value="7">åˆ</option>
                    <option value="8">æœª</option>
                    <option value="9">ç”³</option>
                    <option value="10">é…‰</option>
                    <option value="11">æˆŒ</option>
                    <option value="12">äº¥</option>
                </select>
                <label>æœˆæ•¸:</label>
                <select id="lunar-month">
                    <option value="1">ä¸€æœˆ</option>
                    <option value="2">äºŒæœˆ</option>
                    <option value="3">ä¸‰æœˆ</option>
                    <option value="4">å››æœˆ</option>
                    <option value="5">äº”æœˆ</option>
                    <option value="6">å…­æœˆ</option>
                    <option value="7">ä¸ƒæœˆ</option>
                    <option value="8">å…«æœˆ</option>
                    <option value="9" selected>ä¹æœˆ</option>
                    <option value="10">åæœˆ</option>
                    <option value="11">åä¸€æœˆ</option>
                    <option value="12">åäºŒæœˆ</option>
                </select>
                <label>æ—¥æ•¸:</label>
                <select id="lunar-day">
                    <option value="1">åˆä¸€</option>
                    <option value="2">åˆäºŒ</option>
                    <option value="3">åˆä¸‰</option>
                    <option value="4">åˆå››</option>
                    <option value="5">åˆäº”</option>
                    <option value="6" selected>åˆå…­</option>
                    <option value="7">åˆä¸ƒ</option>
                    <option value="8">åˆå…«</option>
                    <option value="9">åˆä¹</option>
                    <option value="10">åˆå</option>
                    <option value="11">åä¸€</option>
                    <option value="12">åäºŒ</option>
                    <option value="13">åä¸‰</option>
                    <option value="14">åå››</option>
                    <option value="15">åäº”</option>
                    <option value="16">åå…­</option>
                    <option value="17">åä¸ƒ</option>
                    <option value="18">åå…«</option>
                    <option value="19">åä¹</option>
                    <option value="20">äºŒå</option>
                    <option value="21">å»¿ä¸€</option>
                    <option value="22">å»¿äºŒ</option>
                    <option value="23">å»¿ä¸‰</option>
                    <option value="24">å»¿å››</option>
                    <option value="25">å»¿äº”</option>
                    <option value="26">å»¿å…­</option>
                    <option value="27">å»¿ä¸ƒ</option>
                    <option value="28">å»¿å…«</option>
                    <option value="29">å»¿ä¹</option>
                    <option value="30">ä¸‰å</option>
                </select>
                <label>æ™‚è¾°:</label>
                <select id="lunar-hour">
                    <option value="1">å­æ™‚ (23:00-01:00)</option>
                    <option value="2">ä¸‘æ™‚ (01:00-03:00)</option>
                    <option value="3">å¯…æ™‚ (03:00-05:00)</option>
                    <option value="4">å¯æ™‚ (05:00-07:00)</option>
                    <option value="5">è¾°æ™‚ (07:00-09:00)</option>
                    <option value="6">å·³æ™‚ (09:00-11:00)</option>
                    <option value="7">åˆæ™‚ (11:00-13:00)</option>
                    <option value="8">æœªæ™‚ (13:00-15:00)</option>
                    <option value="9" selected>ç”³æ™‚ (15:00-17:00)</option>
                    <option value="10">é…‰æ™‚ (17:00-19:00)</option>
                    <option value="11">æˆŒæ™‚ (19:00-21:00)</option>
                    <option value="12">äº¥æ™‚ (21:00-23:00)</option>
                </select>
                <button id="set-current-time">ä½¿ç”¨ç•¶å‰æ™‚é–“</button>
            </div>
            
            <!-- æ•¸å­—èµ·å¦è¼¸å…¥ -->
            <div id="number-input" class="hidden">
                <label>ç¬¬ä¸€å€‹æ•¸å­— (ä»»æ„):</label>
                <input type="number" id="num1" value="0">
                <label>ç¬¬äºŒå€‹æ•¸å­—:</label>
                <input type="number" id="num2" value="0">
                <label>ç¬¬ä¸‰å€‹æ•¸å­—:</label>
                <input type="number" id="num3" value="0">
            </div>
            
            <!-- æ‰‹å‹•è¼¸å…¥å¦è±¡ -->
            <div id="manual-input" class="hidden">
                <label>ä¸Šå¦:</label>
                <select id="upper-trigram">
                    <option value="1">ä¹¾ (â˜°)</option>
                    <option value="2">å…Œ (â˜±)</option>
                    <option value="3">é›¢ (â˜²)</option>
                    <option value="4">éœ‡ (â˜³)</option>
                    <option value="5">å·½ (â˜´)</option>
                    <option value="6">å (â˜µ)</option>
                    <option value="7">è‰® (â˜¶)</option>
                    <option value="8">å¤ (â˜·)</option>
                </select>
                <label>ä¸‹å¦:</label>
                <select id="lower-trigram">
                    <option value="1">ä¹¾ (â˜°)</option>
                    <option value="2">å…Œ (â˜±)</option>
                    <option value="3">é›¢ (â˜²)</option>
                    <option value="4">éœ‡ (â˜³)</option>
                    <option value="5">å·½ (â˜´)</option>
                    <option value="6">å (â˜µ)</option>
                    <option value="7">è‰® (â˜¶)</option>
                    <option value="8">å¤ (â˜·)</option>
                </select>
                <label>å‹•çˆ» (1-6):</label>
                <input type="number" id="moving-line" min="1" max="6" value="1">
            </div>
        </section>
        
        <!-- C. æ­¥é©ŸäºŒï¼šè¼¸å…¥æ¬²å°‹ç›®æ¨™çš„è©³ç´°å±¬æ€§ -->
        <section id="target-details" class="hidden">
            <h2><span class="section-icon">ğŸ“</span>è«‹æä¾›æ›´å¤šé—œæ–¼æ‚¨è¦å°‹æ‰¾çš„ç´°ç¯€ï¼ˆå±¬æ€§å°‡å½±éŸ¿ç·šç´¢ç²¾ç¢ºåº¦ï¼‰</h2>
            
            <!-- éºå¤±ç‰©ç´°ç¯€ -->
            <div id="lost-item-details" class="hidden">
                <label><input type="checkbox" id="item-attributes-relevant" checked> ç‰©å“å±¬æ€§èˆ‡æ¨ç®—ç›¸é—œ</label>
                <label>ç‰©å“é¡åˆ¥:</label>
                <select id="item-category" multiple>
                    <option value="è²´é‡ç‰©å“">è²´é‡ç‰©å“ (é‡‘ã€ç‰ç­‰)</option>
                    <option value="æ–‡æ›¸/é›»å­ç”¢å“">æ–‡æ›¸/é›»å­ç”¢å“</option>
                    <option value="é‡‘å±¬è£½å“">é‡‘å±¬è£½å“</option>
                    <option value="æœ¨è£½å“">æœ¨è£½å“</option>
                    <option value="åœŸå™¨ç“¦å™¨/é™¶ç“·">åœŸå™¨ç“¦å™¨/é™¶ç“·</option>
                    <option value="å¸ƒæ–™/è¡£ç‰©">å¸ƒæ–™/è¡£ç‰©</option>
                    <option value="æ°´ç›¸é—œç‰©å“">æ°´ç›¸é—œç‰©å“</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
                <label>é¡è‰²:</label>
                <select id="item-color">
                    <option value="">ç„¡</option>
                    <option value="ç´…">ç´…</option>
                    <option value="é»ƒ">é»ƒ</option>
                    <option value="è—">è—</option>
                    <option value="ç¶ ">ç¶ </option>
                    <option value="ç™½">ç™½</option>
                    <option value="é»‘">é»‘</option>
                    <option value="ç´«">ç´«</option>
                </select>
                <label>å½¢ç‹€:</label>
                <select id="item-shape">
                    <option value="">ç„¡</option>
                    <option value="åœ“å½¢">åœ“å½¢</option>
                    <option value="æ–¹å½¢">æ–¹å½¢</option>
                    <option value="é•·å½¢">é•·å½¢</option>
                    <option value="ä¸è¦å‰‡">ä¸è¦å‰‡</option>
                </select>
                <label>æè³ª:</label>
                <select id="item-material">
                    <option value="">ç„¡</option>
                    <option value="é‡‘å±¬">é‡‘å±¬</option>
                    <option value="æœ¨">æœ¨</option>
                    <option value="é™¶ç“·">é™¶ç“·</option>
                    <option value="å¸ƒæ–™">å¸ƒæ–™</option>
                    <option value="å¡‘æ–™">å¡‘æ–™</option>
                    <option value="ç»ç’ƒ">ç»ç’ƒ</option>
                </select>
                <label>å…¶ä»–ç‰¹å¾µ:</label>
                <textarea id="item-other" placeholder="å¤§å°ã€æ–°èˆŠç­‰"></textarea>
            </div>
            
            <!-- äººç‰©ç´°ç¯€ -->
            <div id="lost-person-details" class="hidden">
                <label><input type="checkbox" id="person-attributes-relevant" checked> äººç‰©å±¬æ€§èˆ‡æ¨ç®—ç›¸é—œ</label>
                <label>èˆ‡å åœè€…çš„é—œä¿‚:</label>
                <select id="person-relation">
                    <option value="">ç„¡</option>
                    <option value="å®¶äºº">å®¶äºº</option>
                    <option value="æœ‹å‹">æœ‹å‹</option>
                    <option value="åŒäº‹">åŒäº‹</option>
                    <option value="é™Œç”Ÿäºº">é™Œç”Ÿäºº</option>
                    <option value="å«ŒçŠ¯">å«ŒçŠ¯</option>
                    <option value="è¢«å®³äºº">è¢«å®³äºº</option>
                </select>
                <label>æ€§åˆ¥:</label>
                <select id="person-gender">
                    <option value="">ç„¡</option>
                    <option value="ç”·">ç”·</option>
                    <option value="å¥³">å¥³</option>
                </select>
                <label>å¹´é½¡ç¯„åœ:</label>
                <select id="person-age">
                    <option value="">ç„¡</option>
                    <option value="å¹¼ç«¥">å¹¼ç«¥</option>
                    <option value="å°‘å¹´">å°‘å¹´</option>
                    <option value="é’å¹´">é’å¹´</option>
                    <option value="ä¸­å¹´">ä¸­å¹´</option>
                    <option value="è€å¹´">è€å¹´</option>
                </select>
                <label>å¤–è²Œç‰¹å¾µ:</label>
                <select id="person-appearance">
                    <option value="">ç„¡</option>
                    <option value="é«˜å¤§">é«˜å¤§</option>
                    <option value="çŸ®å°">çŸ®å°</option>
                    <option value="ç˜¦é•·">ç˜¦é•·</option>
                    <option value="è‚¥èƒ–">è‚¥èƒ–</option>
                    <option value="é ­é«®é•·">é ­é«®é•·</option>
                    <option value="é ­é«®çŸ­">é ­é«®çŸ­</option>
                </select>
                <label>è¡Œç‚ºæ¨¡å¼:</label>
                <select id="person-behavior">
                    <option value="">ç„¡</option>
                    <option value="éœæ­¢">éœæ­¢</option>
                    <option value="æ´»èº">æ´»èº</option>
                    <option value="æ²‰é»˜">æ²‰é»˜</option>
                    <option value="å¥è«‡">å¥è«‡</option>
                </select>
                <label>è·æ¥­/èº«ä»½:</label>
                <select id="person-occupation">
                    <option value="">ç„¡</option>
                    <option value="å®˜è²´">å®˜è²´</option>
                    <option value="è¾²å¤«">è¾²å¤«</option>
                    <option value="æ–‡äºº">æ–‡äºº</option>
                    <option value="è»äºº">è»äºº</option>
                    <option value="å•†äºº">å•†äºº</option>
                    <option value="å­¸ç”Ÿ">å­¸ç”Ÿ</option>
                </select>
                <label>å¤±è¹¤å‰æƒ…æ³:</label>
                <textarea id="person-situation"></textarea>
            </div>
        </section>
        
        <!-- D. æ­¥é©Ÿä¸‰ï¼šå åœæ™‚å¤–æ‡‰è¨˜éŒ„ -->
        <section id="external-response" class="hidden">
            <h2><span class="section-icon">ğŸŒŸ</span>å åœæ™‚å¤–æ‡‰è¨˜éŒ„ (é¸å¡«ï¼Œå½±éŸ¿ç·šç´¢ç²¾ç¢ºåº¦)</h2>
            <textarea id="external-desc" placeholder="æè¿°å‘¨é­ç‰¹åˆ¥äº‹ä»¶ï¼Œå¦‚ç‹—å«ã€ç´…è‰²ç‰©é«”ç­‰"></textarea>
        </section>
        
        <button id="start-divination">é–‹å§‹åœå¦</button>
        
        <!-- E. åœå¦çµæœé¡¯ç¤º -->
        <section id="result" class="hidden">
            <h2><span class="section-icon">ğŸ“œ</span>åœå¦çµæœ</h2>
            <div id="hexagram-display"></div>
            <div id="interpretation"></div>
        </section>
        
        <!-- F. é€²éšæ‡‰ç”¨ -->
        <section id="advanced" class="hidden">
            <h2><span class="section-icon">âš™ï¸</span>é€²éšåŠŸèƒ½</h2>
            <button id="view-history">æ­·å²ç´€éŒ„</button>
            <div id="history-records" class="hidden"></div>
            <button id="export-history">åŒ¯å‡ºæ­·å²ç´€éŒ„</button>
            <input type="file" id="import-history" accept=".json">
            <button id="view-cases">æŸ¥çœ‹å¦ä¾‹åº«</button>
            <div id="case-studies" class="hidden"></div>
            <button id="view-notes"><a href="notes.html" style="color: white; text-decoration: none;">æ³¨æ„äº‹é …</a></button>
            <div id="notes-info" class="hidden"></div>
            <button id="view-help"><a href="help.html" style="color: white; text-decoration: none;">ä½¿ç”¨èªªæ˜</a></button>
        </section>
    </div>

    <script>
        // JavaScript æ ¸å¿ƒé‚è¼¯

        // å®šç¾©å…§åµŒè³‡æ–™
        const inlineData = {
            trigrams: {
                "1": {"name": "ä¹¾", "symbol": "â˜°", "five_element": "é‡‘", "å…ˆå¤©æ•¸": 1, "binary": [1,1,1]},
                "2": {"name": "å…Œ", "symbol": "â˜±", "five_element": "é‡‘", "å…ˆå¤©æ•¸": 2, "binary": [1,1,0]},
                "3": {"name": "é›¢", "symbol": "â˜²", "five_element": "ç«", "å…ˆå¤©æ•¸": 3, "binary": [1,0,1]},
                "4": {"name": "éœ‡", "symbol": "â˜³", "five_element": "æœ¨", "å…ˆå¤©æ•¸": 4, "binary": [1,0,0]},
                "5": {"name": "å·½", "symbol": "â˜´", "five_element": "æœ¨", "å…ˆå¤©æ•¸": 5, "binary": [0,1,1]},
                "6": {"name": "å", "symbol": "â˜µ", "five_element": "æ°´", "å…ˆå¤©æ•¸": 6, "binary": [0,1,0]},
                "7": {"name": "è‰®", "symbol": "â˜¶", "five_element": "åœŸ", "å…ˆå¤©æ•¸": 7, "binary": [0,0,1]},
                "8": {"name": "å¤", "symbol": "â˜·", "five_element": "åœŸ", "å…ˆå¤©æ•¸": 8, "binary": [0,0,0]}
            },
            five_elements_relations: {
                "ç›¸ç”Ÿ": {"é‡‘": "æ°´", "æ°´": "æœ¨", "æœ¨": "ç«", "ç«": "åœŸ", "åœŸ": "é‡‘"},
                "ç›¸å‰‹": {"é‡‘": "æœ¨", "æœ¨": "åœŸ", "åœŸ": "æ°´", "æ°´": "ç«", "ç«": "é‡‘"}
            },
            trigram_properties: {
                "ä¹¾": {
                    "äº”è¡Œ": "é‡‘", 
                    "æ–¹ä½": "è¥¿åŒ— (å¾Œå³æ–¹)", 
                    "äººç‰©": ["å¤©", "çˆ¶", "è€çˆ¶", "å®˜è²´", "é ­", "å¤§äºº", "é•·è€…"],
                    "éœç‰©": ["é‡‘ç‰", "å¯¶ç ", "åœ“ç‰©", "å† ", "é¡"],
                    "åœ°ç†": ["è¥¿åŒ—æ–¹", "é«˜äº¢ä¹‹æ‰€", "å…¬å®¶æ©Ÿé—œ", "é«˜æ¨“", "éŠ€è¡Œ", "è¾¦å…¬å¤§æ¨“", "é«˜ç´šä½å®…å€"],
                    "é¡è‰²": ["å¤§èµ¤è‰²", "ç„è‰²", "ç™½"],
                    "å°‹ç‰©ç·šç´¢": "å¾Œå³æ–¹ï¼ˆè¥¿åŒ—ï¼‰ã€é«˜è™•ï¼ˆå¦‚é ‚æ¨“ã€é–£æ¨“ï¼‰ã€é‡‘å±¬æ—ã€åœ“å½¢ç‰©é«”ä¸­ã€ä¹¾ç‡¥ä¹‹åœ°ã€å…¬å®¶æ©Ÿé—œã€éŠ€è¡Œã€è¾¦å…¬å¤§æ¨“ã€åœè»Šå ´é«˜å±¤ã€‚",
                    "å°‹äººç·šç´¢": "å¾Œå³æ–¹ï¼ˆè¥¿åŒ—ï¼‰ã€å®˜è²´ã€é•·è€…ã€å‰›å¥ä¹‹äººã€é ­éƒ¨æœ‰ç‰¹å¾µã€‚"
                },
                "å¤": {
                    "äº”è¡Œ": "åœŸ", 
                    "æ–¹ä½": "è¥¿å— (å‰å³æ–¹)", 
                    "äººç‰©": ["åœ°", "æ¯", "è€å©¦", "è¾²å¤«", "çœ¾äºº", "å¤§è…¹äºº"],
                    "éœç‰©": ["æ–¹ç‰©", "æŸ”ç‰©", "å¸ƒå¸›", "çµ²ç¶¿", "ç“¦å™¨"],
                    "åœ°ç†": ["è¥¿å—æ–¹", "ç”°é‡", "å¹³åœ°", "å€‰åº«", "è¾²æ‘", "ä½å±¤å…¬å¯“", "è¶…å¸‚", "å»£å ´"],
                    "é¡è‰²": ["é»ƒ", "é»‘"],
                    "å°‹ç‰©ç·šç´¢": "å‰å³æ–¹ï¼ˆè¥¿å—ï¼‰ã€å¹³å¦è™•ï¼ˆå¦‚å»£å ´ã€æ“å ´ï¼‰ã€ç”°é‡ã€å€‰åº«ã€æ³¥åœŸæˆ–ç“¦å™¨ä¸­ã€æ–¹å½¢ç‰©é«”ã€ä½å±¤å…¬å¯“ã€è¶…å¸‚è²¨æ¶ã€‚",
                    "å°‹äººç·šç´¢": "å‰å³æ–¹ï¼ˆè¥¿å—ï¼‰ã€æ¯è¦ªã€è€å©¦ã€è¾²å¤«ã€èº«æçŸ®èƒ–è€…ã€æŸ”é †ä¹‹äººã€‚"
                },
                "éœ‡": {
                    "äº”è¡Œ": "æœ¨", 
                    "æ–¹ä½": "æ± (å·¦æ–¹)", 
                    "äººç‰©": ["é•·å­", "é’å¹´ç”·å­", "å¥½å‹•ä¹‹äºº"],
                    "éœç‰©": ["è¶³", "é ­é«®", "ç«¹å­", "è˜†è‘¦", "ç™¼éŸ³çš„ç‰©ä»¶"],
                    "åœ°ç†": ["æ±æ–¹", "é“è·¯", "å±±æ—", "å¸‚é›†", "å…¬åœ’", "å­¸æ ¡æ“å ´", "é‹å‹•å ´"],
                    "é¡è‰²": ["é’", "ç¶ "],
                    "å°‹ç‰©ç·šç´¢": "å·¦æ–¹ï¼ˆæ±ï¼‰ã€é“è·¯æ—ã€ç«¹æ—ä¸­ã€ç¶ è‰²æ¤ç‰©é™„è¿‘ã€ç™¼è²ç‰©ä»¶æ—ã€ç†±é¬§å¸‚é›†ã€å…¬åœ’ã€å­¸æ ¡æ“å ´ã€é‹å‹•å ´ã€‚",
                    "å°‹äººç·šç´¢": "å·¦æ–¹ï¼ˆæ±ï¼‰ã€é’å¹´ç”·å­ã€å¥½å‹•ä¹‹äººã€è¶³éƒ¨æœ‰ç‰¹å¾µã€‚"
                },
                "å·½": {
                    "äº”è¡Œ": "æœ¨", 
                    "æ–¹ä½": "æ±å— (å‰å·¦æ–¹)", 
                    "äººç‰©": ["é•·å¥³", "åƒ§é“ä¹‹äºº", "æ–‡äºº"],
                    "éœç‰©": ["ç¹©å­", "çœ¼ç›", "é¢¨æ‰‡", "å¸†"],
                    "åœ°ç†": ["æ±å—æ–¹", "è‰æœ¨ç¹èŒ‚è™•", "é«˜å´—", "å¯ºå»Ÿ", "èœåœ’", "èŠ±åœ’", "åœ–æ›¸é¤¨", "å’–å•¡å»³"],
                    "é¡è‰²": ["é’", "ç¶ "],
                    "å°‹ç‰©ç·šç´¢": "å‰å·¦æ–¹ï¼ˆæ±å—ï¼‰ã€ç¹©ç´¢æ—ã€é¦™å‘³è™•ã€ç›´å½¢ç‰©é«”ä¸­ã€é¢¨å‹•ä¹‹åœ°ã€å¯ºå»Ÿã€èœåœ’ã€èŠ±åœ’ã€åœ–æ›¸é¤¨ã€å’–å•¡å»³ã€‚",
                    "å°‹äººç·šç´¢": "å‰å·¦æ–¹ï¼ˆæ±å—ï¼‰ã€é•·å¥³ã€æ–‡äººã€ä¿®è¡Œè€…ã€çœ¼ç›æœ‰ç‰¹å¾µã€‚"
                },
                "å": {
                    "äº”è¡Œ": "æ°´", 
                    "æ–¹ä½": "åŒ— (å¾Œæ–¹)", 
                    "äººç‰©": ["ä¸­å¹´ç”·å­", "å·ç›œä¹‹äºº", "å‹å¿ƒè€…"],
                    "éœç‰©": ["å†°å‡ç‰©ä»¶", "è¼ªèˆ¹", "è€³æœµ", "è¡€", "æœˆäº®"],
                    "åœ°ç†": ["åŒ—æ–¹", "æ²³æµ", "å±éšªä¹‹åœ°", "æºæ¸ ", "éš±è—è™•", "äº•é‚Š", "åœ°ä¸‹åœè»Šå ´", "æ°´è™•ç†å» "],
                    "é¡è‰²": ["é»‘", "è—"],
                    "å°‹ç‰©ç·šç´¢": "å¾Œæ–¹ï¼ˆåŒ—ï¼‰ã€æ°´é‚Šï¼ˆå¦‚æ²³æµã€æ¹–æ³Šï¼‰ã€é»‘è‰²ç‰©ä»¶ä¸­ã€éš±è—è™•ï¼ˆå¦‚å„²è—å®¤ï¼‰ã€æ¶²é«”ç›¸é—œã€äº•é‚Šã€æ½®æ¿•åœ°ã€åœ°ä¸‹åœè»Šå ´ã€æ°´è™•ç†å» ã€‚",
                    "å°‹äººç·šç´¢": "å¾Œæ–¹ï¼ˆåŒ—ï¼‰ã€ä¸­å¹´ç”·å­ã€ç›œè³Šã€é™°éšªä¹‹äººã€è€³éƒ¨æœ‰ç‰¹å¾µã€‚"
                },
                "é›¢": {
                    "äº”è¡Œ": "ç«", 
                    "æ–¹ä½": "å— (å‰æ–¹)", 
                    "äººç‰©": ["ä¸­å¥³", "æ–‡äºº", "ç¾æ¥­ç›¸é—œäººå“¡", "è»äºº"],
                    "éœç‰©": ["çœ¼ç›", "æ–‡æ›¸", "çˆç¶", "ä¹¾ç‡¥ç‰©", "æœè£"],
                    "åœ°ç†": ["å—æ–¹", "çˆç¶", "ä¹¾ç‡¥åœ°", "æ˜äº®çª—æˆ¶", "ç©ºç½®ä¹‹åœ°", "å»šæˆ¿", "å•†å ´", "é›»å½±é™¢"],
                    "é¡è‰²": ["ç´…", "ç´«"],
                    "å°‹ç‰©ç·šç´¢": "å‰æ–¹ï¼ˆå—ï¼‰ã€ç«æ—ï¼ˆå¦‚å»šæˆ¿ã€æš–çˆï¼‰ã€ç´…è‰²ç‰©ä»¶ä¸­ã€ä¹¾ç‡¥è™•ã€æ–‡æ›¸é™„è¿‘ã€æ˜äº®è™•ã€å•†å ´ã€é›»å½±é™¢ã€‚",
                    "å°‹äººç·šç´¢": "å‰æ–¹ï¼ˆå—ï¼‰ã€æ–‡äººã€ç¾å¥³ã€è»äººã€çœ¼ç›æœ‰ç‰¹å¾µã€‚"
                },
                "è‰®": {
                    "äº”è¡Œ": "åœŸ", 
                    "æ–¹ä½": "æ±åŒ— (å¾Œå·¦æ–¹)", 
                    "äººç‰©": ["å°‘ç”·", "é–’äºº", "ç«¥å­"],
                    "éœç‰©": ["æ‰‹æŒ‡", "é–€é–¥", "æœè”¬", "å¾‘çŸ³"],
                    "åœ°ç†": ["æ±åŒ—æ–¹", "å¯ºå»Ÿ", "å±±å³°", "å¾‘è·¯", "åœŸç©´", "å±±å¡", "å»ºç¯‰å·¥åœ°", "åœ°éµç«™"],
                    "é¡è‰²": ["é»ƒ"],
                    "å°‹ç‰©ç·šç´¢": "å¾Œå·¦æ–¹ï¼ˆæ±åŒ—ï¼‰ã€å±±è…³ã€çŸ³é ­æ—ã€é–€å£ã€æœè”¬é™„è¿‘ã€åœŸç©´ä¸­ã€å±±å¡ã€å»ºç¯‰å·¥åœ°ã€åœ°éµç«™ã€‚",
                    "å°‹äººç·šç´¢": "å¾Œå·¦æ–¹ï¼ˆæ±åŒ—ï¼‰ã€å°‘å¹´ã€é–’äººã€æ‰‹éƒ¨æœ‰ç‰¹å¾µã€‚"
                },
                "å…Œ": {
                    "äº”è¡Œ": "é‡‘", 
                    "æ–¹ä½": "è¥¿ (å³æ–¹)", 
                    "äººç‰©": ["å°‘å¥³", "å·«å¸«", "æ­Œä¼", "èˆŒè¾¯ä¹‹äºº"],
                    "éœç‰©": ["å£èˆŒ", "é£Ÿç‰©", "åˆ€åŠ", "æ¯€æŠ˜ç‰©"],
                    "åœ°ç†": ["è¥¿æ–¹", "æ²¼æ¾¤", "å»¢äº•", "ç¼ºå£ä¹‹åœ°", "ç ´ææ± å¡˜", "åƒåœ¾å ´", "é¤å»³", "å»¢æ£„å»ºç¯‰"],
                    "é¡è‰²": ["ç™½"],
                    "å°‹ç‰©ç·šç´¢": "å³æ–¹ï¼ˆè¥¿ï¼‰ã€æ¾¤é‚Šã€ç¼ºå£è™•ã€é£Ÿç‰©æ—ã€ç™½è‰²ç‰©ä»¶ä¸­ã€å»¢äº•ã€ç ´æè™•ã€åƒåœ¾å ´ã€é¤å»³ã€å»¢æ£„å»ºç¯‰ã€‚",
                    "å°‹äººç·šç´¢": "å³æ–¹ï¼ˆè¥¿ï¼‰ã€å°‘å¥³ã€æ­Œæ‰‹ã€å£æ‰å¥½ä¹‹äººã€å£éƒ¨æœ‰ç‰¹å¾µã€‚"
                }
            },
            seasonal_strength: {
                "æ˜¥": {"æ—º": ["éœ‡", "å·½"], "è¡°": ["å¤", "è‰®"]},
                "å¤": {"æ—º": ["é›¢"], "è¡°": ["ä¹¾", "å…Œ"]},
                "ç§‹": {"æ—º": ["ä¹¾", "å…Œ"], "è¡°": ["éœ‡", "å·½"]},
                "å†¬": {"æ—º": ["å"], "è¡°": ["é›¢"]},
                "å­£æœˆ": {"æ—º": ["å¤", "è‰®"], "è¡°": ["å"]}
            },
            directions: {
                "ä¹¾": "è¥¿åŒ— (å¾Œå³æ–¹)", "å¤": "è¥¿å— (å‰å³æ–¹)", "éœ‡": "æ± (å·¦æ–¹)", "å·½": "æ±å— (å‰å·¦æ–¹)",
                "å": "åŒ— (å¾Œæ–¹)", "é›¢": "å— (å‰æ–¹)", "è‰®": "æ±åŒ— (å¾Œå·¦æ–¹)", "å…Œ": "è¥¿ (å³æ–¹)"
            },
            gua_texts: {
                "1": { "name": "ä¹¾ç‚ºå¤©", "gua_ci": "å…ƒäº¨åˆ©è²ã€‚" },
                "2": { "name": "å¤ç‚ºåœ°", "gua_ci": "ç›´æ–¹å¤§ï¼Œä¸ç¿’ç„¡ä¸åˆ©ã€‚" },
                "3": { "name": "æ°´é›·å±¯", "gua_ci": "å…ƒäº¨åˆ©è²ï¼Œå‹¿ç”¨æœ‰æ”¸å¾€ï¼Œåˆ©å»ºä¾¯ã€‚" },
                "4": { "name": "å±±æ°´è’™", "gua_ci": "äº¨ã€‚åŒªæˆ‘æ±‚ç«¥è’™ï¼Œç«¥è’™æ±‚æˆ‘ã€‚" },
                "5": { "name": "æ°´å¤©éœ€", "gua_ci": "æœ‰å­šï¼Œå…‰äº¨ï¼Œè²å‰ï¼Œåˆ©æ¶‰å¤§å·ã€‚" },
                "6": { "name": "å¤©æ°´è¨Ÿ", "gua_ci": "æœ‰å­šçª’ï¼Œæ…ä¸­ï¼Œåˆ©æ¶‰å¤§å·ã€‚" },
                "7": { "name": "åœ°æ°´å¸«", "gua_ci": "è²ä¸ˆäººå‰ï¼Œç„¡å’ã€‚" },
                "8": { "name": "æ°´åœ°æ¯”", "gua_ci": "å‰ã€‚åŸç­®ï¼Œå…ƒæ°¸è²ï¼Œç„¡å’ã€‚" },
                "9": { "name": "é¢¨å¤©å°ç•œ", "gua_ci": "äº¨ã€‚å¯†é›²ä¸é›¨ï¼Œè‡ªæˆ‘è¥¿éƒŠã€‚" },
                "10": { "name": "å¤©æ¾¤å±¥", "gua_ci": "å±¥è™å°¾ï¼Œä¸å’¥äººï¼Œäº¨ã€‚" },
                "11": { "name": "åœ°å¤©æ³°", "gua_ci": "å°å¾€å¤§ä¾†ï¼Œå‰äº¨ã€‚" },
                "12": { "name": "å¤©åœ°å¦", "gua_ci": "å¦ä¹‹åŒªäººï¼Œä¸åˆ©å›å­è²ã€‚" },
                "13": { "name": "å¤©ç«åŒäºº", "gua_ci": "åŒäººäºé‡ï¼Œäº¨ï¼Œåˆ©æ¶‰å¤§å·ã€‚" },
                "14": { "name": "ç«å¤©å¤§æœ‰", "gua_ci": "å…ƒäº¨ã€‚" },
                "15": { "name": "åœ°å±±è¬™", "gua_ci": "äº¨ï¼Œå›å­æœ‰çµ‚ã€‚" },
                "16": { "name": "é›·åœ°è±«", "gua_ci": "åˆ©å»ºä¾¯è¡Œå¸«ã€‚" },
                "17": { "name": "æ¾¤é›·éš¨", "gua_ci": "å…ƒäº¨åˆ©è²ï¼Œç„¡å’ã€‚" },
                "18": { "name": "å±±é¢¨è ±", "gua_ci": "å…ƒäº¨ï¼Œåˆ©æ¶‰å¤§å·ã€‚" },
                "19": { "name": "åœ°æ¾¤è‡¨", "gua_ci": "å…ƒäº¨ï¼Œåˆ©è²ã€‚" },
                "20": { "name": "é¢¨åœ°è§€", "gua_ci": "ç›¥è€Œä¸è–¦ï¼Œæœ‰å­šé¡’è‹¥ã€‚" },
                "21": { "name": "ç«é›·å™¬å—‘", "gua_ci": "äº¨ï¼Œåˆ©ç”¨ç„ã€‚" },
                "22": { "name": "å±±ç«è³", "gua_ci": "äº¨ï¼Œå°åˆ©æœ‰æ”¸å¾€ã€‚" },
                "23": { "name": "å±±åœ°å‰", "gua_ci": "ä¸åˆ©æœ‰æ”¸å¾€ã€‚" },
                "24": { "name": "åœ°é›·å¾©", "gua_ci": "äº¨ï¼Œå‡ºå…¥ç„¡ç–¾ï¼Œæœ‹ä¾†ç„¡å’ã€‚" },
                "25": { "name": "å¤©é›·ç„¡å¦„", "gua_ci": "å…ƒäº¨åˆ©è²ï¼Œå…¶åŒªæ­£æœ‰çœšã€‚" },
                "26": { "name": "å±±å¤©å¤§ç•œ", "gua_ci": "åˆ©è²ï¼Œä¸å®¶é£Ÿå‰ï¼Œåˆ©æ¶‰å¤§å·ã€‚" },
                "27": { "name": "å±±é›·é ¤", "gua_ci": "è²å‰ï¼Œè§€é ¤ï¼Œè‡ªæ±‚å£å¯¦ã€‚" },
                "28": { "name": "æ¾¤é¢¨å¤§é", "gua_ci": "æ£Ÿæ©ˆï¼Œåˆ©æœ‰æ”¸å¾€ï¼Œäº¨ã€‚" },
                "29": { "name": "åç‚ºæ°´", "gua_ci": "ç¿’åï¼Œæœ‰å­šï¼Œç¶­å¿ƒäº¨ï¼Œè¡Œæœ‰å°šã€‚" },
                "30": { "name": "é›¢ç‚ºç«", "gua_ci": "åˆ©è²ï¼Œäº¨ï¼Œç•œç‰ç‰›å‰ã€‚" },
                "31": { "name": "æ¾¤å±±å’¸", "gua_ci": "äº¨ï¼Œåˆ©è²ï¼Œå–å¥³å‰ã€‚" },
                "32": { "name": "é›·é¢¨æ†", "gua_ci": "äº¨ï¼Œç„¡å’ï¼Œåˆ©è²ï¼Œåˆ©æœ‰æ”¸å¾€ã€‚" },
                "33": { "name": "å¤©å±±é", "gua_ci": "äº¨ï¼Œå°åˆ©è²ã€‚" },
                "34": { "name": "é›·å¤©å¤§å£¯", "gua_ci": "åˆ©è²ã€‚" },
                "35": { "name": "ç«åœ°æ™‰", "gua_ci": "åº·ä¾¯ç”¨éŒ«é¦¬è•ƒåº¶ï¼Œæ™æ—¥ä¸‰æ¥ã€‚" },
                "36": { "name": "åœ°ç«æ˜å¤·", "gua_ci": "åˆ©è‰±è²ã€‚" },
                "37": { "name": "é¢¨ç«å®¶äºº", "gua_ci": "åˆ©å¥³è²ã€‚" },
                "38": { "name": "ç«æ¾¤ç½", "gua_ci": "å°äº‹å‰ã€‚" },
                "39": { "name": "æ°´å±±è¹‡", "gua_ci": "åˆ©è¥¿å—ï¼Œä¸åˆ©æ±åŒ—ï¼Œåˆ©è¦‹å¤§äººï¼Œè²å‰ã€‚" },
                "40": { "name": "é›·æ°´è§£", "gua_ci": "åˆ©è¥¿å—ï¼Œç„¡æ‰€å¾€ï¼Œå…¶ä¾†å¾©å‰ã€‚" },
                "41": { "name": "å±±æ¾¤æ", "gua_ci": "æœ‰å­šï¼Œå…ƒå‰ï¼Œç„¡å’ï¼Œå¯è²ã€‚" },
                "42": { "name": "é¢¨é›·ç›Š", "gua_ci": "åˆ©æœ‰æ”¸å¾€ï¼Œåˆ©æ¶‰å¤§å·ã€‚" },
                "43": { "name": "æ¾¤å¤©å¤¬", "gua_ci": "æšäºç‹åº­ï¼Œå­šè™Ÿï¼Œæœ‰å²ã€‚" },
                "44": { "name": "å¤©é¢¨å§¤", "gua_ci": "å¥³å£¯ï¼Œå‹¿ç”¨å–å¥³ã€‚" },
                "45": { "name": "æ¾¤åœ°èƒ", "gua_ci": "äº¨ï¼Œç‹å‡æœ‰å»Ÿï¼Œåˆ©è¦‹å¤§äººã€‚" },
                "46": { "name": "åœ°é¢¨å‡", "gua_ci": "å…ƒäº¨ï¼Œç”¨è¦‹å¤§äººï¼Œå‹¿æ¤ï¼Œå—å¾å‰ã€‚" },
                "47": { "name": "æ¾¤æ°´å›°", "gua_ci": "äº¨ï¼Œè²å¤§äººå‰ï¼Œç„¡å’ã€‚" },
                "48": { "name": "æ°´é¢¨äº•", "gua_ci": "æ”¹é‚‘ä¸æ”¹äº•ï¼Œç„¡å–ªç„¡å¾—ã€‚" },
                "49": { "name": "æ¾¤ç«é©", "gua_ci": "å·²æ—¥ä¹ƒå­šï¼Œå…ƒäº¨åˆ©è²ï¼Œæ‚”äº¡ã€‚" },
                "50": { "name": "ç«é¢¨é¼", "gua_ci": "å…ƒå‰ï¼Œäº¨ã€‚" },
                "51": { "name": "éœ‡ç‚ºé›·", "gua_ci": "äº¨ï¼Œéœ‡ä¾†è™©è™©ï¼Œç¬‘è¨€å•å•ã€‚" },
                "52": { "name": "è‰®ç‚ºå±±", "gua_ci": "è‰®å…¶èƒŒï¼Œä¸ç²å…¶èº«ã€‚" },
                "53": { "name": "é¢¨å±±æ¼¸", "gua_ci": "å¥³æ­¸å‰ï¼Œåˆ©è²ã€‚" },
                "54": { "name": "é›·æ¾¤æ­¸å¦¹", "gua_ci": "å¾å‡¶ï¼Œç„¡æ”¸åˆ©ã€‚" },
                "55": { "name": "é›·ç«è±", "gua_ci": "äº¨ï¼Œç‹å‡ä¹‹ï¼Œå‹¿æ†‚ï¼Œå®œæ—¥ä¸­ã€‚" },
                "56": { "name": "ç«å±±æ—…", "gua_ci": "å°äº¨ï¼Œæ—…è²å‰ã€‚" },
                "57": { "name": "å·½ç‚ºé¢¨", "gua_ci": "å°äº¨ï¼Œåˆ©æœ‰æ”¸å¾€ï¼Œåˆ©è¦‹å¤§äººã€‚" },
                "58": { "name": "å…Œç‚ºæ¾¤", "gua_ci": "äº¨ï¼Œåˆ©è²ã€‚" },
                "59": { "name": "é¢¨æ°´æ¸™", "gua_ci": "äº¨ï¼Œç‹å‡æœ‰å»Ÿï¼Œåˆ©æ¶‰å¤§å·ã€‚" },
                "60": { "name": "æ°´æ¾¤ç¯€", "gua_ci": "äº¨ï¼Œè‹¦ç¯€ä¸å¯è²ã€‚" },
                "61": { "name": "é¢¨æ¾¤ä¸­å­š", "gua_ci": "è±šé­šå‰ï¼Œåˆ©æ¶‰å¤§å·ï¼Œåˆ©è²ã€‚" },
                "62": { "name": "é›·å±±å°é", "gua_ci": "äº¨ï¼Œåˆ©è²ï¼Œå¯å°äº‹ï¼Œä¸å¯å¤§äº‹ã€‚" },
                "63": { "name": "æ°´ç«æ—¢æ¿Ÿ", "gua_ci": "äº¨å°ï¼Œåˆ©è²ï¼Œåˆå‰çµ‚äº‚ã€‚" },
                "64": { "name": "ç«æ°´æœªæ¿Ÿ", "gua_ci": "äº¨ï¼Œå°ç‹æ±”æ¿Ÿï¼Œæ¿¡å…¶å°¾ï¼Œç„¡æ”¸åˆ©ã€‚" }
            },
            case_studies: [
                { "title": "è§€æ¢…å ", "description": "è¾°å¹´åäºŒæœˆåä¸ƒæ—¥ç”³æ™‚ï¼Œåº·ç¯€å…ˆç”Ÿå¶è§€æ¢…ï¼Œè¦‹äºŒé›€çˆ­æå¢œåœ°ï¼Œæ€ªè€Œå ä¹‹ã€‚" }
            ]
        };

        let data = inlineData;

        // A. è³‡æ–™è¼‰å…¥æ¨¡çµ„
        async function loadData() {
            console.log('ä½¿ç”¨å…§åµŒè³‡æ–™');
        }

        // B. è¾²æ›†è½‰æ›æ¨¡çµ„
        function getLunarDate(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hour = date.getHours();
            
            // 2025å¹´ç‚ºå·³å¹´ï¼ˆå¹´æ”¯6ï¼‰ï¼Œæ™‚é–“17:38ç‚ºé…‰æ™‚ï¼ˆæ™‚æ”¯10ï¼‰
            const lunarYear = 6; // å·³å¹´
            const lunarMonth = month;
            const lunarDay = day > 30 ? 30 : day;
            const lunarHour = Math.floor((hour + 1) / 2) + 1; // é…‰æ™‚ (17:00-19:00)
            
            return {
                year: lunarYear,
                month: lunarMonth,
                day: lunarDay,
                hour: lunarHour
            };
        }

        // C. èµ·å¦å¼•æ“
        function generateHexagram(method) {
            let upper, lower, moving;
            if (method === 'time') {
                let year = parseInt(document.getElementById('lunar-year').value);
                let month = parseInt(document.getElementById('lunar-month').value);
                let day = parseInt(document.getElementById('lunar-day').value);
                let hour = parseInt(document.getElementById('lunar-hour').value);
                const sum1 = year + month + day;
                upper = sum1 % 8 || 8;
                const sum2 = sum1 + hour;
                lower = sum2 % 8 || 8;
                moving = sum2 % 6 || 6;
            } else if (method === 'number') {
                let num1 = parseInt(document.getElementById('num1').value);
                let num2 = parseInt(document.getElementById('num2').value);
                let num3 = parseInt(document.getElementById('num3').value);
                upper = num1 % 8 || 8;
                lower = num2 % 8 || 8;
                moving = num3 % 6 || 6;
            } else if (method === 'manual') {
                upper = parseInt(document.getElementById('upper-trigram').value);
                lower = parseInt(document.getElementById('lower-trigram').value);
                moving = parseInt(document.getElementById('moving-line').value);
            }
            return { upper, lower, moving };
        }

        // D. å¦è±¡è§£æèˆ‡è½‰æ›æ¨¡çµ„
        function parseHexagram(upper, lower, moving) {
            const upperBinary = data.trigrams[upper].binary;
            const lowerBinary = data.trigrams[lower].binary;
            const hexBinary = lowerBinary.concat(upperBinary);

            // äº’å¦è¨ˆç®—ï¼šç¬¬2ã€3ã€4çˆ»ç‚ºäº’å¦ä¸‹å¦ï¼Œç¬¬3ã€4ã€5çˆ»ç‚ºäº’å¦ä¸Šå¦
            const mutualLowerBinary = [hexBinary[1], hexBinary[2], hexBinary[3]]; // çˆ»2,3,4 -> äº’ä¸‹å¦
            const mutualUpperBinary = [hexBinary[2], hexBinary[3], hexBinary[4]]; // çˆ»3,4,5 -> äº’ä¸Šå¦
            const mutualLower = binaryToTrigram(mutualLowerBinary);
            const mutualUpper = binaryToTrigram(mutualUpperBinary);
            const mutual = { upper: mutualUpper, lower: mutualLower };

            const changedBinary = [...hexBinary];
            changedBinary[moving - 1] = 1 - changedBinary[moving - 1];
            const changedLowerBinary = changedBinary.slice(0,3);
            const changedUpperBinary = changedBinary.slice(3,6);
            const changedLower = binaryToTrigram(changedLowerBinary);
            const changedUpper = binaryToTrigram(changedUpperBinary);
            const changed = { upper: changedUpper, lower: changedLower };

            const hexagramMap = {
                // ä¹¾ (1)
                "1-1": 1,  // ä¹¾ç‚ºå¤©
                "1-2": 10, // å¤©æ¾¤å±¥
                "1-3": 13, // å¤©ç«åŒäºº
                "1-4": 25, // å¤©é›·ç„¡å¦„
                "1-5": 44, // å¤©é¢¨å§¤
                "1-6": 6,  // å¤©æ°´è¨Ÿ
                "1-7": 33, // å¤©å±±é
                "1-8": 12, // å¤©åœ°å¦
                // å…Œ (2)
                "2-1": 43, // æ¾¤å¤©å¤¬
                "2-2": 58, // å…Œç‚ºæ¾¤
                "2-3": 49, // æ¾¤ç«é©
                "2-4": 17, // æ¾¤é›·éš¨
                "2-5": 28, // æ¾¤é¢¨å¤§é
                "2-6": 60, // æ¾¤æ°´å›°
                "2-7": 31, // æ¾¤å±±å’¸
                "2-8": 19, // æ¾¤åœ°è‡¨
                // é›¢ (3)
                "3-1": 14, // ç«å¤©å¤§æœ‰
                "3-2": 38, // ç«æ¾¤ç½
                "3-3": 30, // é›¢ç‚ºç«
                "3-4": 21, // ç«é›·å™¬å—‘
                "3-5": 37, // é¢¨ç«å®¶äºº
                "3-6": 64, // ç«æ°´æœªæ¿Ÿ
                "3-7": 56, // ç«å±±æ—…
                "3-8": 36, // åœ°ç«æ˜å¤·
                // éœ‡ (4)
                "4-1": 34, // é›·å¤©å¤§å£¯
                "4-2": 54, // é›·æ¾¤æ­¸å¦¹
                "4-3": 55, // é›·ç«è±
                "4-4": 51, // éœ‡ç‚ºé›·
                "4-5": 42, // é›·é¢¨ç›Š
                "4-6": 40, // é›·æ°´è§£
                "4-7": 27, // é›·å±±å°é
                "4-8": 24, // é›·åœ°å¾©
                // å·½ (5)
                "5-1": 9,  // é¢¨å¤©å°ç•œ
                "5-2": 61, // é¢¨æ¾¤ä¸­å­š
                "5-3": 50, // ç«é¢¨é¼
                "5-4": 32, // é›·é¢¨æ†
                "5-5": 57, // å·½ç‚ºé¢¨
                "5-6": 48, // é¢¨æ°´äº•
                "5-7": 53, // é¢¨å±±æ¼¸
                "5-8": 20, // é¢¨åœ°è§€
                // å (6)
                "6-1": 5,  // æ°´å¤©éœ€
                "6-2": 47, // æ°´æ¾¤å›°
                "6-3": 63, // æ°´ç«æ—¢æ¿Ÿ
                "6-4": 3,  // æ°´é›·å±¯
                "6-5": 59, // é¢¨æ°´æ¸™
                "6-6": 29, // åç‚ºæ°´
                "6-7": 39, // æ°´å±±è¹‡
                "6-8": 8,  // æ°´åœ°æ¯”
                // è‰® (7)
                "7-1": 26, // å±±å¤©å¤§ç•œ
                "7-2": 31, // å±±æ¾¤å’¸
                "7-3": 22, // å±±ç«è³
                "7-4": 62, // é›·å±±å°é
                "7-5": 18, // å±±é¢¨è ±
                "7-6": 4,  // å±±æ°´è’™
                "7-7": 52, // è‰®ç‚ºå±±
                "7-8": 23, // å±±åœ°å‰
                // å¤ (8)
                "8-1": 11, // åœ°å¤©æ³°
                "8-2": 45, // åœ°æ¾¤èƒ
                "8-3": 35, // åœ°ç«æ˜å¤·
                "8-4": 16, // åœ°é›·è±«
                "8-5": 46, // åœ°é¢¨å‡
                "8-6": 7,  // åœ°æ°´å¸«
                "8-7": 15, // åœ°å±±è¬™
                "8-8": 2   // å¤ç‚ºåœ°
            };

            const baseIndex = hexagramMap[`${upper}-${lower}`] || 1;
            const mutualIndex = hexagramMap[`${mutualUpper}-${mutualLower}`] || 1;
            const changedIndex = hexagramMap[`${changedUpper}-${changedLower}`] || 1;

            const baseName = data.gua_texts[baseIndex]?.name || `${data.trigrams[upper].name}ç‚º${data.trigrams[lower].name}`;
            const mutualName = data.gua_texts[mutualIndex]?.name || `${data.trigrams[mutualUpper].name}ç‚º${data.trigrams[mutualLower].name}`;
            const changedName = data.gua_texts[changedIndex]?.name || `${data.trigrams[changedUpper].name}ç‚º${data.trigrams[changedLower].name}`;

            return { 
                base: {upper, lower, name: baseName, binary: hexBinary, index: baseIndex}, 
                mutual: {upper: mutualUpper, lower: mutualLower, name: mutualName, index: mutualIndex}, 
                changed: {upper: changedUpper, lower: changedLower, name: changedName, index: changedIndex}, 
                moving 
            };
        }

        function binaryToTrigram(bin) {
            for (let i = 1; i <= 8; i++) {
                if (arraysEqual(data.trigrams[i].binary, bin)) return i;
            }
            return 1;
        }
        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, index) => val === b[index]);
        }

        // E. æ¢…èŠ±æ˜“æ•¸è§£å¦å¼•æ“
        function interpretHexagram(hexagram, targetType, targetDetails, external, caseName) {
            const { base, mutual, changed, moving } = hexagram;
            // ä¿®æ­£é«”å¦ï¼šå‹•çˆ»æ‰€åœ¨å¦ç‚ºé«”å¦
            const bodyTrigram = moving <= 3 ? base.lower : base.upper; // 1-3çˆ»å‹•ç‚ºä¸‹å¦ï¼Œ4-6çˆ»å‹•ç‚ºä¸Šå¦
            const useTrigram = moving <= 3 ? base.upper : base.lower;  // ç”¨å¦ç‚ºå¦ä¸€å¦

            // 1. é«”ç”¨é—œä¿‚ï¼šåˆ¤æ–·èƒ½å¦æ‰¾å›
            const bodyElement = data.trigrams[bodyTrigram].five_element;
            const useElement = data.trigrams[useTrigram].five_element;
            let relation = '';
            let findLikelihood = '';
            if (bodyElement === useElement) {
                relation = 'æ¯”å’Œ (å‰)';
                findLikelihood = 'ç‰©å“æˆ–äººç‰©æœªçœŸæ­£ä¸Ÿå¤±ï¼Œåƒ…æ”¾éŒ¯åœ°æ–¹æˆ–åœ¨ç†Ÿæ‚‰ç’°å¢ƒä¸­ï¼Œæ¥µæ˜“æ‰¾å›ã€‚';
            } else if (data.five_elements_relations.ç›¸ç”Ÿ[useElement] === bodyElement) {
                relation = 'ç”¨ç”Ÿé«” (å‰)';
                findLikelihood = 'ç‰©å“æˆ–äººç‰©æ¥µæ˜“æ‰¾å›ï¼Œä¸”å¯èƒ½æœ‰å¤–åŠ›å”åŠ©ã€‚';
            } else if (data.five_elements_relations.ç›¸ç”Ÿ[bodyElement] === useElement) {
                relation = 'é«”ç”Ÿç”¨ (å‡¶)';
                findLikelihood = 'ç‰©å“æˆ–äººç‰©é›£ä»¥å°‹å›ï¼Œå°‹æ‰¾éç¨‹è€—è²»ç²¾åŠ›ï¼ŒæˆåŠŸç‡ä½ã€‚';
            } else if (data.five_elements_relations.ç›¸å‰‹[useElement] === bodyElement) {
                relation = 'ç”¨å‰‹é«” (å‡¶)';
                findLikelihood = 'ç‰©å“æˆ–äººç‰©æ¥µé›£å°‹å›ï¼Œå³ä½¿æ‰¾åˆ°ä¹Ÿå¯èƒ½æå£æˆ–ç„¡ç”¨ã€‚';
            } else if (data.five_elements_relations.ç›¸å‰‹[bodyElement] === useElement) {
                relation = 'é«”å‰‹ç”¨ (ä¸­)';
                findLikelihood = 'ç‰©å“æˆ–äººç‰©å¯æ‰¾å›ï¼Œä½†éœ€æ™‚æ—¥æˆ–ç¶“æ­·å‘¨æŠ˜ã€‚';
            }

            // 2. å¦æ°£æ—ºè¡°
            const currentDate = new Date('2025-09-06T17:38:00');
            const season = getSeason(currentDate); // ç§‹å­£
            const strength = data.seasonal_strength[season] || {};
            const bodyStrength = strength.æ—º.includes(data.trigrams[bodyTrigram].name) ? 'æ—º' : 
                                (strength.è¡°.includes(data.trigrams[bodyTrigram].name) ? 'è¡°' : 'ä¸­');
            const useStrength = strength.æ—º.includes(data.trigrams[useTrigram].name) ? 'æ—º' : 
                               (strength.è¡°.includes(data.trigrams[useTrigram].name) ? 'è¡°' : 'ä¸­');
            let strengthInfluence = `å¦æ°£å½±éŸ¿: é«”å¦${bodyStrength}ï¼Œç”¨å¦${useStrength}ã€‚`;
            if (relation === 'ç”¨å‰‹é«”' && useStrength === 'è¡°' && bodyStrength === 'æ—º') {
                strengthInfluence += ' å› ç”¨å¦è¡°å¼±è€Œé«”å¦æ—ºç››ï¼Œå°‹æ‰¾é›£åº¦ç•¥æ¸›ï¼Œä½†ä»éœ€åŠªåŠ›ã€‚';
            } else if (relation === 'ç”¨å‰‹é«”' && useStrength === 'æ—º') {
                strengthInfluence += ' å› ç”¨å¦æ—ºç››ï¼Œå°‹æ‰¾æ¥µç‚ºå›°é›£ã€‚';
            } else if (relation === 'é«”å‰‹ç”¨' && bodyStrength === 'æ—º') {
                strengthInfluence += ' é«”å¦æ—ºç››ï¼Œæœ‰åˆ©å°‹å›ï¼Œä½†ä»éœ€è€å¿ƒã€‚';
            } else {
                strengthInfluence += bodyStrength === 'æ—º' ? ' é«”å¦æ—ºç››ï¼Œæœ‰åˆ©å°‹æ‰¾ã€‚' : 
                                    (bodyStrength === 'è¡°' ? ' é«”å¦è¡°å¼±ï¼Œå°‹æ‰¾è¼ƒé›£ã€‚' : ' å¦æ°£ä¸­æ€§ï¼Œç„¡æ˜é¡¯å½±éŸ¿ã€‚');
            }

            // 3. æ–¹ä½èˆ‡åœ°é»ç·šç´¢ï¼ˆè®Šå¦ä¸»å°ï¼Œäº’å¦è¼”åŠ©ï¼‰
            const changedProps = data.trigram_properties[data.trigrams[changed.upper].name] || {};
            const mutualProps = data.trigram_properties[data.trigrams[mutual.upper].name] || {};
            const mainDirection = data.directions[data.trigrams[changed.upper].name] || 'æœªçŸ¥';
            const auxDirection = data.directions[data.trigrams[mutual.upper].name] || '';
            const mainLocation = changedProps.åœ°ç†.join('ã€');
            const auxLocation = mutualProps.åœ°ç†.join('ã€');

            // 4. å±¬æ€§åŒ¹é…èˆ‡ç·šç´¢ç”Ÿæˆ
            let clues = '';
            let attributeMatches = [];
            let attributeNote = '';
            if (targetType === 'lost-item' && targetDetails.attributesRelevant) {
                clues = changedProps.å°‹ç‰©ç·šç´¢ || 'ç„¡ç‰¹å®šç·šç´¢';
                // åŒ¹é…ç‰©å“å±¬æ€§
                if (targetDetails.color && changedProps.é¡è‰².includes(targetDetails.color)) {
                    attributeMatches.push(`é¡è‰²åŒ¹é…: ${targetDetails.color}`);
                }
                if (targetDetails.shape && changedProps.éœç‰©.some(s => s.includes(targetDetails.shape))) {
                    attributeMatches.push(`å½¢ç‹€åŒ¹é…: ${targetDetails.shape}`);
                }
                if (targetDetails.material && changedProps.éœç‰©.some(s => s.includes(targetDetails.material))) {
                    attributeMatches.push(`æè³ªåŒ¹é…: ${targetDetails.material}`);
                }
                if (targetDetails.category && targetDetails.category.some(cat => changedProps.éœç‰©.includes(cat))) {
                    attributeMatches.push(`é¡åˆ¥åŒ¹é…: ${targetDetails.category.join('ã€')}`);
                }
                // äº”è¡ŒåŒ¹é…
                const itemElement = getItemElement(targetDetails);
                if (itemElement && itemElement === changedProps.äº”è¡Œ) {
                    attributeMatches.push(`äº”è¡ŒåŒ¹é…: ${itemElement}`);
                }
                if (attributeMatches.length === 0 && targetDetails.category.length > 0) {
                    attributeNote = 'æ³¨æ„ï¼šæä¾›çš„ç‰©å“å±¬æ€§èˆ‡è®Šå¦ç‰¹å¾µç„¡æ˜é¡¯åŒ¹é…ï¼Œå¯èƒ½éœ€åƒè€ƒå¤–æ‡‰æˆ–é‡æ–°å¯©è¦–å±¬æ€§ã€‚';
                }
            } else if (targetType === 'lost-person' && targetDetails.attributesRelevant) {
                clues = changedProps.å°‹äººç·šç´¢ || 'ç„¡ç‰¹å®šç·šç´¢';
                // åŒ¹é…äººç‰©å±¬æ€§
                if (targetDetails.age && changedProps.äººç‰©.some(p => p.includes(targetDetails.age))) {
                    attributeMatches.push(`å¹´é½¡åŒ¹é…: ${targetDetails.age}`);
                }
                if (targetDetails.appearance && changedProps.äººç‰©.some(p => p.includes(targetDetails.appearance))) {
                    attributeMatches.push(`å¤–è²ŒåŒ¹é…: ${targetDetails.appearance}`);
                }
                if (targetDetails.behavior && changedProps.äººç‰©.some(p => p.includes(targetDetails.behavior))) {
                    attributeMatches.push(`è¡Œç‚ºåŒ¹é…: ${targetDetails.behavior}`);
                }
                if (targetDetails.occupation && changedProps.äººç‰©.includes(targetDetails.occupation)) {
                    attributeMatches.push(`è·æ¥­åŒ¹é…: ${targetDetails.occupation}`);
                }
                if (attributeMatches.length === 0 && (targetDetails.age || targetDetails.appearance || targetDetails.behavior || targetDetails.occupation)) {
                    attributeNote = 'æ³¨æ„ï¼šæä¾›çš„äººç‰©å±¬æ€§èˆ‡è®Šå¦ç‰¹å¾µç„¡æ˜é¡¯åŒ¹é…ï¼Œå¯èƒ½éœ€åƒè€ƒå¤–æ‡‰æˆ–é‡æ–°å¯©è¦–å±¬æ€§ã€‚';
                }
            } else {
                clues = targetType === 'lost-person' ? changedProps.å°‹äººç·šç´¢ : changedProps.å°‹ç‰©ç·šç´¢ || 'ç„¡ç‰¹å®šç·šç´¢';
                attributeNote = 'æœªä½¿ç”¨è©³ç´°å±¬æ€§é€²è¡ŒåŒ¹é…ï¼Œç·šç´¢åŸºæ–¼å¦è±¡é€šç”¨ç‰¹å¾µã€‚';
            }
            clues += `<br>è¼”åŠ©ç·šç´¢ (äº’å¦): ${mutualProps.å°‹ç‰©ç·šç´¢ || mutualProps.å°‹äººç·šç´¢ || 'ç„¡'}`;
            if (attributeMatches.length > 0) {
                clues += `<br>å±¬æ€§åŒ¹é…: ${attributeMatches.join('ï¼›')}`;
            }
            if (attributeNote) {
                clues += `<br>${attributeNote}`;
            }

            // 5. äººç‰©ç‰¹å¾µï¼ˆåƒ…é™å°‹äººï¼‰
            let personClues = '';
            if (targetType === 'lost-person' && targetDetails.attributesRelevant) {
                personClues = changedProps.äººç‰©.join('ã€') + ' (å¹´é½¡/æ€§åˆ¥/è·æ¥­ç­‰åŒ¹é…ç”¨æˆ¶è¼¸å…¥)';
            }

            // 6. æ‡‰æœŸé æ¸¬
            let period = moving <= 3 ? 'è¿‘æœŸ (æ•¸æ—¥å…§)' : 'è¼ƒé  (æ•¸æœˆå¾Œ)';
            if (bodyStrength === 'æ—º') {
                period += ' (é«”å¦æ—ºç››ï¼Œå¯èƒ½åŠ å¿«å°‹å›)';
            } else if (bodyStrength === 'è¡°') {
                period += ' (é«”å¦è¡°å¼±ï¼Œå¯èƒ½å»¶é²å°‹å›)';
            }

            // 7. å¤–æ‡‰è§£è®€
            const externalInterp = external ? 
                `å¤–æ‡‰è§£è®€: ${external} å¯èƒ½æä¾›é¡å¤–ç·šç´¢ï¼Œè«‹æ³¨æ„å åœæ™‚çš„ç’°å¢ƒå¾µå…†ï¼ˆå¦‚è²éŸ³ã€é¡è‰²ã€äº‹ä»¶ï¼‰ä»¥é€²ä¸€æ­¥ç¢ºèªæ–¹å‘æˆ–åœ°é»ã€‚` : 
                'ç„¡å¤–æ‡‰ï¼Œè«‹ç•™æ„å åœå¾Œçš„ç’°å¢ƒå¾µå…†ä»¥è¼”åŠ©åˆ¤æ–·ã€‚';

            // 8. å¦è¾­åƒè€ƒ
            const guaCi = data.gua_texts[base.index]?.gua_ci || 'ç„¡å¦è¾­';

            // 9. å¦è±¡é¡¯ç¤ºï¼ˆä¸¦æ’ï¼Œæ¨™è¨»é«”å¦èˆ‡ç”¨å¦ï¼‰
            const hexagramDisplay = `
                <div class="hexagram-row">
                    <div class="hexagram-column">
                        <p>æœ¬å¦</p>
                        <div class="hexagram ${moving <= 3 ? 'hexagram-use' : 'hexagram-body'}">${data.trigrams[base.upper].symbol}</div>
                        <div class="hexagram ${moving <= 3 ? 'hexagram-body' : 'hexagram-use'}">${data.trigrams[base.lower].symbol}</div>
                        <p class="hexagram-label">${base.name} (${data.trigrams[base.upper].five_element})</p>
                    </div>
                    <div class="hexagram-column">
                        <p>äº’å¦</p>
                        <div class="hexagram">${data.trigrams[mutual.upper].symbol}</div>
                        <div class="hexagram">${data.trigrams[mutual.lower].symbol}</div>
                        <p class="hexagram-label">${mutual.name} (${data.trigrams[mutual.upper].five_element})</p>
                    </div>
                    <div class="hexagram-column">
                        <p>è®Šå¦</p>
                        <div class="hexagram">${data.trigrams[changed.upper].symbol}</div>
                        <div class="hexagram">${data.trigrams[changed.lower].symbol}</div>
                        <p class="hexagram-label">${changed.name} (${data.trigrams[changed.upper].five_element})</p>
                    </div>
                </div>
                <p>å‹•çˆ»: ç¬¬${moving}çˆ»</p>
            `;

            // 10. ç¶œåˆçµæœ
            let result = `
                <h3>æ¡ˆä»¶åç¨±: ${caseName || 'æœªå‘½åæ¡ˆä»¶'}</h3>
                <h3>å¦è±¡é¡¯ç¤º</h3>
                ${hexagramDisplay}
                <h3>å°‹${targetType === 'lost-person' ? 'äºº' : 'ç‰©'}çµæœç¸½è«–</h3>
                <p>é«”ç”¨é—œä¿‚: ${relation}</p>
                <p>å°‹å›å¯èƒ½æ€§: ${findLikelihood}</p>
                <p>${strengthInfluence}</p>
                <h3>æ–¹ä½æŒ‡å¼•ï¼ˆä»¥æ‚¨é¢å—è€Œå®šï¼‰</h3>
                <p>ä¸»è¦æ–¹å‘ (è®Šå¦): ${mainDirection}</p>
                <p>è¼”åŠ©æ–¹å‘ (äº’å¦): ${auxDirection}</p>
                <h3>ç’°å¢ƒèˆ‡åœ°é»ç·šç´¢</h3>
                <p>ä¸»è¦åœ°é» (è®Šå¦): ${mainLocation}</p>
                <p>è¼”åŠ©åœ°é» (äº’å¦): ${auxLocation}</p>
                <h3>${targetType === 'lost-person' ? 'äººç‰©ç‰¹å¾µç·šç´¢' : 'ç‰©å“ç·šç´¢'}</h3>
                <p>${clues}</p>
                ${personClues ? `<p>äººç‰©ç‰¹å¾µ: ${personClues}</p>` : ''}
                <h3>æ‡‰æœŸé æ¸¬</h3>
                <p>${period}</p>
                <h3>å¤–æ‡‰è§£è®€</h3>
                <p>${externalInterp}</p>
                <h3>å¦è¾­èˆ‡çˆ»è¾­åŸæ–‡åƒè€ƒ</h3>
                <p>${guaCi}</p>
            `;
            return result;
        }

        // è¼”åŠ©å‡½æ•¸ï¼šç²å–ç‰©å“äº”è¡Œ
        function getItemElement(details) {
            if (details.material === 'é‡‘å±¬' || details.category.includes('è²´é‡ç‰©å“') || details.category.includes('é‡‘å±¬è£½å“')) return 'é‡‘';
            if (details.material === 'æœ¨' || details.category.includes('æœ¨è£½å“')) return 'æœ¨';
            if (details.material === 'é™¶ç“·' || details.category.includes('åœŸå™¨ç“¦å™¨/é™¶ç“·')) return 'åœŸ';
            if (details.category.includes('æ°´ç›¸é—œç‰©å“')) return 'æ°´';
            if (details.material === 'å¸ƒæ–™' || details.category.includes('å¸ƒæ–™/è¡£ç‰©')) return 'ç«';
            return null;
        }

        // è¼”åŠ©å‡½æ•¸ï¼šç²å–å­£ç¯€
        function getSeason(date) {
            const month = date.getMonth() + 1;
            if ([3,4,5].includes(month)) return 'æ˜¥';
            if ([6,7,8].includes(month)) return 'å¤';
            if ([9,10,11].includes(month)) return 'ç§‹';
            if ([12,1,2].includes(month)) return 'å†¬';
            return 'å­£æœˆ';
        }

        // è¼”åŠ©å‡½æ•¸ï¼šå„²å­˜æ­·å²ç´€éŒ„
        function saveHistory(caseName, targetType, interpretation) {
            let history = JSON.parse(localStorage.getItem('divination-history') || '[]');
            history.push({
                caseName: caseName || 'æœªå‘½åæ¡ˆä»¶',
                targetType,
                interpretation,
                timestamp: new Date().toLocaleString('zh-TW')
            });
            localStorage.setItem('divination-history', JSON.stringify(history));
        }

        // è¼”åŠ©å‡½æ•¸ï¼šé¡¯ç¤ºæ­·å²ç´€éŒ„
        function showHistory() {
            const history = JSON.parse(localStorage.getItem('divination-history') || '[]');
            let historyHtml = history.length ? history.map((record, index) => `
                <div class="history-item" data-index="${index}">
                    <strong>æ¡ˆä»¶åç¨±:</strong> ${record.caseName}<br>
                    <strong>ç›®æ¨™é¡å‹:</strong> ${record.targetType === 'lost-item' ? 'éºå¤±ç‰©' : record.targetType === 'lost-person' ? 'äººç‰©' : 'å…¶ä»–'}<br>
                    <strong>æ™‚é–“:</strong> ${record.timestamp}
                </div>
            `).join('') : 'ç„¡æ­·å²ç´€éŒ„';
            document.getElementById('history-records').innerHTML = historyHtml;
            document.getElementById('history-records').classList.remove('hidden');

            // ç‚ºæ¯å€‹æ­·å²ç´€éŒ„æ·»åŠ é»æ“Šäº‹ä»¶
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', () => {
                    const index = item.getAttribute('data-index');
                    const record = history[index];
                    document.getElementById('target-type').value = record.targetType;
                    document.getElementById('interpretation').innerHTML = record.interpretation;
                    document.getElementById('result').classList.remove('hidden');
                    document.getElementById('case-name').value = record.caseName;
                });
            });
        }

        // è¼”åŠ©å‡½æ•¸ï¼šåŒ¯å‡ºæ­·å²ç´€éŒ„
        function exportHistory() {
            const history = JSON.parse(localStorage.getItem('divination-history') || '[]');
            const dataStr = JSON.stringify(history, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'divination_history.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // è¼”åŠ©å‡½æ•¸ï¼šåŒ¯å…¥æ­·å²ç´€éŒ„
        function importHistory(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedHistory = JSON.parse(e.target.result);
                    if (Array.isArray(importedHistory)) {
                        localStorage.setItem('divination-history', JSON.stringify(importedHistory));
                        alert('æ­·å²ç´€éŒ„å·²æˆåŠŸåŒ¯å…¥ï¼');
                        showHistory();
                    } else {
                        alert('ç„¡æ•ˆçš„ JSON æª”æ¡ˆæ ¼å¼ï¼');
                    }
                } catch (err) {
                    alert('åŒ¯å…¥å¤±æ•—ï¼šè«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ­£ç¢ºï¼');
                }
            };
            reader.readAsText(file);
        }

        // äº‹ä»¶ç›£è½
        document.addEventListener('DOMContentLoaded', () => {
            loadData();

            const targetSelect = document.getElementById('target-type');
            targetSelect.addEventListener('change', (e) => {
                document.getElementById('divination-method').classList.remove('hidden');
                const type = e.target.value;
                if (type === 'lost-item') {
                    document.getElementById('lost-item-details').classList.remove('hidden');
                    document.getElementById('lost-person-details').classList.add('hidden');
                } else if (type === 'lost-person') {
                    document.getElementById('lost-person-details').classList.remove('hidden');
                    document.getElementById('lost-item-details').classList.add('hidden');
                } else {
                    document.getElementById('lost-item-details').classList.add('hidden');
                    document.getElementById('lost-person-details').classList.add('hidden');
                }
                document.getElementById('target-details').classList.remove('hidden');
                document.getElementById('external-response').classList.remove('hidden');
                document.getElementById('advanced').classList.remove('hidden');
            });

            const methodSelect = document.getElementById('method');
            methodSelect.addEventListener('change', (e) => {
                const method = e.target.value;
                ['time-input', 'number-input', 'manual-input'].forEach(m => {
                    document.getElementById(m).classList.add('hidden');
                });
                if (method) {
                    document.getElementById(`${method}-input`).classList.remove('hidden');
                    if (method === 'time') {
                        const lunar = getLunarDate(new Date('2025-09-06T17:38:00'));
                        document.getElementById('lunar-year').value = lunar.year;
                        document.getElementById('lunar-month').value = lunar.month;
                        document.getElementById('lunar-day').value = lunar.day;
                        document.getElementById('lunar-hour').value = lunar.hour;
                    }
                }
            });

            document.getElementById('set-current-time').addEventListener('click', () => {
                const lunar = getLunarDate(new Date('2025-09-06T17:38:00'));
                document.getElementById('lunar-year').value = lunar.year;
                document.getElementById('lunar-month').value = lunar.month;
                document.getElementById('lunar-day').value = lunar.day;
                document.getElementById('lunar-hour').value = lunar.hour;
            });

            document.getElementById('start-divination').addEventListener('click', () => {
                const method = document.getElementById('method').value;
                if (!method) return alert('è«‹é¸æ“‡èµ·å¦æ–¹å¼');
                const caseName = document.getElementById('case-name').value;
                const targetType = document.getElementById('target-type').value;
                if (!targetType) return alert('è«‹é¸æ“‡å æ¸¬ç›®æ¨™');
                const hex = generateHexagram(method);
                const parsed = parseHexagram(hex.upper, hex.lower, hex.moving);
                let targetDetails = {};
                if (targetType === 'lost-item') {
                    targetDetails = {
                        attributesRelevant: document.getElementById('item-attributes-relevant').checked,
                        category: Array.from(document.getElementById('item-category').selectedOptions).map(o => o.value),
                        color: document.getElementById('item-color').value,
                        shape: document.getElementById('item-shape').value,
                        material: document.getElementById('item-material').value,
                        other: document.getElementById('item-other').value
                    };
                } else if (targetType === 'lost-person') {
                    targetDetails = {
                        attributesRelevant: document.getElementById('person-attributes-relevant').checked,
                        relation: document.getElementById('person-relation').value,
                        gender: document.getElementById('person-gender').value,
                        age: document.getElementById('person-age').value,
                        appearance: document.getElementById('person-appearance').value,
                        behavior: document.getElementById('person-behavior').value,
                        occupation: document.getElementById('person-occupation').value,
                        situation: document.getElementById('person-situation').value
                    };
                }
                const external = document.getElementById('external-desc').value;
                const interp = interpretHexagram(parsed, targetType, targetDetails, external, caseName);
                document.getElementById('interpretation').innerHTML = interp;
                document.getElementById('result').classList.remove('hidden');
                
                // è‡ªå‹•å„²å­˜ç´€éŒ„
                saveHistory(caseName, targetType, interp);
            });

            document.getElementById('view-history').addEventListener('click', () => {
                showHistory();
            });

            document.getElementById('export-history').addEventListener('click', () => {
                exportHistory();
            });

            document.getElementById('import-history').addEventListener('change', (event) => {
                importHistory(event);
            });

            document.getElementById('view-cases').addEventListener('click', () => {
                let casesHtml = data.case_studies.map(cs => `<h4>${cs.title}</h4><p>${cs.description}</p>`).join('');
                document.getElementById('case-studies').innerHTML = casesHtml;
                document.getElementById('case-studies').classList.remove('hidden');
            });
        });
    </script>
</body>
</html>
