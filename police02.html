<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>梅花心易警察辦案輔助系統</title>
    <style>
        body { font-family: '微軟正黑體', 'Microsoft JhengHei', sans-serif; background-color: #f4f4f9; color: #333; display: flex; justify-content: center; align-items: center; flex-direction: column; padding: 20px; min-height: 100vh; }
        .container { display: flex; flex-direction: column; gap: 20px; max-width: 600px; width: 100%; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: #2c3e50; font-size: 2.5em; margin-bottom: 5px; }
        .header p { color: #7f8c8d; font-size: 1.1em; }
        .input-section { background-color: #fff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); padding: 30px; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .input-section h2 { color: #34495e; margin-bottom: 10px; }
        .input-section p { color: #95a5a6; margin-bottom: 20px; }
        input[type="number"] { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; box-sizing: border-box; }
        button { padding: 12px 25px; border: none; border-radius: 5px; background-color: #3498db; color: white; font-size: 1em; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        #resultArea { background-color: #fff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); padding: 30px; display: none; flex-direction: column; align-items: flex-start; margin-top: 20px; text-align: left; }
        #resultArea h3, #resultArea h4 { color: #2c3e50; }
        #resultArea hr { width: 100%; border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0)); }
        .disclaimer { font-size: 0.8em; color: #7f8c8d; margin-top: 20px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>梅花心易警察辦案輔助系統</h1>
        <p>運用古老易經智慧，為案件偵辦提供新視角與線索。</p>
    </div>

    <div class="input-section">
        <h2>數字起卦 - 9位數</h2>
        <p>請輸入與案件相關的9位數數字，例如車牌、時間或任何直覺想到的數字。</p>
        <input type="number" id="numInput" placeholder="請輸入9位數" maxlength="9">
        <button onclick="calculateByNumber()">開始推算</button>
    </div>

    <div id="resultArea"></div>
    
    <p class="disclaimer">* 本系統為輔助工具，其分析結果僅供辦案參考與啟發思路，不應作為唯一的偵辦依據。</p>
</div>

<script>
    // 內嵌 JSON 數據，無需外部文件
    const hexagramData = {
        "gua": {
            "1": { "name": "乾為天", "shortName": "乾", "element": "金", "direction": "西北", "feature": "圓、健、父、領導" },
            "2": { "name": "兌為澤", "shortName": "兌", "element": "金", "direction": "西", "feature": "口、悅、少女、律師" },
            "3": { "name": "離為火", "shortName": "離", "element": "火", "direction": "南", "feature": "火、麗、中女、文書" },
            "4": { "name": "震為雷", "shortName": "震", "element": "木", "direction": "東", "feature": "動、雷、長男、運動員" },
            "5": { "name": "巽為風", "shortName": "巽", "element": "木", "direction": "東南", "feature": "風、入、長女、商人" },
            "6": { "name": "坎為水", "shortName": "坎", "element": "水", "direction": "北", "feature": "險、陷、中男、盜賊" },
            "7": { "name": "艮為山", "shortName": "艮", "element": "土", "direction": "東北", "feature": "止、山、少男、山林人" },
            "8": { "name": "坤為地", "shortName": "坤", "element": "土", "direction": "西南", "feature": "順、地、母、農人" }
        },
        "hexagrams": {
            "1_1": { "name": "乾為天", "summary": "案件進展順利，但可能存在過於強勢的阻力或挑戰。"},
            "1_2": { "name": "天澤履", "summary": "案件應謹慎行事，如履薄冰。"},
            "1_3": { "name": "天火同人", "summary": "案件與志同道合之人有關，或需廣泛尋求合作。"},
            "1_4": { "name": "天雷無妄", "summary": "案件起因非預期，發展難以預測。"},
            "1_5": { "name": "天風姤", "summary": "案件進展迅速，但可能伴隨意外的變數。"},
            "1_6": { "name": "天水訟", "summary": "案件處於爭議或僵持階段，需訴諸法律程序。"},
            "1_7": { "name": "天山遯", "summary": "案件嫌犯可能已潛逃，偵查進入追緝階段。"},
            "1_8": { "name": "天地否", "summary": "案件不通、閉塞，偵查困難，線索中斷。"},
            "2_1": { "name": "澤天夬", "summary": "案件將有重大決斷或突破，可能因某人脫離團夥而豁然開朗。"},
            "2_2": { "name": "兌為澤", "summary": "案件與口舌、溝通、協議有關，需留意相關人員證詞。"},
            "2_3": { "name": "澤火革", "summary": "案件將有重大變革，原先的偵查方向可能需要徹底改變。"},
            "2_4": { "name": "澤雷隨", "summary": "案件需順應局勢，跟隨線索自然發展。"},
            "2_5": { "name": "澤風大過", "summary": "案件發展可能超出常規，偵查面臨極大挑戰。"},
            "2_6": { "name": "澤水困", "summary": "案件陷入困境，線索不足，偵查受阻。"},
            "2_7": { "name": "澤山咸", "summary": "案件與感應、人際關係有關，需從嫌犯的人際網著手。"},
            "2_8": { "name": "澤地萃", "summary": "案件線索將匯聚，偵查人員可共同合作，快速推進。"},
            "3_1": { "name": "火天大有", "summary": "案件將大有斬獲，只要堅持偵辦，必能順利破案。"},
            "3_2": { "name": "火澤睽", "summary": "案件相關人員各懷鬼胎，證詞相互矛盾。"},
            "3_3": { "name": "離為火", "summary": "案件清晰明朗，真相即將大白。"},
            "3_4": { "name": "火雷噬嗑", "summary": "案件需要強硬手段，透過審訊或懲戒來獲得真相。"},
            "3_5": { "name": "火風鼎", "summary": "案件涉及多方，需要團隊協作，各司其職。"},
            "3_6": { "name": "火水未濟", "summary": "案件尚未完成，線索仍有疏漏，需再次確認。"},
            "3_7": { "name": "火山旅", "summary": "案件涉及遷移或異地偵查，嫌犯可能不斷移動。"},
            "3_8": { "name": "火地晉", "summary": "案件進展順利，像太陽東升般逐步明朗。"},
            "4_1": { "name": "雷天大壯", "summary": "案件聲勢浩大，偵查團隊充滿幹勁。"},
            "4_2": { "name": "雷澤歸妹", "summary": "案件可能與不正當關係或非正規途徑有關。"},
            "4_3": { "name": "雷火豐", "summary": "案件線索豐富，但需仔細梳理，避免眼花繚亂。"},
            "4_4": { "name": "震為雷", "summary": "案件突然發生，情況緊急，需快速反應。"},
            "4_5": { "name": "雷風恆", "summary": "案件發展有規律，可從嫌犯的慣性行為中找到線索。"},
            "4_6": { "name": "雷水解", "summary": "案件僵局將被打破，困境得以解除。"},
            "4_7": { "name": "雷山小過", "summary": "偵查過程可能偏離常規，但能意外獲得突破。"},
            "4_8": { "name": "雷地豫", "summary": "案件線索清晰，做好準備即可成功收網。"},
            "5_1": { "name": "風天小畜", "summary": "案件線索雖有但不足，需要時間累積。"},
            "5_2": { "name": "風澤中孚", "summary": "案件需以誠信為本，從嫌犯或證人的內心深處找到突破口。"},
            "5_3": { "name": "風火家人", "summary": "案件與家庭、內部團夥有關。"},
            "5_4": { "name": "風雷益", "summary": "案件偵辦將帶來正面結果，可從中獲得寶貴經驗。"},
            "5_5": { "name": "巽為風", "summary": "案件發展難以捉摸，線索可能稍縱即逝。"},
            "5_6": { "name": "風水渙", "summary": "嫌犯或團夥可能已經分散，偵查範圍廣泛。"},
            "5_7": { "name": "風山漸", "summary": "案件需循序漸進，不能急於求成。"},
            "5_8": { "name": "風地觀", "summary": "案件處於觀察階段，不宜貿然行動。"},
            "6_1": { "name": "水天需", "summary": "案件需要等待時機，不宜急進。"},
            "6_2": { "name": "水澤節", "summary": "偵查需有節制，避免過度投入。"},
            "6_3": { "name": "水火既濟", "summary": "案件已解決，所有線索皆已到位。"},
            "6_4": { "name": "水雷屯", "summary": "案件初期困難重重，需有耐心。"},
            "6_5": { "name": "水風井", "summary": "案件需從固定地點或人脈網絡中尋找線索。"},
            "6_6": { "name": "坎為水", "summary": "案件充滿險阻與陷阱。"},
            "6_7": { "name": "水山蹇", "summary": "案件困難重重，舉步維艱。"},
            "6_8": { "name": "水地比", "summary": "案件偵查可獲得外援。"},
            "7_1": { "name": "山天大畜", "summary": "案件需積累線索，循序漸進。"},
            "7_2": { "name": "山澤損", "summary": "案件需要付出一定的代價才能有所收穫。"},
            "7_3": { "name": "山火賁", "summary": "案件表面複雜，但實則簡單。"},
            "7_4": { "name": "山雷頤", "summary": "案件需從嫌犯的言行舉止中找到線索。"},
            "7_5": { "name": "山風蠱", "summary": "案件牽涉舊案或歷史遺留問題。"},
            "7_6": { "name": "山水蒙", "summary": "案件有許多未解之謎，需要深入調查。"},
            "7_7": { "name": "艮為山", "summary": "案件將暫停或停滯，需要等待時機。"},
            "7_8": { "name": "地山謙", "summary": "案件真相隱藏，需低調偵查。"},
            "8_1": { "name": "地天泰", "summary": "案件順利，陰陽和合。"},
            "8_2": { "name": "地澤臨", "summary": "案件即將來臨，需做好準備。"},
            "8_3": { "name": "地火明夷", "summary": "案件處於黑暗，真相被掩蓋。"},
            "8_4": { "name": "地雷復", "summary": "案件將有轉機，偵查回到正軌。"},
            "8_5": { "name": "地風升", "summary": "案件將逐步上升，順利發展。"},
            "8_6": { "name": "地水師", "summary": "案件涉及多人，需有組織地偵辦。"},
            "8_7": { "name": "山地剝", "summary": "案件線索剝落，偵查困難。"},
            "8_8": { "name": "坤為地", "summary": "案件發展順利，可順勢而為。" }
        },
        "element_relations": {
            "金": { "生": "水", "剋": "木", "被生": "土", "被剋": "火" },
            "木": { "生": "火", "剋": "土", "被生": "水", "被剋": "金" },
            "水": { "生": "木", "剋": "火", "被生": "金", "被剋": "土" },
            "火": { "生": "土", "剋": "金", "被生": "木", "被剋": "水" },
            "土": { "生": "金", "剋": "水", "被生": "火", "被剋": "木" }
        },
        "line_summary": {
            "1": "案件初期，基礎線索。", "2": "案件轉變，關鍵人物或線索。", "3": "案件內部矛盾，不穩定因素。",
            "4": "案件外部線索，團隊協力。", "5": "案件核心，重要決策者。", "6": "案件結尾，最終結果。"
        }
    };

    // 核心八卦陣列
    const numToGua = ['', '乾', '兌', '離', '震', '巽', '坎', '艮', '坤'];

    // 數字起卦主函式
    function calculateByNumber() {
        const input = document.getElementById('numInput').value;
        if (input.length !== 9 || isNaN(input)) {
            alert('請輸入有效的9位數數字！');
            return;
        }
        
        const numStr = String(input);
        const sumLower = parseInt(numStr.substring(0, 3), 10);
        const sumUpper = parseInt(numStr.substring(3, 6), 10);
        const sumChange = parseInt(numStr.substring(6, 9), 10);
        
        const lowerGuaNum = sumLower % 8 === 0 ? 8 : sumLower % 8;
        const upperGuaNum = sumUpper % 8 === 0 ? 8 : sumUpper % 8;
        const changingLine = sumChange % 6 === 0 ? 6 : sumChange % 6;

        generateReport(lowerGuaNum, upperGuaNum, changingLine, input);
    }

    // 卦象分析與報告生成函式
    function generateReport(lowerGuaNum, upperGuaNum, changingLine, input) {
        // 獲取本卦、互卦、變卦
        const mainGua = hexagramData.hexagrams[`${upperGuaNum}_${lowerGuaNum}`];
        const interGuaLowerNum = parseInt(String(lowerGuaNum % 2 === 0 ? lowerGuaNum - 1 : lowerGuaNum + 1), 10);
        const interGuaUpperNum = parseInt(String(upperGuaNum % 2 === 0 ? upperGuaNum - 1 : upperGuaNum + 1), 10);
        const interGua = hexagramData.hexagrams[`${interGuaUpperNum}_${interGuaLowerNum}`];
        
        let changedUpperGuaNum = upperGuaNum;
        let changedLowerGuaNum = lowerGuaNum;
        if (changingLine > 3) {
            changedUpperGuaNum = (changingLine - 3) % 2 === 1 ? (upperGuaNum % 2 === 0 ? upperGuaNum - 1 : upperGuaNum + 1) : upperGuaNum;
        } else {
            changedLowerGuaNum = (changingLine - 1) % 2 === 1 ? (lowerGuaNum % 2 === 0 ? lowerGuaNum - 1 : lowerGuaNum + 1) : lowerGuaNum;
        }
        const changedGua = hexagramData.hexagrams[`${changedUpperGuaNum}_${changedLowerGuaNum}`];

        // 體用分析
        const tiGua = changingLine > 3 ? hexagramData.gua[upperGuaNum] : hexagramData.gua[lowerGuaNum];
        const yongGua = changingLine > 3 ? hexagramData.gua[lowerGuaNum] : hexagramData.gua[upperGuaNum];
        
        let relationText = '';
        const tiElement = tiGua.element;
        const yongElement = yongGua.element;

        if (tiElement === yongElement) {
            relationText = `${tiGua.name}與${yongGua.name}為**比和**關係，代表雙方勢均力敵，案件將按常理發展，但可能需要更多努力。`;
        } else if (hexagramData.element_relations[tiElement].生 === yongElement) {
            relationText = `${tiGua.name}生${yongGua.name}，代表**我方生助對方**。這意味著警方主動付出、積極追查，案件進展順利。`;
        } else if (hexagramData.element_relations[tiElement].剋 === yongElement) {
            relationText = `${tiGua.name}剋${yongGua.name}，代表**我方克制對方**。這意味著警方能掌控局面，可成功將嫌犯繩之以法。`;
        } else if (hexagramData.element_relations[yongElement].生 === tiElement) {
            relationText = `${yongGua.name}生${tiGua.name}，代表**對方生助我方**。這意味著嫌犯或線索提供意外幫助，讓警方被動獲得突破。`;
        } else if (hexagramData.element_relations[yongElement].剋 === tiElement) {
            relationText = `${yongGua.name}剋${tiGua.name}，代表**對方克制我方**。這意味著警方辦案受阻，嫌犯反制能力強，需謹慎應對。`;
        }

        let report = `
            <h3>數字起卦：${input}</h3>
            <p><strong>本卦</strong>：${mainGua ? mainGua.name : '未知卦名'} (${numToGua[upperGuaNum]}上${numToGua[lowerGuaNum]}下)</p>
            <p><strong>動爻</strong>：第 ${changingLine} 爻</p>
            <p><strong>互卦</strong>：${interGua ? interGua.name : '未知卦名'}</p>
            <p><strong>變卦</strong>：${changedGua ? changedGua.name : '未知卦名'}</p>
            
            <hr>
            
            <h4>案件核心分析</h4>
            <p><strong>本卦</strong>：${mainGua ? mainGua.summary : '無相關解釋。'}</p>
            <p><strong>互卦</strong>：${interGua ? '互卦象徵案件的隱藏狀況或內在關係，可能反映出案情的深層次矛盾或真相。' : '無互卦分析。'}</p>
            
            <h4>案件發展與轉折</h4>
            <p><strong>動爻</strong>：第 ${changingLine} 爻代表**${hexagramData.line_summary[changingLine]}**，是案件的關鍵轉變點。</p>
            <p><strong>變卦</strong>：${changedGua ? changedGua.summary : '無相關解釋。'}</p>
            
            <h4>嫌犯與線索分析</h4>
            <ul>
                <li><strong>嫌犯特徵</strong>：根據上卦「${hexagramData.gua[upperGuaNum].name}」與下卦「${hexagramData.gua[lowerGuaNum].name}」，嫌犯可能具有**${hexagramData.gua[upperGuaNum].feature}**或**${hexagramData.gua[lowerGuaNum].feature}**的特徵。</li>
                <li><strong>線索方位</strong>：關鍵線索可能位於**${hexagramData.gua[lowerGuaNum].direction}**方，嫌犯可能藏匿在**${hexagramData.gua[upperGuaNum].direction}**方。</li>
                <li><strong>體用生剋</strong>：體卦（我方，警方）為**${tiGua.name}**，用卦（對方，嫌犯）為**${yongGua.name}**。${relationText}</li>
            </ul>
        `;

        document.getElementById('resultArea').innerHTML = report;
        document.getElementById('resultArea').style.display = 'flex';
    }
</script>

</body>
</html>
