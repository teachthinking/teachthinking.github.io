<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>梅花心易｜五行定吉凶（五面向分析 Demo）</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tab-active { @apply border-b-2 border-slate-900 text-slate-900; }
    .hexagram-lines { font-family: monospace; white-space: pre; }
    .explanation { display: none; }
    .explanation.active { display: block; }
  </style>
</head>
<body class="bg-gradient-to-b from-white to-slate-50 text-slate-800 min-h-screen">
  <div class="max-w-5xl mx-auto p-6 md:p-10 space-y-6">
    <header class="flex items-center justify-between">
      <h1 class="text-2xl md:text-3xl font-bold tracking-tight">梅花心易｜五行定吉凶（五面向分析 Demo）</h1>
      <button id="resetBtn" class="px-3 py-2 text-sm rounded-xl border shadow-sm hover:bg-slate-50">重置示例</button>
    </header>
    <section class="bg-white rounded-2xl shadow-sm border p-5">
      <h2 class="font-semibold mb-3">設定占卜條件</h2>
      <div class="space-y-4">
        <div class="flex items-center space-x-4">
          <label for="methodSelect" class="flex-shrink-0">占卜方式:</label>
          <select id="methodSelect" class="w-full rounded-md border border-slate-300 p-2 focus:ring focus:ring-sky-200 focus:border-sky-500">
            <option value="manual">手動選卦</option>
            <option value="number">數字起卦</option>
            <option value="time">時間起卦</option>
          </select>
        </div>
        
        <div id="manualInput" class="flex items-center space-x-4">
          <label for="lowerSelect" class="flex-shrink-0">內卦:</label>
          <select id="lowerSelect" class="rounded-md border border-slate-300 p-2 focus:ring focus:ring-sky-200 focus:border-sky-500"></select>
          <label for="upperSelect" class="flex-shrink-0">外卦:</label>
          <select id="upperSelect" class="rounded-md border border-slate-300 p-2 focus:ring focus:ring-sky-200 focus:border-sky-500"></select>
          <label for="movingInput" class="flex-shrink-0">動爻:</label>
          <input type="number" id="movingInput" value="1" min="1" max="6" class="rounded-md border border-slate-300 p-2 w-16 text-center focus:ring focus:ring-sky-200 focus:border-sky-500" />
        </div>
        
        <div id="numberInput" class="hidden flex items-center space-x-4">
          <label for="numberValue" class="flex-shrink-0">輸入數字:</label>
          <input type="number" id="numberValue" placeholder="輸入任一數字" class="w-full rounded-md border border-slate-300 p-2 focus:ring focus:ring-sky-200 focus:border-sky-500" />
        </div>
        
        <div id="timeInput" class="hidden flex items-center space-x-4">
          <label for="datetimeValue" class="flex-shrink-0">選擇時間:</label>
          <input type="datetime-local" id="datetimeValue" class="w-full rounded-md border border-slate-300 p-2 focus:ring focus:ring-sky-200 focus:border-sky-500" />
        </div>
      </div>
    </section>

    <div class="grid md:grid-cols-3 gap-6">
      <section class="bg-white rounded-2xl shadow-sm border p-5 space-y-4">
        <h2 class="text-xl font-semibold text-center">本卦</h2>
        <pre id="baseHexagram" class="hexagram-lines text-center text-4xl leading-tight"></pre>
        <div id="baseInfo" class="space-y-1 text-sm text-slate-600">
          <div id="baseSymbol" class="text-center text-5xl"></div>
          <div id="baseName" class="text-xl font-bold text-center text-slate-900"></div>
          <p id="baseDictum" class="text-center italic"></p>
          <p id="baseUpper" class="text-center"></p>
          <p id="baseLower" class="text-center"></p>
          <p id="baseRelation" class="text-center"></p>
          <p id="movingDictum" class="mt-4 border-t pt-2 text-center text-slate-700"></p>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-sm border p-5 space-y-4">
        <h2 class="text-xl font-semibold text-center">互卦</h2>
        <pre id="mutualHexagram" class="hexagram-lines text-center text-4xl leading-tight"></pre>
        <div id="mutualInfo" class="space-y-1 text-sm text-slate-600">
          <div id="mutualSymbol" class="text-center text-5xl"></div>
          <div id="mutualName" class="text-xl font-bold text-center text-slate-900"></div>
          <p id="mutualDictum" class="text-center italic"></p>
          <p id="mutualUpper" class="text-center"></p>
          <p id="mutualLower" class="text-center"></p>
          <p id="mutualRelation" class="text-center"></p>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-sm border p-5 space-y-4">
        <h2 class="text-xl font-semibold text-center">變卦</h2>
        <pre id="changedHexagram" class="hexagram-lines text-center text-4xl leading-tight"></pre>
        <div id="changedInfo" class="space-y-1 text-sm text-slate-600">
          <div id="changedSymbol" class="text-center text-5xl"></div>
          <div id="changedName" class="text-xl font-bold text-center text-slate-900"></div>
          <p id="changedDictum" class="text-center italic"></p>
          <p id="changedUpper" class="text-center"></p>
          <p id="changedLower" class="text-center"></p>
          <p id="changedRelation" class="text-center"></p>
        </div>
      </section>
    </div>

    <section class="bg-white rounded-2xl shadow-sm border p-5">
      <h2 class="text-xl font-semibold mb-3">五面向分析</h2>
      <div class="flex border-b border-slate-200 mb-4">
        <button data-tab="human" class="tab-btn px-4 py-2 hover:bg-slate-50">人</button>
        <button data-tab="event" class="tab-btn px-4 py-2 hover:bg-slate-50">事</button>
        <button data-tab="time" class="tab-btn px-4 py-2 hover:bg-slate-50">時</button>
        <button data-tab="place" class="tab-btn px-4 py-2 hover:bg-slate-50">地</button>
        <button data-tab="object" class="tab-btn px-4 py-2 hover:bg-slate-50">物</button>
      </div>
      <div id="tab-human" class="tab-pane space-y-2 text-sm"></div>
      <div id="tab-event" class="tab-pane hidden space-y-2 text-sm"></div>
      <div id="tab-time" class="tab-pane hidden space-y-2 text-sm"></div>
      <div id="tab-place" class="tab-pane hidden space-y-2 text-sm"></div>
      <div id="tab-object" class="tab-pane hidden space-y-2 text-sm"></div>
    </section>

    <footer class="text-center text-sm text-slate-500 mt-6">
      © <span id="year"></span> 梅花心易｜五行定吉凶 Demo
    </footer>
  </div>

  <script>
    const TRIGRAMS = [
      { key: "乾", bin: [1,1,1], element: "金", symbol: "☰", color: "#FFD700" },
      { key: "兌", bin: [0,1,1], element: "金", symbol: "☱", color: "#FFD700" },
      { key: "離", bin: [1,0,1], element: "火", symbol: "☲", color: "#FF0000" },
      { key: "震", bin: [0,0,1], element: "木", symbol: "☳", color: "#008000" },
      { key: "巽", bin: [1,1,0], element: "木", symbol: "☴", color: "#008000" },
      { key: "坎", bin: [0,1,0], element: "水", symbol: "☵", color: "#0000FF" },
      { key: "艮", bin: [1,0,0], element: "土", symbol: "☶", color: "#A52A2A" },
      { key: "坤", bin: [0,0,0], element: "土", symbol: "☷", color: "#A52A2A" },
    ];

    const HEXAGRAMS = {
      "乾乾": { name: "乾為天", symbol: "䷀", dictum: "元亨利貞。", yaos: ["初九：潛龍勿用。", "九二：見龍在田，利見大人。", "九三：君子終日乾乾，夕惕若厲，无咎。", "九四：或躍在淵，无咎。", "九五：飛龍在天，利見大人。", "上九：亢龍有悔。"] },
      "坤坤": { name: "坤為地", symbol: "䷁", dictum: "元亨。利牝馬之貞。君子有攸往，先迷後得主，利西南得朋，東北喪朋。安貞吉。", yaos: ["初六：履霜，堅冰至。", "六二：直方大，不習无不利。", "六三：含章可貞，或從王事，无成有終。", "六四：括囊，无咎无譽。", "六五：黃裳元吉。", "上六：龍戰于野，其血玄黃。"] },
      "坎震": { name: "屯", symbol: "䷂", dictum: "元亨利貞，勿用有攸往，利建侯。", yaos: ["初九：磐桓，利居貞，利建侯。", "六二：屯如邅如，乘馬班如。匪寇婚媾，女子貞不字，十年乃字。", "六三：即鹿无虞，惟入于林中，君子幾不如舍，往吝。", "六四：乘馬班如，求婚媾，无不利。", "九五：屯其膏，小貞吉，大貞凶。", "上六：乘馬班如，泣血漣如。"] },
      "艮坎": { name: "蒙", symbol: "䷃", dictum: "亨。匪我求童蒙，童蒙求我。初筮告，再三瀆，瀆則不告。利貞。", yaos: ["初六：發蒙，利用刑人，用說桎梏，以往吝。", "九二：包蒙吉。納婦吉，子克家。", "六三：勿用取女，見金夫，不有躬，无攸利。", "六四：困蒙，吝。", "六五：童蒙，吉。", "上九：擊蒙，不利為寇，利御寇。"] },
      "坎乾": { name: "需", symbol: "䷄", dictum: "有孚，光亨，貞吉，利涉大川。", yaos: ["初九：需于郊，利用恆，无咎。", "九二：需于沙，小有言，終吉。", "九三：需于泥，致寇至。", "六四：需于血，出自穴。", "九五：需于酒食，貞吉.", "上六：入于穴，有不速之客三人來，敬之終吉。"] },
      "乾坎": { name: "訟", symbol: "䷅", dictum: "有孚窒惕，中吉，終凶。利見大人，不利涉大川。", yaos: ["初六：不永所事，小有言，終吉。", "九二：不克訟，歸而逋，其邑人三百戶，无眚。", "六三：食舊德，貞厲，終吉，或從王事，无成。", "九四：不克訟，復即命渝，安貞吉。", "九五：訟元吉。", "上九：或錫之鞶帶，終朝三褫之。"] },
      "坤坎": { name: "師", symbol: "䷆", dictum: "貞，丈人吉，无咎。", yaos: ["初六：師出以律，否臧凶。", "九二：在師中吉，无咎，王三錫命。", "六三：師或輿尸，凶。", "六四：師左次，无咎。", "六五：田有禽，利執言，无咎。長子帥師，弟子輿尸，貞凶。", "上六：大君有命，開國承家，小人勿用。"] },
      "坎坤": { name: "比", symbol: "䷇", dictum: "吉。原筮元永貞，无咎。不寧方來，後夫凶。", yaos: ["初六：有孚比之，无咎。有孚盈缶，終來有他吉。", "六二：比之自內，貞吉。", "六三：比之匪人。", "六四：外比之，貞吉。", "九五：顯比，王用三驅，失前禽，邑人不誡，吉.", "上六：比之无首，凶。"] },
      "巽乾": { name: "小畜", symbol: "䷈", dictum: "亨。密雲不雨，自我西郊。", yaos: ["初九：復自道，何其咎，吉。", "九二：牽復，吉。", "九三：輿說輻，夫妻反目。", "六四：有孚，血去惕出，无咎。", "九五：有孚攣如，富以其鄰。", "上九：既雨既處，尚德載，婦貞厲。月幾望，君子征凶。"] },
      "乾兌": { name: "履", symbol: "䷉", dictum: "履虎尾，不咥人，亨。", yaos: ["初九：素履，往无咎。", "九二：履道坦坦，幽人貞吉。", "六三：眇能視，跛能履，履虎尾，咥人，凶。武人為于大君。", "九四：履虎尾，愬愬，終吉。", "九五：夬履，貞厲。", "上九：視履考祥，其旋元吉。"] },
      "坤乾": { name: "泰", symbol: "䷊", dictum: "小往大來，吉亨。", yaos: ["初九：拔茅茹，以其彙，征吉。", "九二：包荒，用馮河，不遐遺，朋亡，得尚于中行。", "九三：无平不陂，无往不復，艱貞无咎。勿恤其孚，于食有福。", "六四：翩翩不富，以其鄰，不戒以孚。", "六五：帝乙歸妹，以祉元吉。", "上六：城復于隍，勿用師，自邑告命，貞吝。"] },
      "乾坤": { name: "否", symbol: "䷋", dictum: "否之匪人，不利君子貞，大往小來。", yaos: ["初六：拔茅茹，以其彙，貞吉亨。", "六二：包承，小人吉，大人否亨。", "六三：包羞。", "九四：有命无咎，畴離祉。", "九五：休否，大人吉，其亡其亡，繫于苞桑。", "上九：傾否，先否後喜。"] },
      "乾離": { name: "同人", symbol: "䷌", dictum: "同人于野，亨。利涉大川，利君子貞。", yaos: ["初九：同人于門，无咎。", "六二：同人于宗，吝。", "九三：伏戎于莽，升其高陵，三歲不興。", "九四：乘其墉，弗克攻，吉。", "九五：同人，先號咷而後笑，大師克相遇。", "上九：同人于郊，无悔。"] },
      "離乾": { name: "大有", symbol: "䷍", dictum: "元亨。", yaos: ["初九：无交害，匪咎，艱則无咎。", "九二：大車以載，有攸往，无咎。", "九三：公用亨于天子，小人弗克。", "九四：匪其彭，无咎。", "六五：厥孚交如，威如，吉。", "上九：自天祐之，吉无不利。"] },
      "坤艮": { name: "謙", symbol: "䷎", dictum: "亨，君子有終。", yaos: ["初六：謙謙君子，用涉大川，吉。", "六二：鳴謙，貞吉。", "九三：勞謙，君子有終，吉。", "六四：无不利，撝謙。", "六五：不富以其鄰，利用侵伐，无不利。", "上六：鳴謙，利用行師，征邑國。"] },
      "震坤": { name: "豫", symbol: "䷏", dictum: "利建侯行師。", yaos: ["初六：鳴豫，凶。", "六二：介于石，不終日，貞吉。", "六三：盱豫，悔。遲有悔。", "九四：由豫，大有得。勿疑，朋盍簪。", "六五：貞疾，恆不死。", "上六：冥豫，成有渝，无咎。"] },
      "兌震": { name: "隨", symbol: "䷐", dictum: "元亨利貞，无咎。", yaos: ["初九：官有渝，貞吉。出門交有功。", "六二：係小子，失丈夫。", "六三：係丈夫，失小子。隨有求得，利居貞。", "九四：隨有獲，貞凶。有孚在道，以明，何咎。", "九五：孚于嘉，吉。", "上六：拘繫之，乃從維之，王用亨于西山。"] },
      "艮巽": { name: "蠱", symbol: "䷑", dictum: "元亨，利涉大川。先甲三日，後甲三日。", yaos: ["初六：幹父之蠱，有子，考无咎，厲終吉。", "九二：幹母之蠱，不可貞。", "九三：幹父之蠱，小有悔，无大咎。", "六四：裕父之蠱，往見吝。", "六五：幹父之蠱，用譽。", "上九：不事王侯，高尚其事。"] },
      "坤兌": { name: "臨", symbol: "䷒", dictum: "元亨，利貞。至于八月有凶。", yaos: ["初九：咸臨，貞吉。", "九二：咸臨，吉无不利。", "六三：甘臨，无攸利。既憂之，無咎。", "六四：至臨，无咎。", "六五：知臨，大君之宜，吉。", "上六：敦臨，吉无咎。"] },
      "巽坤": { name: "觀", symbol: "䷓", dictum: "盥而不薦，有孚顒若。", yaos: ["初六：童觀，小人无咎，君子吝。", "六二：窺觀，利女貞。", "六三：觀我生，進退。", "六四：觀國之光，利用賓于王。", "九五：觀我生，君子无咎。", "上九：觀其生，君子无咎。"] },
      "離震": { name: "噬嗑", symbol: "䷔", dictum: "亨。利用獄。", yaos: ["初九：屨校滅趾，无咎。", "六二：噬膚滅鼻，无咎。", "六三：噬臘肉，遇毒，小吝，无咎。", "九四：噬乾胏，得金矢，利艱貞，吉。", "六五：噬乾肉，得黃金，貞厲，无咎。", "上九：何校滅耳，凶。"] },
      "艮離": { name: "賁", symbol: "䷕", dictum: "亨。小利有攸往。", yaos: ["初九：賁其趾，舍車而徒。", "六二：賁其須。", "九三：賁如濡如，永貞吉。", "六四：賁如皤如，白馬翰如，匪寇婚媾。", "六五：賁于丘園，束帛戔戔，吝，終吉。", "上九：白賁，无咎。"] },
      "坤艮": { name: "剝", symbol: "䷖", dictum: "不利有攸往。", yaos: ["初六：剝床以足，蔑貞凶。", "六二：剝床以辨，蔑貞凶。", "六三：剝之，无咎。", "六四：剝床以膚，凶。", "六五：貫魚，以宮人寵，无不利。", "上九：碩果不食，君子得輿，小人剝盧。"] },
      "震坤": { name: "復", symbol: "䷗", dictum: "亨。出入无疾，朋來无咎。反復其道，七日來復，利有攸往。", yaos: ["初九：不遠復，无祗悔，元吉。", "六二：休復，吉。", "六三：頻復，厲无咎。", "六四：中行獨復。", "六五：敦復，无悔。", "上六：迷復，凶，有災眚。用行師，終以大敗，以其國君凶，至于十年不克征。"] },
      "乾震": { name: "无妄", symbol: "䷘", dictum: "元亨利貞。其匪正有眚，不利有攸往。", yaos: ["初九：无妄，往吉。", "六二：不耕獲，不菑畬，則利有攸往。", "六三：无妄之災，或繫之牛，行人之得，邑人之災。", "九四：可貞，无咎。", "九五：无妄之疾，勿藥有喜。", "上九：无妄，行有眚，无攸利。"] },
      "艮乾": { name: "大畜", symbol: "䷙", dictum: "利貞，不家食吉，利涉大川。", yaos: ["初九：有厲，利已。", "九二：輿說輻。", "九三：良馬逐，利艱貞，曰閑輿衛，利有攸往。", "六四：童牛之牿，元吉。", "六五：豶豕之牙，吉。", "上九：何天之衢，亨。"] },
      "艮坎": { name: "頤", symbol: "䷚", dictum: "貞吉，觀頤，自求口實。", yaos: ["初九：舍爾靈龜，觀我朵頤，凶。", "六二：顛頤，拂經，于丘頤，征凶。", "六三：拂頤，貞凶，十年勿用，无攸利。", "六四：顛頤，吉，虎視眈眈，其欲逐逐，无咎。", "六五：拂經，居貞吉，不可涉大川。", "上九：由頤，厲吉，利涉大川。"] },
      "兌巽": { name: "大過", symbol: "䷛", dictum: "棟撓，利有攸往，亨。", yaos: ["初六：藉用白茅，无咎。", "九二：枯楊生稊，老夫得其女妻，无不利。", "九三：棟撓，凶。", "九四：棟隆，吉，有它吝。", "九五：枯楊生華，老婦得士夫，无咎无譽。", "上六：過涉滅頂，凶，无咎。"] },
      "坎坎": { name: "習坎", symbol: "䷜", dictum: "有孚，維心亨，行有尚。", yaos: ["初六：習坎，入于坎窞，凶。", "九二：坎有險，求小得。", "六三：來之坎坎，險且枕，入于坎窞，勿用。", "六四：樽酒簋貳，用缶，納約自牖，无咎。", "九五：坎不盈，祗既平，无咎。", "上六：繫用徽纆，寘于叢棘，三歲不得，凶。"] },
      "離離": { name: "離為火", symbol: "䷝", dictum: "利貞，亨。畜牝牛，吉。", yaos: ["初九：履錯然，敬之无咎。", "六二：黃離，元吉。", "九三：日昃之離，不鼓缶而歌，則大耋之嗟，凶。", "九四：突如其來如，焚如，死如，棄如。", "六五：出涕沱若，戚嗟若，吉。", "上九：王用出征，有嘉折首，獲匪其方，无咎。"] },
      "震震": { name: "震為雷", symbol: "䷞", dictum: "亨。震來虩虩，後笑言啞啞。震驚百里，不喪匕鬯。", yaos: ["初九：震來虩虩，後笑言啞啞，吉。", "六二：震來厲，億喪貝，于九陵，勿逐，七日得。", "六三：震蘇蘇，吝。", "九四：震遂泥。", "六五：震往來厲，億無喪，有事。", "上六：震索索，視吉，征凶，震不于其躬，于其鄰。"] },
      "艮艮": { name: "艮為山", symbol: "䷟", dictum: "艮其背，不獲其身，行其庭，不見其人，无咎。", yaos: ["初六：艮其趾，无咎，利永貞。", "六二：艮其腓，不拯其隨，其心不快。", "九三：艮其限，列其夤，厲，熏心。", "六四：艮其身，无咎。", "六五：艮其輔，言有序，悔亡。", "上九：敦艮，吉。"] },
      "巽巽": { name: "巽為風", symbol: "䷠", dictum: "小亨，利有攸往，利見大人。", yaos: ["初六：進退，利武人貞。", "九二：巽在床下，用史巫紛若，吉，无咎。", "九三：頻巽，吝。", "六四：利有攸往，悔亡。", "九五：巽其股，悔亡，无咎。", "上六：巽在床下，其言誾誾，厲，悔亡，无咎。"] },
      "兌兌": { name: "兌為澤", symbol: "䷡", dictum: "亨，利貞。", yaos: ["初九：和兌，吉。", "九二：和兌，貞吉。", "六三：來兌，凶。", "九四：來兌，有悔。", "九五：孚于嘉，吉。", "上六：引兌，凶。"] },
      "乾震": { name: "大壯", symbol: "䷢", dictum: "利貞。", yaos: ["初九：壯于趾，征凶，有孚。", "九二：貞吉。", "九三：小人用壯，君子用壯，貞厲。羝羊觸藩，羸其角。", "九四：羝羊觸藩，不能退，不能遂，无攸利，艱則吉。", "六五：喪羊于易，无悔。", "上六：羝羊觸藩，不能退，不能遂，无攸利，艱則吉。"] },
      "震乾": { name: "歸妹", symbol: "䷣", dictum: "征凶，无攸利。", yaos: ["初九：歸妹以娣，跛能履，征吉。", "九二：顛，其位，小人吉，大人凶。", "六三：歸妹以須，反其道，征凶。", "六四：歸妹以時，利。", "六五：帝乙歸妹，其君之袂，不如其娣之袂，良。", "上六：女承筐，無實，士劓羊，无血，无攸利。"] },
      "巽艮": { name: "漸", symbol: "䷤", dictum: "女歸吉，利貞。", yaos: ["初六：鴻漸于干，小子厲，有言，无咎。", "六二：鴻漸于磐，飲食衎衎，吉。", "九三：鴻漸于陸，夫征不復，婦孕不育，凶。利禦寇。", "六四：鴻漸于木，或得其桷，无咎。", "九五：鴻漸于陵，婦三歲不孕，終吉。", "上九：鴻漸于陸，其羽可用為儀，吉。"] },
      "兌離": { name: "歸妹", symbol: "䷣", dictum: "征凶，无攸利。", yaos: ["初九：歸妹以娣，跛能履，征吉。", "九二：顛，其位，小人吉，大人凶。", "六三：歸妹以須，反其道，征凶。", "九四：歸妹以時，利。", "六五：帝乙歸妹，其君之袂，不如其娣之袂，良。", "上六：女承筐，無實，士劓羊，无血，无攸利。"] },
      "震兌": { name: "豐", symbol: "䷥", dictum: "亨，王假之，勿憂，宜日中。", yaos: ["初九：豐其蔀，日中見斗，往得疑，厲，吉。", "六二：豐其蔀，日中見斗，往得疑，厲，吉。", "九三：豐其蔀，日中見斗，往得疑，厲，吉。", "九四：豐其蔀，日中見斗，往得疑，厲，吉。", "六五：來章，有慶，譽。吉。", "上六：豐其屋，蔀其家，窺其戶，闃其人，三年不見，凶。"] },
      "離坎": { name: "明夷", symbol: "䷦", dictum: "利艱貞。", yaos: ["初九：明夷于飛，垂其翼，君子于行，三日不食，有攸往，主人有言。", "六二：明夷于飛，垂其翼，君子于行，三日不食，有攸往，主人有言。", "九三：明夷于飛，垂其翼，君子于行，三日不食，有攸往，主人有言。", "六四：明夷于飛，垂其翼，君子于行，三日不食，有攸往，主人有言。", "六五：明夷于飛，垂其翼，君子于行，三日不食，有攸往，主人有言。", "上六：明夷于飛，垂其翼，君子于行，三日不食，有攸往，主人有言。"] },
      "坤兌": { name: "損", symbol: "䷨", dictum: "有孚，元吉，无咎，可貞，利有攸往。", yaos: ["初九：損其疾，无大咎。", "九二：利貞，征凶。", "六三：三人行，必有一人，損一人，增一人。", "六四：損其疾，无大咎。", "六五：三人行，必有一人，損一人，增一人。", "上六：三人行，必有一人，損一人，增一人。"] },
      "兌坤": { name: "益", symbol: "䷩", dictum: "利有攸往，利涉大川。", yaos: ["初九：益其所損，无大咎。", "六二：或益之，十朋之龜，弗克違，永貞吉。", "六三：益之用凶事，无咎。", "六四：益之用凶事，无咎。", "九五：益之用凶事，无咎。", "上九：莫益之，或擊之，立心勿恆，凶。"] },
      "震坎": { name: "噬嗑", symbol: "䷔", dictum: "亨，利用獄。", yaos: ["初九：屨校滅趾，无咎。", "六二：噬膚滅鼻，无咎。", "六三：噬臘肉，遇毒，小吝，无咎。", "九四：噬乾胏，得金矢，利艱貞，吉。", "六五：噬乾肉，得黃金，貞厲，无咎。", "上九：何校滅耳，凶。"] },
      "艮震": { name: "震", symbol: "䷟", dictum: "亨，震來虩虩，後笑言啞啞。震驚百里，不喪匕鬯。", yaos: ["初九：震來虩虩，後笑言啞啞，吉。", "六二：震來厲，億喪貝，于九陵，勿逐，七日得。", "六三：震蘇蘇，吝。", "九四：震遂泥。", "六五：震往來厲，億無喪，有事。", "上六：震索索，視吉，征凶，震不于其躬，于其鄰。"] },
    };

    const INTERPRETATIONS = {
      "human": {
        "乾": { "desc": "父、長者、領導", "impact": "影響：權威、決斷力強。", "auspicious": "吉：得貴人助。", "inauspicious": "凶：過剛易折。" },
        "兌": { "desc": "少女、悅口之人", "impact": "影響：溝通順暢。", "auspicious": "吉：喜悅和睦。", "inauspicious": "凶：口舌是非。" },
        "離": { "desc": "中女、文明之人", "impact": "影響：智慧明達。", "auspicious": "吉：文化興盛。", "inauspicious": "凶：虛華不實。" },
        "震": { "desc": "長男、驚動者", "impact": "影響：動盪變革。", "auspicious": "吉：振奮人心。", "inauspicious": "凶：驚恐不安。" },
        "巽": { "desc": "長女、商賈、流通者", "impact": "影響：柔順入理。", "auspicious": "吉：商業順利。", "inauspicious": "凶：猶豫不決。" },
        "坎": { "desc": "中男、行旅、險難者", "impact": "影響：危險困頓。", "auspicious": "吉：渡過難關。", "inauspicious": "凶：陷入險境。" },
        "艮": { "desc": "少男、門戶、止守者", "impact": "影響：靜止堅守。", "auspicious": "吉：安定平和。", "inauspicious": "凶：頑固不化。" },
        "坤": { "desc": "母、眾、承載者", "impact": "影響：包容順從。", "auspicious": "吉：大地豐收。", "inauspicious": "凶：過柔無主。" }
      },
      "event": {
        "乾": { "desc": "重大決策、領導事務", "impact": "影響：事情發展迅速且具決定性。", "auspicious": "吉：事業成功、晉升順利。", "inauspicious": "凶：剛愎自用導致失敗。" },
        "兌": { "desc": "溝通交流、娛樂聚會", "impact": "影響：氣氛愉快但易浮於表面。", "auspicious": "吉：達成共識、合作愉快。", "inauspicious": "凶：言辭衝突、承諾難兌現。" },
        "離": { "desc": "文化教育、光明之事", "impact": "影響：注重形象與外在表現。", "auspicious": "吉：創意實現、名聲提升。", "inauspicious": "凶：華而不實、虛名無益。" },
        "震": { "desc": "變動開始、突發事件", "impact": "影響：帶來衝擊與改變。", "auspicious": "吉：突破困境、創新改革。", "inauspicious": "凶：驚慌失措、動盪不安。" },
        "巽": { "desc": "商業交易、物流流通", "impact": "影響：漸進式發展與滲透。", "auspicious": "吉：財源廣進、計劃順利推進。", "inauspicious": "凶：隨波逐流、缺乏方向。" },
        "坎": { "desc": "危險困難、暗藏危機", "impact": "影響：過程艱險需要謹慎。", "auspicious": "吉：險中求勝、鍛煉心志。", "inauspicious": "凶：陷入困境、難以自拔。" },
        "艮": { "desc": "停滯守成、固守現狀", "impact": "影響：進展緩慢但穩定。", "auspicious": "吉：基礎穩固、防守成功。", "inauspicious": "凶：停滯不前、錯失良機。" },
        "坤": { "desc": "大眾事務、農耕建設", "impact": "影響：緩慢但持續的發展。", "auspicious": "吉：豐收有成、眾人支持。", "inauspicious": "凶：優柔寡斷、缺乏進取。" }
      },
      "time": {
        "乾": { "desc": "秋末、冬季，或午後", "impact": "影響：時機成熟、決斷之時。", "auspicious": "吉：掌握時機、事半功倍。", "inauspicious": "凶：操之過急、時不我與。" },
        "兌": { "desc": "秋季，或傍晚", "impact": "影響：萬物收穫、喜悅之時。", "auspicious": "吉：時機正好、收穫頗豐。", "inauspicious": "凶：時運不佳、口舌之爭。" },
        "離": { "desc": "夏季，或中午", "impact": "影響：光明旺盛、發展之時。", "auspicious": "吉：時運當旺、名聲遠播。", "inauspicious": "凶：過於高調、華而不實。" },
        "震": { "desc": "春季，或清晨", "impact": "影響：變動開始、興起之時。", "auspicious": "吉：抓住先機、快速發展。", "inauspicious": "凶：時機未到、輕舉妄動。" },
        "巽": { "desc": "春夏之交，或上午", "impact": "影響：柔順漸進、流通之時。", "auspicious": "吉：順勢而為、財源滾滾。", "inauspicious": "凶：猶豫不決、錯失良機。" },
        "坎": { "desc": "冬季，或深夜", "impact": "影響：潛伏暗藏、困頓之時。", "auspicious": "吉：靜觀其變、以退為進。", "inauspicious": "凶：時機險惡、舉步維艱。" },
        "艮": { "desc": "冬末春初，或深夜", "impact": "影響：靜止不動、守成之時。", "auspicious": "吉：持盈保泰、靜候時機。", "inauspicious": "凶：停滯不前、錯失機會。" },
        "坤": { "desc": "四季末，或傍晚", "impact": "影響：包容萬物、蘊藏之時。", "auspicious": "吉：廣納資源、穩定發展。", "inauspicious": "凶：過於緩慢、缺乏主動。" }
      },
      "place": {
        "乾": { "desc": "京城、高樓、西北方", "impact": "影響：能量集中、威嚴之地。", "auspicious": "吉：權力中心、發展順利。", "inauspicious": "凶：高處不勝寒、易生壓迫。" },
        "兌": { "desc": "湖泊、水澤、西方", "impact": "影響：溝通順暢、人脈豐沛。", "auspicious": "吉：人氣旺盛、歡樂之地。", "inauspicious": "凶：水澤易散、難以積聚。" },
        "離": { "desc": "城市、明亮之處、南方", "impact": "影響：光明與熱情之地。", "auspicious": "吉：名聲遠播、文教發達。", "inauspicious": "凶：虛華之地、缺乏實質。" },
        "震": { "desc": "郊外、鬧區、東方", "impact": "影響：充滿動能、變化之地。", "auspicious": "吉：充滿活力、發展迅速。", "inauspicious": "凶：過於喧囂、動盪不安。" },
        "巽": { "desc": "樹林、草地、東南方", "impact": "影響：流通順暢、漸進之地。", "auspicious": "吉：風調雨順、商業興旺。", "inauspicious": "凶：變化不定、難以掌握。" },
        "坎": { "desc": "水邊、險地、北方", "impact": "影響：暗藏風險、險惡之地。", "auspicious": "吉：險中求勝、鍛鍊心志。", "inauspicious": "凶：危險之地、易陷困境。" },
        "艮": { "desc": "山區、門牆、靜止之處", "impact": "影響：靜止與阻隔能量場。", "auspicious": "吉：穩定之地、安居樂業。", "inauspicious": "凶：阻塞之地、發展受限。" },
        "坤": { "desc": "田野、廣場、平坦之處", "impact": "影響：包容與承載能量場。", "auspicious": "吉：豐饒之地、資源豐富。", "inauspicious": "凶：散漫之地、缺乏重點。" }
      },
      "object": {
        "乾": { "desc": "金屬物品、圓形物、貴重品", "impact": "影響：代表權威與價值。", "auspicious": "吉：得寶物、價值提升。", "inauspicious": "凶：剛硬易折、價值過度。" },
        "兌": { "desc": "樂器、餐具、開口器物", "impact": "影響：代表溝通與喜悅。", "auspicious": "吉：和諧之物、增進感情。", "inauspicious": "凶：破損器物、引發爭執。" },
        "離": { "desc": "燈具、書籍、電子產品", "impact": "影響：代表文明與光明。", "auspicious": "吉：文明之物、啟發智慧。", "inauspicious": "凶：虛華之物、徒有其表。" },
        "震": { "desc": "樂器、電器、發聲物", "impact": "影響：代表變動與衝擊。", "auspicious": "吉：得新物、有意外之喜。", "inauspicious": "凶：損壞、故障、突發狀況。" },
        "巽": { "desc": "木製物、細長物、布帛", "impact": "影響：代表柔順與流通。", "auspicious": "吉：流通順暢、財物增長。", "inauspicious": "凶：缺乏主體、隨風飄蕩。" },
        "坎": { "desc": "液體、水相關器物、險峻之物", "impact": "影響：代表流動與危險。", "auspicious": "吉：化險為夷、水到渠成。", "inauspicious": "凶：沉沒、損失、陷入困境。" },
        "艮": { "desc": "石頭、土製物、堅固之物", "impact": "影響：代表穩固與停止。", "auspicious": "吉：穩定之物、堅實可靠。", "inauspicious": "凶：停滯不前、阻礙發展。" },
        "坤": { "desc": "布料、方形物、土地相關物品", "impact": "影響：代表包容與承載。", "auspicious": "吉：物資豐富、基礎穩固。", "inauspicious": "凶：雜亂無章、缺乏重點。" }
      }
    };

    const FIVE_ELEMENTS = ["金", "金", "火", "木", "木", "水", "土", "土"];
    const YAO_SYMBOLS = ["—", "- -"];

    const $ = (s) => document.querySelector(s);
    const $$ = (s) => document.querySelectorAll(s);

    function getTrigram(bin) {
      // 確保傳入的 bin 是長度為 3 的陣列
      if (bin.length !== 3) {
          console.error('Invalid binary input for trigram:', bin);
          return null;
      }
      return TRIGRAMS.find(t => t.bin.every((v, i) => v === bin[i]));
    }

    function getHexagramName(upper, lower) {
      return HEXAGRAMS[upper.key + lower.key];
    }

    function getMutualHexagram(baseHex) {
        if (!baseHex || baseHex.length < 6) return null;
        // 互卦內卦由本卦的2,3,4爻組成 (索引1,2,3)
        const mutualLowerBin = baseHex.slice(1, 4);
        // 互卦外卦由本卦的3,4,5爻組成 (索引2,3,4)
        const mutualUpperBin = baseHex.slice(2, 5);
        const mutualLower = getTrigram(mutualLowerBin);
        const mutualUpper = getTrigram(mutualUpperBin);
        return { mutualUpper, mutualLower };
    }

    function getChangedHexagram(baseHex, movingYao) {
        if (!baseHex || !movingYao || movingYao < 1 || movingYao > 6) return null;
        const changedHex = [...baseHex];
        const movingIndex = movingYao - 1;
        changedHex[movingIndex] = 1 - changedHex[movingIndex];
        const changedLowerBin = changedHex.slice(0, 3);
        const changedUpperBin = changedHex.slice(3, 6);
        const changedLower = getTrigram(changedLowerBin);
        const changedUpper = getTrigram(changedUpperBin);
        return { changedUpper, changedLower };
    }

    function renderHexagram(elementId, hexagramBin) {
      const el = $(`#${elementId}`);
      if (!el) return;
      el.innerHTML = hexagramBin.map(yao => YAO_SYMBOLS[yao]).reverse().join('\n');
    }

    function renderHexagramInfo(prefix, hexagram) {
      if (!hexagram) return;
      const { name, dictum } = getHexagramName(hexagram.upper, hexagram.lower) || {};
      $(`#${prefix}Name`).textContent = name || '';
      $(`#${prefix}Symbol`).textContent = hexagram.upper.symbol + hexagram.lower.symbol;
      $(`#${prefix}Dictum`).textContent = dictum || '';
      $(`#${prefix}Lower`).textContent = `內卦: ${hexagram.lower.key} (${hexagram.lower.element})`;
      $(`#${prefix}Upper`).textContent = `外卦: ${hexagram.upper.key} (${hexagram.upper.element})`;
      $(`#${prefix}Relation`).textContent = `五行關係: ${getRelation(hexagram.upper.element, hexagram.lower.element)}`;
    }

    function getRelation(upperElement, lowerElement) {
        const relations = {
            '金': {'木': '金剋木', '土': '土生金', '火': '火剋金', '水': '金生水', '金': '比和'},
            '木': {'土': '木剋土', '水': '水生木', '金': '金剋木', '火': '木生火', '木': '比和'},
            '水': {'火': '水剋火', '金': '金生水', '土': '土剋水', '木': '水生木', '水': '比和'},
            '火': {'金': '火剋金', '木': '木生火', '水': '水剋火', '土': '火生土', '火': '比和'},
            '土': {'水': '土剋水', '火': '火生土', '木': '木剋土', '金': '土生金', '土': '比和'},
        };
        return relations[upperElement][lowerElement] || '比和';
    }

    function getElementsStatus(currentMonth) {
      const monthMap = { 1: "土", 2: "木", 3: "木", 4: "木", 5: "火", 6: "火", 7: "火", 8: "土", 9: "金", 10: "金", 11: "金", 12: "水", 13: "水", 14: "水" };
      const currentElement = monthMap[currentMonth];
      const status = { "木": { "木": "旺", "火": "相", "水": "休", "金": "囚", "土": "死" }, "火": { "火": "旺", "土": "相", "木": "休", "水": "囚", "金": "死" }, "土": { "土": "旺", "金": "相", "火": "休", "木": "囚", "水": "死" }, "金": { "金": "旺", "水": "相", "土": "休", "火": "囚", "木": "死" }, "水": { "水": "旺", "木": "相", "金": "休", "土": "囚", "火": "死" } };
      return status[currentElement];
    }

    function updateElementsStatus(currentMonth) {
        const elementsStatus = getElementsStatus(currentMonth);
        const elementsText = Object.entries(elementsStatus).map(([el, status]) => `${el}: ${status}`).join('，');
        $('#elementsStatus').textContent = `本月（${currentMonth}月）五行狀態：${elementsText}`;
    }

    function renderInterpretations(tabName, trigramKey) {
        const tabContentEl = $(`#tab-${tabName}`);
        if (!tabContentEl || !INTERPRETATIONS[tabName] || !INTERPRETATIONS[tabName][trigramKey]) {
            tabContentEl.innerHTML = '';
            return;
        }
        const data = INTERPRETATIONS[tabName][trigramKey];
        tabContentEl.innerHTML = `
            <div class="mb-2"><strong>${data.desc}</strong></div>
            <div>${data.impact}</div>
            <div>${data.auspicious}</div>
            <div>${data.inauspicious}</div>
        `;
    }

    function computeAndRender() {
      let lower, upper, movingYao;
      const method = $('#methodSelect').value;

      if (method === 'manual') {
        const lowerKey = $('#lowerSelect').value;
        const upperKey = $('#upperSelect').value;
        movingYao = parseInt($('#movingInput').value, 10);
        lower = TRIGRAMS.find(t => t.key === lowerKey);
        upper = TRIGRAMS.find(t => t.key === upperKey);
      } else if (method === 'number') {
        const number = parseInt($('#numberValue').value, 10);
        if (isNaN(number)) return;
        const lowerIndex = (number % 8);
        const upperIndex = ((number + 1) % 8);
        movingYao = (number % 6) + 1;
        lower = TRIGRAMS[lowerIndex];
        upper = TRIGRAMS[upperIndex];
      } else if (method === 'time') {
        const dt = $('#datetimeValue').value;
        if (!dt) return;
        const date = new Date(dt);
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        const hour = date.getHours();
        const lowerIndex = (year + month + day) % 8;
        const upperIndex = (hour) % 8;
        movingYao = ((year + month + day + hour) % 6) + 1;
        lower = TRIGRAMS[lowerIndex];
        upper = TRIGRAMS[upperIndex];
      }

      if (!lower || !upper || !movingYao) return;

      const baseHexBin = [...lower.bin, ...upper.bin].reverse();
      const mutual = getMutualHexagram(baseHexBin);
      const changed = getChangedHexagram(baseHexBin, movingYao);

      renderHexagram('baseHexagram', baseHexBin);
      renderHexagramInfo('base', { upper, lower });
      $(`#movingDictum`).textContent = (HEXAGRAMS[upper.key + lower.key]?.yaos[movingYao - 1]) || '';

      if (mutual) {
        const mutualHexBin = [...mutual.mutualLower.bin, ...mutual.mutualUpper.bin].reverse();
        renderHexagram('mutualHexagram', mutualHexBin);
        renderHexagramInfo('mutual', { upper: mutual.mutualUpper, lower: mutual.mutualLower });
      }

      if (changed) {
        const changedHexBin = [...changed.changedLower.bin, ...changed.changedUpper.bin].reverse();
        renderHexagram('changedHexagram', changedHexBin);
        renderHexagramInfo('changed', { upper: changed.changedUpper, lower: changed.changedLower });
      }

      // Re-render interpretations for the active tab
      const activeTabName = document.querySelector('.tab-btn.tab-active').dataset.tab;
      activateTab(activeTabName);
    }

    function initSelectors() {
      const lowerSelect = $('#lowerSelect');
      const upperSelect = $('#upperSelect');
      TRIGRAMS.forEach(trigram => {
        const option = new Option(trigram.key, trigram.key);
        lowerSelect.add(option.cloneNode(true));
        upperSelect.add(option);
      });
      lowerSelect.value = '離';
      upperSelect.value = '兌';
    }

    function toggleInputs() {
      const method = $('#methodSelect').value;
      $('#manualInput').classList.toggle('hidden', method !== 'manual');
      $('#numberInput').classList.toggle('hidden', method !== 'number');
      $('#timeInput').classList.toggle('hidden', method !== 'time');
    }

    function bindEvents() {
      $('#methodSelect').addEventListener('change', () => { toggleInputs(); computeAndRender(); });
      $('#lowerSelect').addEventListener('change', computeAndRender);
      $('#upperSelect').addEventListener('change', computeAndRender);
      $('#movingInput').addEventListener('input', computeAndRender);
      $('#numberValue').addEventListener('input', computeAndRender);
      $('#datetimeValue').addEventListener('input', computeAndRender);
      $('#resetBtn').addEventListener('click', () => {
        $('#methodSelect').value = 'manual';
        toggleInputs();
        $('#lowerSelect').value = '離';
        $('#upperSelect').value = '兌';
        $('#movingInput').value = 1;
        $('#numberValue').value = '';
        $('#datetimeValue').value = '';
        activateTab('human');
        computeAndRender();
      });

      $$('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const tabName = btn.dataset.tab;
          activateTab(tabName);
        });
      });
    }

    let currentLowerTrigramKey = '離'; // 確保初始值與下拉選單一致

    function activateTab(name) {
      $$('.tab-btn').forEach(b => b.classList.toggle('tab-active', b.dataset.tab === name));
      $$('.tab-pane').forEach(p => p.classList.toggle('hidden', p.id !== 'tab-' + name));

      // 取得當前本卦的內卦鍵值
      const lowerGuaElement = $('#baseLower');
      if (lowerGuaElement) {
        const match = lowerGuaElement.textContent.match(/內卦: (\S+)/);
        if (match && match[1]) {
          currentLowerTrigramKey = match[1];
        }
      }
      renderInterpretations(name, currentLowerTrigramKey);
    }

    // init
    document.addEventListener('DOMContentLoaded', () => {
      initSelectors();
      toggleInputs();
      bindEvents();
      activateTab('human');
      computeAndRender();
      document.getElementById('year').textContent = new Date().getFullYear();
    });
  </script>
</body>
</html>
```
