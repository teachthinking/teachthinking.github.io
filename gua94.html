<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>張老師易經卜卦</title>
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background: linear-gradient(135deg,#6a11cb 0%,#2575fc 100%); display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; flex-direction:column; color:#333; }
    .container { text-align:center; background:#fff; padding:30px; border-radius:15px; box-shadow:0 8px 20px rgba(0,0,0,.2); width:90%; max-width:900px; }
    h1{font-size:2rem;color:#6a11cb;margin-bottom:20px;}
    button{padding:10px 20px; border:none; border-radius:25px; background:#f90; color:#fff; font-weight:bold; cursor:pointer; margin:10px;}
    button:hover{background:#c60;}
    .tab-buttons{margin-bottom:20px;}
    .tab-button{background:#eee;margin:5px;}
    .tab-button.active{background:#6a11cb;color:#fff;}
    .tab-content{display:none;}
    .tab-content.active{display:block;}
    .input-group{margin:10px;}
    #result{margin-top:20px; display:none;}
    .gua-container{display:flex; flex-wrap:wrap; justify-content:center; gap:20px;}
    .gua-box{padding:15px; border:1px solid #ccc; border-radius:10px; width:250px;}
    .gua-box h3{color:#6a11cb;}
    #line-explanation{margin-top:20px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>張老師易經卜卦</h1>

    <div class="tab-buttons">
      <button class="tab-button active" onclick="showTab('manual-upper')">數字取卦</button>
      <button class="tab-button" onclick="showTab('manual-dropdown')">手動取卦</button>
      <button class="tab-button" onclick="showTab('time-divination')">時間取卦</button>
      <button class="tab-button" onclick="showTab('by-image')">以象取卦</button>
    </div>

    <div id="manual-upper" class="tab-content active">
      <h2>數字取卦</h2>
      <div class="input-group"><label>上卦數字: <input type="number" id="num4"></label></div>
      <div class="input-group"><label>下卦數字: <input type="number" id="num5"></label></div>
      <div class="input-group"><label>動爻數字: <input type="number" id="num6"></label></div>
      <button id="manualUpperBtn">生成卦象</button>
    </div>

    <div id="manual-dropdown" class="tab-content">
      <h2>手動取卦</h2>
      <div class="input-group">
        <label>上卦: 
          <select id="upperGuaSelect">
            <option value="1">乾☰</option><option value="2">兌☱</option><option value="3">離☲</option>
            <option value="4">震☳</option><option value="5">巽☴</option><option value="6">坎☵</option>
            <option value="7">艮☶</option><option value="8">坤☷</option>
          </select>
        </label>
      </div>
      <div class="input-group">
        <label>下卦: 
          <select id="lowerGuaSelect">
            <option value="1">乾☰</option><option value="2">兌☱</option><option value="3">離☲</option>
            <option value="4">震☳</option><option value="5">巽☴</option><option value="6">坎☵</option>
            <option value="7">艮☶</option><option value="8">坤☷</option>
          </select>
        </label>
      </div>
      <div class="input-group"><label>變爻 (1-6,逗號分隔): <input type="text" id="movingLinesInput"></label></div>
      <button id="manualDropdownBtn">生成卦象</button>
    </div>

    <div id="time-divination" class="tab-content">
      <h2>時間取卦</h2>
      <div class="input-group"><label>心念數字 (0-999): <input type="number" id="timeDivinationNum" value="0"></label></div>
      <button id="timeDivinationBtn">開始卜卦</button>
    </div>

    <div id="by-image" class="tab-content">
      <h2>以象取卦</h2>
      <div class="input-group"><label>上卦數字: <input type="number" id="imageUpperNum"></label></div>
      <div class="input-group">
        <label>下卦方位: 
          <select id="imageLowerSelect">
            <option value="1">北方(坎)</option><option value="2">西南(坤)</option><option value="3">東方(震)</option>
            <option value="4">東南(巽)</option><option value="5">中宮(坤)</option><option value="6">西北(乾)</option>
            <option value="7">西方(兌)</option><option value="8">東北(艮)</option><option value="9">南方(離)</option>
          </select>
        </label>
      </div>
      <button id="imageGuaBtn">生成卦象</button>
    </div>

    <div id="result">
      <div class="gua-container">
        <div class="gua-box"><h3>本卦</h3><h2 id="guaName"></h2><div id="guaImage"></div></div>
        <div class="gua-box"><h3>變卦</h3><h2 id="changeGuaName"></h2><div id="changeGuaImage"></div></div>
        <div class="gua-box"><h3>互卦</h3><h2 id="huGuaName"></h2><div id="huGuaImage"></div></div>
      </div>
      <div id="line-explanation" class="gua-box hidden">
        <h3>動爻解釋</h3>
        <pre id="line-text-display"></pre>
      </div>
    </div>
  </div>

<script>
let hexagramsData = {};
fetch("hexagrams_data.json")
  .then(r=>r.json())
  .then(data=>{ hexagramsData=data; console.log("卦辭資料已載入"); });

const guaMap={1:\"乾\",2:\"兌\",3:\"離\",4:\"震\",5:\"巽\",6:\"坎\",7:\"艮\",8:\"坤\"};

function generateGua(upper,lower,movingLines=[]){
  const guaName = guaMap[upper] + guaMap[lower];
  document.getElementById(\"guaName\").innerText = guaName;

  let explanation=\"\";
  if(hexagramsData[guaName]){
    const lines=hexagramsData[guaName];
    movingLines.forEach(idx=>{
      const line=lines[idx-1];
      if(line) explanation += `${line.text} — ${line.meaning}\\n`;
    });
  }
  if(explanation){
    document.getElementById(\"line-explanation\").classList.remove(\"hidden\");
    document.getElementById(\"line-text-display\").innerText=explanation;
  }
  document.getElementById(\"result\").style.display=\"block\";
}

document.getElementById(\"manualUpperBtn\").addEventListener(\"click\",()=>{
  const upper=(parseInt(document.getElementById(\"num4\").value)%8)||1;
  const lower=(parseInt(document.getElementById(\"num5\").value)%8)||1;
  const moving=[(parseInt(document.getElementById(\"num6\").value)%6)+1];
  generateGua(upper,lower,moving);
});

document.getElementById(\"manualDropdownBtn\").addEventListener(\"click\",()=>{
  const upper=parseInt(document.getElementById(\"upperGuaSelect\").value);
  const lower=parseInt(document.getElementById(\"lowerGuaSelect\").value);
  const moving=document.getElementById(\"movingLinesInput\").value.split(\",\").map(x=>parseInt(x.trim())).filter(x=>!isNaN(x));
  generateGua(upper,lower,moving);
});

document.getElementById(\"timeDivinationBtn\").addEventListener(\"click\",()=>{
  const num=parseInt(document.getElementById(\"timeDivinationNum\").value)+Date.now();
  const upper=(num%8)+1;
  const lower=((Math.floor(num/10))%8)+1;
  const moving=[(num%6)+1];
  generateGua(upper,lower,moving);
});

document.getElementById(\"imageGuaBtn\").addEventListener(\"click\",()=>{
  const upper=(parseInt(document.getElementById(\"imageUpperNum\").value)%8)||1;
  const lower=parseInt(document.getElementById(\"imageLowerSelect\").value)%8||1;
  const moving=[Math.floor(Math.random()*6)+1];
  generateGua(upper,lower,moving);
});

function showTab(id){
  document.querySelectorAll('.tab-content').forEach(tab=>tab.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tab-button').forEach(btn=>btn.classList.remove('active'));
  event.target.classList.add('active');
}
</script>
</body>
</html>
